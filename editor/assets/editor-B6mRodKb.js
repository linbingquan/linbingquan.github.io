const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./Sidebar.Geometry.BoxGeometry-CdEU7DCC.js","./SetGeometryCommand-CsejrNn_.js","./Sidebar.Geometry.CapsuleGeometry-BUXFQKaq.js","./Sidebar.Geometry.CircleGeometry-CdFJytNA.js","./Sidebar.Geometry.CylinderGeometry-Nsw2jHyf.js","./Sidebar.Geometry.DodecahedronGeometry-Pi9vFCx4.js","./Sidebar.Geometry.ExtrudeGeometry-C98Npptt.js","./Sidebar.Geometry.IcosahedronGeometry-Bh1Hm_r_.js","./Sidebar.Geometry.LatheGeometry-Da2R7sMH.js","./ui.three-939YCw5T.js","./Sidebar.Geometry.OctahedronGeometry-92TVzDxQ.js","./Sidebar.Geometry.PlaneGeometry-BAOQbegQ.js","./Sidebar.Geometry.RingGeometry-tePqmNVu.js","./Sidebar.Geometry.ShapeGeometry-2EAvVHCM.js","./Sidebar.Geometry.SphereGeometry-CgboX7pt.js","./Sidebar.Geometry.TetrahedronGeometry-CUIsjPPY.js","./Sidebar.Geometry.TorusGeometry-BXRs1SOf.js","./Sidebar.Geometry.TorusKnotGeometry-CPfBa8le.js","./Sidebar.Geometry.TubeGeometry-D0X86lJe.js"])))=>i.map(i=>d[i]);
import{_ as e,a as t,b as n,c as r,d as i,f as a,g as o,h as s,i as c,l,m as u,n as d,o as f,p,r as m,s as h,t as g,u as _,v,y}from"./SetGeometryCommand-CsejrNn_.js";import{a as b,c as x,l as S,n as C,o as w,s as T,t as E}from"./ui.three-939YCw5T.js";import*as D from"three";import{Box3 as O,CanvasTexture as k,Color as A,CylinderGeometry as j,Euler as M,FileLoader as N,Mesh as P,MeshBasicMaterial as F,Object3D as I,ObjectLoader as L,OrthographicCamera as ee,Quaternion as te,Raycaster as ne,SRGBColorSpace as re,Sprite as R,SpriteMaterial as ie,Vector2 as z,Vector3 as B,Vector4 as ae}from"three";import{AnimationPathHelper as V}from"three/addons/helpers/AnimationPathHelper.js";import{TGALoader as H}from"three/addons/loaders/TGALoader.js";import{strFromU8 as U,strToU8 as W,unzipSync as oe,zipSync as se}from"three/addons/libs/fflate.module.js";import{clone as ce}from"three/addons/utils/SkeletonUtils.js";import{WebGLPathTracer as le}from"three-gpu-pathtracer";import{VertexNormalsHelper as ue}from"three/addons/helpers/VertexNormalsHelper.js";import{computeMikkTSpaceTangents as de}from"three/addons/utils/BufferGeometryUtils.js";import*as fe from"three/addons/libs/mikktspace.module.js";import{PMREMGenerator as pe,WebGPURenderer as me}from"three/webgpu";import{TransformControls as he}from"three/addons/controls/TransformControls.js";import{HTMLMesh as ge}from"three/addons/interactive/HTMLMesh.js";import{InteractiveGroup as _e}from"three/addons/interactive/InteractiveGroup.js";import{XRControllerModelFactory as ve}from"three/addons/webxr/XRControllerModelFactory.js";import{ColorEnvironment as ye}from"three/addons/environments/ColorEnvironment.js";import{RoomEnvironment as be}from"three/addons/environments/RoomEnvironment.js";import{Workspace as xe,init as Se}from"modern-monaco";var Ce=Object.defineProperty,we=(e,t)=>{let n={};for(var r in e)Ce(n,r,{get:e[r],enumerable:!0});return t||Ce(n,Symbol.toStringTag,{value:`Module`}),n};function Te(e){let t=e.signals,n=new u;n.setId(`animation`),n.dom.style.flexDirection=`column`;let r=36;t.animationPanelResized.add(function(e){r=e,n.dom.style.height=e+`px`,t.animationPanelChanged.dispatch(e)});let i=new u;i.dom.style.padding=`6px 10px`,i.dom.style.borderBottom=`1px solid #ccc`,i.dom.style.display=`flex`,i.dom.style.alignItems=`center`,i.dom.style.justifyContent=`center`,i.dom.style.gap=`6px`,i.dom.style.flexShrink=`0`,n.add(i);let a=new c;a.dom.innerHTML=`<svg width="12" height="12" viewBox="0 0 12 12"><path d="M3 1.5v9l7-4.5z" fill="currentColor"/></svg>`,a.dom.style.width=`24px`,a.dom.style.height=`24px`,a.dom.style.padding=`0`,a.dom.style.borderRadius=`4px`,a.dom.style.display=`flex`,a.dom.style.alignItems=`center`,a.dom.style.justifyContent=`center`,a.onClick(function(){w&&(w.paused?w.paused=!1:w.isRunning()||(w.reset(),w.play()))}),i.add(a);let o=new c;o.dom.innerHTML=`<svg width="12" height="12" viewBox="0 0 12 12"><path d="M2 1h3v10H2zM7 1h3v10H7z" fill="currentColor"/></svg>`,o.dom.style.width=`24px`,o.dom.style.height=`24px`,o.dom.style.padding=`0`,o.dom.style.borderRadius=`4px`,o.dom.style.display=`flex`,o.dom.style.alignItems=`center`,o.dom.style.justifyContent=`center`,o.onClick(function(){w&&(w.paused=!0)}),i.add(o);let s=new c;s.dom.innerHTML=`<svg width="12" height="12" viewBox="0 0 12 12"><rect x="2" y="2" width="8" height="8" fill="currentColor"/></svg>`,s.dom.style.width=`24px`,s.dom.style.height=`24px`,s.dom.style.padding=`0`,s.dom.style.borderRadius=`4px`,s.dom.style.display=`flex`,s.dom.style.alignItems=`center`,s.dom.style.justifyContent=`center`,s.onClick(function(){w&&w.stop()}),i.add(s);let l=document.createElement(`div`);l.style.display=`flex`,l.style.alignItems=`center`,l.style.justifyContent=`center`,l.style.gap=`4px`,l.style.height=`24px`,l.style.padding=`0 8px`,l.style.background=`rgba(0,0,0,0.05)`,l.style.borderRadius=`4px`,l.style.fontFamily=`monospace`,l.style.fontSize=`11px`,i.dom.appendChild(l);let d=new y(`0.00`).setWidth(`36px`);d.dom.style.textAlign=`right`,l.appendChild(d.dom);let f=new y(`/`);l.appendChild(f.dom);let p=new y(`0.00`).setWidth(`36px`);l.appendChild(p.dom);let m=document.createElement(`div`);m.style.flex=`1`,m.style.display=`flex`,m.style.flexDirection=`column`,m.style.overflow=`hidden`,m.style.position=`relative`,n.dom.appendChild(m);let h=document.createElement(`div`);h.style.flex=`1`,h.style.overflowY=`auto`,h.style.overflowX=`hidden`,m.appendChild(h);let g=document.createElement(`div`);g.style.position=`absolute`,g.style.top=`0`,g.style.bottom=`0`,g.style.width=`2px`,g.style.background=`#f00`,g.style.left=`150px`,g.style.pointerEvents=`none`,g.style.zIndex=`10`,m.appendChild(g);let _=!1;function v(t){let n=m.getBoundingClientRect(),r=n.width-150,i=Math.max(0,Math.min(t-n.left-150,r))/r;if(w&&T){let t=i*T.duration;w.play(),w.time=t,w.paused=!0,e.mixer.update(0)}}m.addEventListener(`mousedown`,function(e){let t=m.getBoundingClientRect();e.clientX-t.left>150&&(e.preventDefault(),_=!0,v(e.clientX))}),document.addEventListener(`mousemove`,function(e){_&&v(e.clientX)}),document.addEventListener(`mouseup`,function(){_=!1});let b={position:`#4CAF50`,quaternion:`#2196F3`,rotation:`#2196F3`,scale:`#FF9800`,morphTargetInfluences:`#9C27B0`,default:`#607D8B`};function x(e){for(let t in b)if(e.endsWith(`.`+t))return b[t];return b.default}function S(e){let t=e.split(`.`);return t[t.length-1]}let C=null,w=null,T=null,E=null;function D(){let t=e.scene,n=[],r=new Set;t.traverse(function(e){if(e.animations&&e.animations.length>0)for(let t of e.animations)r.has(t.uuid)||(r.add(t.uuid),n.push({clip:t,root:e}))});for(let e of t.animations)r.has(e.uuid)||(r.add(e.uuid),n.push({clip:e,root:t}));return n}function O(e,t){let n=e.lastIndexOf(`.`);if(n===-1)return e;let r=e.substring(0,n),i=t.getObjectByProperty(`uuid`,r);return i?i.name||`Object`:r.substring(0,8)}function k(){h.innerHTML=``,n.setDisplay(`flex`),n.dom.style.height=r+`px`,t.animationPanelChanged.dispatch(r);let i=D();if(i.length!==0)for(let{clip:t,root:n}of i){let r=document.createElement(`div`);r.style.display=`flex`,r.style.alignItems=`center`,r.style.height=`24px`,r.style.borderBottom=`1px solid #ccc`,r.style.cursor=`pointer`,r.style.background=T===t?`rgba(0, 136, 255, 0.1)`:``;let i=document.createElement(`div`);i.style.width=`150px`,i.style.padding=`0 10px`,i.style.fontSize=`11px`,i.style.fontWeight=`bold`,i.style.overflow=`hidden`,i.style.textOverflow=`ellipsis`,i.style.whiteSpace=`nowrap`,i.style.flexShrink=`0`,i.style.boxSizing=`border-box`,i.textContent=t.name||`Animation`,r.appendChild(i);let a=document.createElement(`div`);if(a.style.flex=`1`,a.style.height=`100%`,a.style.background=`rgba(0,0,0,0.03)`,r.appendChild(a),r.addEventListener(`click`,function(){e.select(n),A(t,n),k()}),h.appendChild(r),T===t){let e=t.duration;for(let r of t.tracks){let i=r.times;if(i.length===0)continue;let a=i[0],o=i[i.length-1],s=a/e*100,c=(o-a)/e*100,l=document.createElement(`div`);l.style.display=`flex`,l.style.alignItems=`center`,l.style.height=`20px`,l.style.borderBottom=`1px solid #eee`;let u=document.createElement(`div`);u.style.width=`150px`,u.style.padding=`0 10px 0 20px`,u.style.fontSize=`10px`,u.style.overflow=`hidden`,u.style.textOverflow=`ellipsis`,u.style.whiteSpace=`nowrap`,u.style.flexShrink=`0`,u.style.boxSizing=`border-box`,u.style.color=`#666`;let d=O(r.name,n),f=S(r.name);u.textContent=d+`.`+f,u.title=r.name,l.appendChild(u);let p=document.createElement(`div`);p.style.flex=`1`,p.style.height=`100%`,p.style.position=`relative`,p.style.background=`rgba(0,0,0,0.02)`;let m=document.createElement(`div`);m.style.position=`absolute`,m.style.left=s+`%`,m.style.width=Math.max(.5,c)+`%`,m.style.top=`3px`,m.style.bottom=`3px`,m.style.background=x(r.name),m.style.borderRadius=`2px`,m.style.opacity=`0.6`,m.title=f+`: `+a.toFixed(2)+`s - `+o.toFixed(2)+`s`,p.appendChild(m);for(let t=0;t<i.length;t++){let n=i[t]/e*100,a=document.createElement(`div`);a.style.position=`absolute`,a.style.left=n+`%`,a.style.top=`50%`,a.style.width=`6px`,a.style.height=`6px`,a.style.marginLeft=`-3px`,a.style.marginTop=`-3px`,a.style.background=x(r.name),a.style.borderRadius=`1px`,a.style.transform=`rotate(45deg)`,a.title=i[t].toFixed(3)+`s`,p.appendChild(a)}if(l.appendChild(p),r.name.endsWith(`.position`)&&r.getValueSize()===3){let e=r.name.replace(`.position`,``),i=n.getObjectByProperty(`uuid`,e);i&&(l.addEventListener(`mouseenter`,function(){j(t,i)}),l.addEventListener(`mouseleave`,function(){M()}))}h.appendChild(l)}}}}function A(t,n){w&&w.stop(),T=t,E=n,w=e.mixer.clipAction(t,n),p.setValue(t.duration.toFixed(2))}function j(n,r){M(),C=new V(E,n,r),e.sceneHelpers.add(C),t.sceneGraphChanged.dispatch()}function M(){C&&(e.sceneHelpers.remove(C),C.dispose(),C=null,t.sceneGraphChanged.dispatch())}function N(){M(),h.innerHTML=``,w=null,T=null,E=null,d.setValue(`0.00`),p.setValue(`0.00`)}function P(){if(w&&T){let e=w.time%T.duration;d.setValue(e.toFixed(2));let t=m.getBoundingClientRect().width-150,n=150+e/T.duration*t;g.style.left=n+`px`}requestAnimationFrame(P)}return P(),t.objectSelected.add(function(e){e!==null&&e.animations&&e.animations.length>0&&(A(e.animations[0],e),k())}),t.editorCleared.add(N),t.objectAdded.add(k),t.objectRemoved.add(k),n.setDisplay(`flex`),n.dom.style.height=r+`px`,t.animationPanelChanged.dispatch(r),n}function Ee(e){let t=e.signals,n=document.createElement(`div`);n.id=`animation-resizer`;let i=36,a=0,o=0;function s(e){e.isPrimary!==!1&&(a=e.clientY,o=i,n.ownerDocument.addEventListener(`pointermove`,l),n.ownerDocument.addEventListener(`pointerup`,c))}function c(e){e.isPrimary!==!1&&(n.ownerDocument.removeEventListener(`pointermove`,l),n.ownerDocument.removeEventListener(`pointerup`,c))}function l(e){if(e.isPrimary===!1)return;let n=a-e.clientY,r=o+n,s=window.innerHeight/2;i=Math.max(36,Math.min(s,r)),t.animationPanelResized.dispatch(i)}return n.addEventListener(`pointerdown`,s),t.animationPanelChanged.add(function(e){e===!1?n.style.display=`none`:(n.style.display=`block`,n.style.bottom=e+`px`,i=e)}),new r(n)}function De(){let e=`threejs-editor`,t=navigator.language.split(`-`)[0],n={language:[`fr`,`ja`,`zh`,`ko`,`fa`].includes(t)?t:`en`,autosave:!0,"project/title":``,"project/editable":!1,"project/vr":!1,"project/renderer/type":`WebGLRenderer`,"project/renderer/antialias":!0,"project/renderer/shadows":!0,"project/renderer/shadowType":1,"project/renderer/toneMapping":7,"project/renderer/toneMappingExposure":1,"settings/history":!1,"settings/shortcuts/translate":`w`,"settings/shortcuts/rotate":`e`,"settings/shortcuts/scale":`r`,"settings/shortcuts/undo":`z`,"settings/shortcuts/focus":`f`};if(window.localStorage[e]===void 0)window.localStorage[e]=JSON.stringify(n);else{let t=JSON.parse(window.localStorage[e]);for(let e in t)n[e]=t[e]}return{getKey:function(e){return n[e]},setKey:function(){for(let e=0,t=arguments.length;e<t;e+=2)n[arguments[e]]=arguments[e+1];window.localStorage[e]=JSON.stringify(n),console.log(`[`+/\d\d\:\d\d\:\d\d/.exec(new Date)[0]+`]`,`Saved config to LocalStorage.`)},clear:function(){delete window.localStorage[e]}}}function Oe(){if(Promise.withResolvers)return Promise.withResolvers();let e=Object.create(null);return e.promise=new Promise((t,n)=>{e.resolve=t,e.reject=n}),e}var G=class extends d{constructor(e,t=null){super(e),this.type=`AddObjectCommand`,this.object=t,t!==null&&(this.name=e.strings.getKey(`command/AddObject`)+`: `+t.name)}execute(){this.editor.addObject(this.object),this.editor.select(this.object)}undo(){this.editor.removeObject(this.object),this.editor.deselect()}toJSON(){let e=super.toJSON(this);return e.object=this.object.toJSON(),e}fromJSON(e){super.fromJSON(e),this.object=this.editor.objectByUuid(e.object.object.uuid),this.object===void 0&&(this.object=new L().parse(e.object))}},ke=class extends d{constructor(e,t=null,n=null){super(e),this.type=`SetUuidCommand`,this.name=e.strings.getKey(`command/SetUuid`),this.object=t,this.oldUuid=t===null?null:t.uuid,this.newUuid=n}execute(){this.object.uuid=this.newUuid,this.editor.signals.objectChanged.dispatch(this.object),this.editor.signals.sceneGraphChanged.dispatch()}undo(){this.object.uuid=this.oldUuid,this.editor.signals.objectChanged.dispatch(this.object),this.editor.signals.sceneGraphChanged.dispatch()}toJSON(){let e=super.toJSON(this);return e.oldUuid=this.oldUuid,e.newUuid=this.newUuid,e}fromJSON(e){super.fromJSON(e),this.oldUuid=e.oldUuid,this.newUuid=e.newUuid,this.object=this.editor.objectByUuid(e.oldUuid),this.object===void 0&&(this.object=this.editor.objectByUuid(e.newUuid))}},K=class extends d{constructor(e,t=null,n=``,r=null){super(e),this.type=`SetValueCommand`,this.name=e.strings.getKey(`command/SetValue`)+`: `+n,this.updatable=!0,this.object=t,this.attributeName=n,this.oldValue=t===null?null:t[n],this.newValue=r}execute(){this.object[this.attributeName]=this.newValue,this.editor.signals.objectChanged.dispatch(this.object)}undo(){this.object[this.attributeName]=this.oldValue,this.editor.signals.objectChanged.dispatch(this.object)}update(e){this.newValue=e.newValue}toJSON(){let e=super.toJSON(this);return e.objectUuid=this.object.uuid,e.attributeName=this.attributeName,e.oldValue=this.oldValue,e.newValue=this.newValue,e}fromJSON(e){super.fromJSON(e),this.attributeName=e.attributeName,this.oldValue=e.oldValue,this.newValue=e.newValue,this.object=this.editor.objectByUuid(e.objectUuid)}},Ae=class extends d{constructor(e,t=null){if(super(e),this.type=`SetSceneCommand`,this.name=e.strings.getKey(`command/SetScene`),this.cmdArray=[],t!==null)for(this.cmdArray.push(new ke(this.editor,this.editor.scene,t.uuid)),this.cmdArray.push(new K(this.editor,this.editor.scene,`name`,t.name)),this.cmdArray.push(new K(this.editor,this.editor.scene,`userData`,JSON.parse(JSON.stringify(t.userData))));t.children.length>0;){let e=t.children.pop();this.cmdArray.push(new G(this.editor,e))}}execute(){this.editor.signals.sceneGraphChanged.active=!1;for(let e=0;e<this.cmdArray.length;e++)this.cmdArray[e].execute();this.editor.signals.sceneGraphChanged.active=!0,this.editor.signals.sceneGraphChanged.dispatch()}undo(){this.editor.signals.sceneGraphChanged.active=!1;for(let e=this.cmdArray.length-1;e>=0;e--)this.cmdArray[e].undo();this.editor.signals.sceneGraphChanged.active=!0,this.editor.signals.sceneGraphChanged.dispatch()}toJSON(){let e=super.toJSON(this),t=[];for(let e=0;e<this.cmdArray.length;e++)t.push(this.cmdArray[e].toJSON());return e.cmds=t,e}fromJSON(e){super.fromJSON(e);let t=e.cmds;for(let e=0;e<t.length;e++){let n=new window[t[e].type];n.fromJSON(t[e]),this.cmdArray.push(n)}}},je={createFilesMap:function(e){let t={};for(let n=0;n<e.length;n++){let r=e[n];t[r.name]=r}return t},getFilesFromItemList:function(e,t){let n=0,r=0,i=[],a={};function o(){n++,n===r&&t(i,a)}function s(e){e.isDirectory?e.createReader().readEntries(function(e){for(let t=0;t<e.length;t++)s(e[t]);o()}):e.isFile&&e.file(function(t){i.push(t),a[e.fullPath.slice(1)]=t,o()}),r++}for(let t=0;t<e.length;t++){let n=e[t];n.kind===`file`&&s(n.webkitGetAsEntry())}}},Me=class{constructor(e){this.strings=e;let n=document.createElement(`div`);n.className=`Dialog`,this.dom=n;let r=document.createElement(`div`);r.className=`Dialog-background`,r.addEventListener(`click`,()=>this.cancel()),n.appendChild(r);let i=document.createElement(`div`);i.className=`Dialog-content`,n.appendChild(i);let a=document.createElement(`div`);a.className=`Dialog-title`,a.textContent=e.getKey(`dialog/gltf/title`),i.appendChild(a);let o=document.createElement(`div`);o.className=`Dialog-body`,i.appendChild(o);let l=new s;o.appendChild(l.dom),this.asSceneCheckbox=new t(!1),l.add(this.asSceneCheckbox),l.add(new y(e.getKey(`dialog/gltf/asScene`)).setMarginLeft(`6px`));let u=document.createElement(`div`);u.className=`Dialog-buttons`,o.appendChild(u);let d=new c(e.getKey(`dialog/ok`));d.setWidth(`80px`),d.onClick(()=>this.confirm()),u.appendChild(d.dom);let f=new c(e.getKey(`dialog/cancel`));f.setWidth(`80px`),f.setMarginLeft(`8px`),f.onClick(()=>this.cancel()),u.appendChild(f.dom),this.resolve=null,this.reject=null}show(){return document.body.appendChild(this.dom),new Promise((e,t)=>{this.resolve=e,this.reject=t})}confirm(){let e={asScene:this.asSceneCheckbox.getValue()};this.dom.remove(),this.resolve&&this.resolve(e)}cancel(){this.dom.remove(),this.reject&&this.reject(Error(`Import cancelled`))}};function Ne(e){let t=this;this.texturePath=``,this.loadItemList=function(e){je.getFilesFromItemList(e,function(e,n){t.loadFiles(e,n)})},this.loadFiles=function(e,n){if(e.length>0){n||=je.createFilesMap(e);let r=new D.LoadingManager;r.setURLModifier(function(e){e=e.replace(/^(\.?\/)/,``);let t=n[e];return t?(console.log(`Loading`,e),URL.createObjectURL(t)):e}),r.addHandler(/\.tga$/i,new H);for(let n=0;n<e.length;n++)t.loadFile(e[n],r)}},this.loadFile=function(t,a){let o=t.name,s=o.split(`.`).pop().toLowerCase(),c=new FileReader;switch(c.addEventListener(`progress`,function(t){let n=`(`+e.utils.formatNumber(Math.floor(t.total/1e3))+` KB)`,r=Math.floor(t.loaded/t.total*100)+`%`;console.log(`Loading`,o,n,r)}),s){case`3dm`:c.addEventListener(`load`,async function(t){let n=t.target.result,{Rhino3dmLoader:r}=await T(async()=>{let{Rhino3dmLoader:e}=await import(`three/addons/loaders/3DMLoader.js`);return{Rhino3dmLoader:e}},[],import.meta.url),i=new r;i.setLibraryPath(x(`rhino3dm/`)),i.parse(n,function(t){t.name=o,e.execute(new G(e,t))},function(e){console.error(e)})},!1),c.readAsArrayBuffer(t);break;case`3ds`:c.addEventListener(`load`,async function(t){let{TDSLoader:n}=await T(async()=>{let{TDSLoader:e}=await import(`three/addons/loaders/TDSLoader.js`);return{TDSLoader:e}},[],import.meta.url),r=new n().parse(t.target.result);e.execute(new G(e,r))},!1),c.readAsArrayBuffer(t);break;case`3mf`:c.addEventListener(`load`,async function(t){let{ThreeMFLoader:n}=await T(async()=>{let{ThreeMFLoader:e}=await import(`three/addons/loaders/3MFLoader.js`);return{ThreeMFLoader:e}},[],import.meta.url),r=new n().parse(t.target.result);e.execute(new G(e,r))},!1),c.readAsArrayBuffer(t);break;case`amf`:c.addEventListener(`load`,async function(t){let{AMFLoader:n}=await T(async()=>{let{AMFLoader:e}=await import(`three/addons/loaders/AMFLoader.js`);return{AMFLoader:e}},[],import.meta.url),r=new n().parse(t.target.result);e.execute(new G(e,r))},!1),c.readAsArrayBuffer(t);break;case`dae`:c.addEventListener(`load`,async function(t){let n=t.target.result,{ColladaLoader:r}=await T(async()=>{let{ColladaLoader:e}=await import(`three/addons/loaders/ColladaLoader.js`);return{ColladaLoader:e}},[],import.meta.url),i=new r(a).parse(n);i.scene.name=o,e.execute(new G(e,i.scene))},!1),c.readAsText(t);break;case`drc`:c.addEventListener(`load`,async function(t){let n=t.target.result,{DRACOLoader:r}=await T(async()=>{let{DRACOLoader:e}=await import(`three/addons/loaders/DRACOLoader.js`);return{DRACOLoader:e}},[],import.meta.url),i=new r;i.setDecoderPath(x(`draco/`)),i.parse(n,function(t){let n;if(t.index!==null){let e=new D.MeshStandardMaterial;n=new D.Mesh(t,e),n.name=o}else{let e=new D.PointsMaterial({size:.01});e.vertexColors=t.hasAttribute(`color`),n=new D.Points(t,e),n.name=o}i.dispose(),e.execute(new G(e,n))})},!1),c.readAsArrayBuffer(t);break;case`fbx`:c.addEventListener(`load`,async function(t){let n=t.target.result,{FBXLoader:r}=await T(async()=>{let{FBXLoader:e}=await import(`three/addons/loaders/FBXLoader.js`);return{FBXLoader:e}},[],import.meta.url),i=new r(a).parse(n);e.execute(new G(e,i))},!1),c.readAsArrayBuffer(t);break;case`glb`:c.addEventListener(`load`,async function(t){let n=t.target.result;try{let t=await new Me(e.strings).show(),r=await i();r.parse(n,``,function(n){let i=n.scene;i.name=o,i.animations.push(...n.animations),t.asScene?e.execute(new Ae(e,i)):e.execute(new G(e,i)),r.dracoLoader.dispose(),r.ktx2Loader.dispose()})}catch{}},!1),c.readAsArrayBuffer(t);break;case`gltf`:c.addEventListener(`load`,async function(t){let n=t.target.result;try{let t=await new Me(e.strings).show(),r=await i(a);r.parse(n,``,function(n){let i=n.scene;i.name=o,i.animations.push(...n.animations),t.asScene?e.execute(new Ae(e,i)):e.execute(new G(e,i)),r.dracoLoader.dispose(),r.ktx2Loader.dispose()})}catch{}},!1),c.readAsArrayBuffer(t);break;case`js`:case`json`:c.addEventListener(`load`,function(e){let t=e.target.result;if(t.indexOf(`postMessage`)!==-1){let e=new Blob([t],{type:`text/javascript`}),r=URL.createObjectURL(e),i=new Worker(r);i.onmessage=function(e){e.data.metadata={version:2},n(e.data)},i.postMessage(Date.now());return}let r;try{r=JSON.parse(t)}catch(e){alert(e);return}n(r)},!1),c.readAsText(t);break;case`kmz`:c.addEventListener(`load`,async function(t){let{KMZLoader:n}=await T(async()=>{let{KMZLoader:e}=await import(`three/addons/loaders/KMZLoader.js`);return{KMZLoader:e}},[],import.meta.url),r=new n().parse(t.target.result);r.scene.name=o,e.execute(new G(e,r.scene))},!1),c.readAsArrayBuffer(t);break;case`ldr`:case`mpd`:c.addEventListener(`load`,async function(t){let{LDrawLoader:n}=await T(async()=>{let{LDrawLoader:e}=await import(`three/addons/loaders/LDrawLoader.js`);return{LDrawLoader:e}},[],import.meta.url),r=new n;r.setPath(S(`ldraw/officialLibrary/`)),r.parse(t.target.result,function(t){t.name=o,t.rotation.x=Math.PI,e.execute(new G(e,t))})},!1),c.readAsText(t);break;case`md2`:c.addEventListener(`load`,async function(t){let n=t.target.result,{MD2Loader:r}=await T(async()=>{let{MD2Loader:e}=await import(`three/addons/loaders/MD2Loader.js`);return{MD2Loader:e}},[],import.meta.url),i=new r().parse(n),a=new D.MeshStandardMaterial,s=new D.Mesh(i,a);s.mixer=new D.AnimationMixer(s),s.name=o,s.animations.push(...i.animations),e.execute(new G(e,s))},!1),c.readAsArrayBuffer(t);break;case`obj`:c.addEventListener(`load`,async function(t){let n=t.target.result,{OBJLoader:r}=await T(async()=>{let{OBJLoader:e}=await import(`three/addons/loaders/OBJLoader.js`);return{OBJLoader:e}},[],import.meta.url),i=new r().parse(n);i.name=o,e.execute(new G(e,i))},!1),c.readAsText(t);break;case`pcd`:c.addEventListener(`load`,async function(t){let n=t.target.result,{PCDLoader:r}=await T(async()=>{let{PCDLoader:e}=await import(`three/addons/loaders/PCDLoader.js`);return{PCDLoader:e}},[],import.meta.url),i=new r().parse(n);i.name=o,e.execute(new G(e,i))},!1),c.readAsArrayBuffer(t);break;case`ply`:c.addEventListener(`load`,async function(t){let n=t.target.result,{PLYLoader:r}=await T(async()=>{let{PLYLoader:e}=await import(`three/addons/loaders/PLYLoader.js`);return{PLYLoader:e}},[],import.meta.url),i=new r().parse(n),a;if(i.index!==null){let e=new D.MeshStandardMaterial;a=new D.Mesh(i,e),a.name=o}else{let e=new D.PointsMaterial({size:.01});e.vertexColors=i.hasAttribute(`color`),a=new D.Points(i,e),a.name=o}e.execute(new G(e,a))},!1),c.readAsArrayBuffer(t);break;case`stl`:c.addEventListener(`load`,async function(t){let n=t.target.result,{STLLoader:r}=await T(async()=>{let{STLLoader:e}=await import(`three/addons/loaders/STLLoader.js`);return{STLLoader:e}},[],import.meta.url),i=new r().parse(n),a=new D.MeshStandardMaterial,s=new D.Mesh(i,a);s.name=o,e.execute(new G(e,s))},!1),c.readAsBinaryString===void 0?c.readAsArrayBuffer(t):c.readAsBinaryString(t);break;case`svg`:c.addEventListener(`load`,async function(t){let n=t.target.result,{SVGLoader:r}=await T(async()=>{let{SVGLoader:e}=await import(`three/addons/loaders/SVGLoader.js`);return{SVGLoader:e}},[],import.meta.url),i=new r().parse(n).paths,a=new D.Group;a.name=o,a.scale.multiplyScalar(.1),a.scale.y*=-1;for(let e=0;e<i.length;e++){let t=i[e],n=new D.MeshBasicMaterial({color:t.color,depthWrite:!1}),o=r.createShapes(t);for(let e=0;e<o.length;e++){let t=o[e],r=new D.ShapeGeometry(t),i=new D.Mesh(r,n);a.add(i)}}e.execute(new G(e,a))},!1),c.readAsText(t);break;case`usd`:case`usda`:case`usdc`:case`usdz`:c.addEventListener(`load`,async function(t){let n=t.target.result,{USDLoader:r}=await T(async()=>{let{USDLoader:e}=await import(`three/addons/loaders/USDLoader.js`);return{USDLoader:e}},[],import.meta.url),i=new r(a).parse(n);i.name=o,e.execute(new G(e,i))},!1),c.readAsArrayBuffer(t);break;case`vox`:c.addEventListener(`load`,async function(t){let n=t.target.result,{VOXLoader:r}=await T(async()=>{let{VOXLoader:e}=await import(`three/addons/loaders/VOXLoader.js`);return{VOXLoader:e}},[],import.meta.url),{scene:i}=new r().parse(n);i.name=o,e.execute(new G(e,i))},!1),c.readAsArrayBuffer(t);break;case`vtk`:case`vtp`:c.addEventListener(`load`,async function(t){let n=t.target.result,{VTKLoader:r}=await T(async()=>{let{VTKLoader:e}=await import(`three/addons/loaders/VTKLoader.js`);return{VTKLoader:e}},[],import.meta.url),i=new r().parse(n),a=new D.MeshStandardMaterial,s=new D.Mesh(i,a);s.name=o,e.execute(new G(e,s))},!1),c.readAsArrayBuffer(t);break;case`wrl`:c.addEventListener(`load`,async function(t){let n=t.target.result,{VRMLLoader:r}=await T(async()=>{let{VRMLLoader:e}=await import(`three/addons/loaders/VRMLLoader.js`);return{VRMLLoader:e}},[],import.meta.url),i=new r().parse(n);e.execute(new G(e,i))},!1),c.readAsText(t);break;case`xyz`:c.addEventListener(`load`,async function(t){let n=t.target.result,{XYZLoader:r}=await T(async()=>{let{XYZLoader:e}=await import(`three/addons/loaders/XYZLoader.js`);return{XYZLoader:e}},[],import.meta.url),i=new r().parse(n),a=new D.PointsMaterial;a.vertexColors=i.hasAttribute(`color`);let s=new D.Points(i,a);s.name=o,e.execute(new G(e,s))},!1),c.readAsText(t);break;case`zip`:c.addEventListener(`load`,function(e){r(e.target.result)},!1),c.readAsArrayBuffer(t);break;case`bmp`:case`gif`:case`jpg`:case`jpeg`:case`png`:case`tga`:break;default:console.error(`Unsupported file format (`+s+`).`);break}};function n(n){switch(n.metadata===void 0&&(n.metadata={type:`Geometry`}),n.metadata.type===void 0&&(n.metadata.type=`Geometry`),n.metadata.formatVersion!==void 0&&(n.metadata.version=n.metadata.formatVersion),n.metadata.type.toLowerCase()){case`buffergeometry`:{let t=new D.BufferGeometryLoader().parse(n),r=new D.Mesh(t);e.execute(new G(e,r));break}case`geometry`:console.error(`Loader: "Geometry" is no longer supported.`);break;case`object`:{let r=new D.ObjectLoader;r.setResourcePath(t.texturePath),r.parse(n,function(t){e.execute(new G(e,t))});break}case`app`:e.fromJSON(n);break}}async function r(t){let n=oe(new Uint8Array(t)),r=new D.LoadingManager;if(r.setURLModifier(function(e){let t=n[e];if(t){console.log(`Loading`,e);let n=new Blob([t.buffer],{type:`application/octet-stream`});return URL.createObjectURL(n)}return e}),n[`model.obj`]&&n[`materials.mtl`]){let{MTLLoader:t}=await T(async()=>{let{MTLLoader:e}=await import(`three/addons/loaders/MTLLoader.js`);return{MTLLoader:e}},[],import.meta.url),{OBJLoader:i}=await T(async()=>{let{OBJLoader:e}=await import(`three/addons/loaders/OBJLoader.js`);return{OBJLoader:e}},[],import.meta.url),a=new t(r).parse(U(n[`materials.mtl`])),o=new i().setMaterials(a).parse(U(n[`model.obj`]));e.execute(new G(e,o));return}for(let t in n){let a=n[t];switch(t.split(`.`).pop().toLowerCase()){case`fbx`:{let{FBXLoader:t}=await T(async()=>{let{FBXLoader:e}=await import(`three/addons/loaders/FBXLoader.js`);return{FBXLoader:e}},[],import.meta.url),n=new t(r).parse(a.buffer);e.execute(new G(e,n));break}case`glb`:try{let t=await new Me(e.strings).show(),n=await i();n.parse(a.buffer,``,function(r){let i=r.scene;i.animations.push(...r.animations),t.asScene?e.execute(new Ae(e,i)):e.execute(new G(e,i)),n.dracoLoader.dispose(),n.ktx2Loader.dispose()})}catch{}break;case`gltf`:try{let t=await new Me(e.strings).show(),n=await i(r);n.parse(U(a),``,function(r){let i=r.scene;i.animations.push(...r.animations),t.asScene?e.execute(new Ae(e,i)):e.execute(new G(e,i)),n.dracoLoader.dispose(),n.ktx2Loader.dispose()})}catch{}break}}}async function i(t){let{GLTFLoader:n}=await T(async()=>{let{GLTFLoader:e}=await import(`three/addons/loaders/GLTFLoader.js`);return{GLTFLoader:e}},[],import.meta.url),{DRACOLoader:r}=await T(async()=>{let{DRACOLoader:e}=await import(`three/addons/loaders/DRACOLoader.js`);return{DRACOLoader:e}},[],import.meta.url),{KTX2Loader:i}=await T(async()=>{let{KTX2Loader:e}=await import(`three/addons/loaders/KTX2Loader.js`);return{KTX2Loader:e}},[],import.meta.url),{MeshoptDecoder:a}=await T(async()=>{let{MeshoptDecoder:e}=await import(`three/addons/libs/meshopt_decoder.module.js`);return{MeshoptDecoder:e}},[],import.meta.url),o=new r;o.setDecoderPath(x(`draco/gltf/`));let s=new i(t);s.setTranscoderPath(x(`basis/`)),e.signals.rendererDetectKTX2Support.dispatch(s);let c=new n(t);return c.setDRACOLoader(o),c.setKTX2Loader(s),c.setMeshoptDecoder(a),c}}var Pe=class extends d{constructor(e,t=null,n=``){super(e),this.type=`AddScriptCommand`,this.name=e.strings.getKey(`command/AddScript`),this.object=t,this.script=n}execute(){this.editor.scripts[this.object.uuid]===void 0&&(this.editor.scripts[this.object.uuid]=[]),this.editor.scripts[this.object.uuid].push(this.script),this.editor.signals.scriptAdded.dispatch(this.script)}undo(){if(this.editor.scripts[this.object.uuid]===void 0)return;let e=this.editor.scripts[this.object.uuid].indexOf(this.script);e!==-1&&this.editor.scripts[this.object.uuid].splice(e,1),this.editor.signals.scriptRemoved.dispatch(this.script)}toJSON(){let e=super.toJSON(this);return e.objectUuid=this.object.uuid,e.script=this.script,e}fromJSON(e){super.fromJSON(e),this.script=e.script,this.object=this.editor.objectByUuid(e.objectUuid)}},Fe=class extends d{constructor(e,t=[]){super(e),this.type=`MultiCmdsCommand`,this.name=e.strings.getKey(`command/MultiCmds`),this.cmdArray=t}execute(){this.editor.signals.sceneGraphChanged.active=!1;for(let e=0;e<this.cmdArray.length;e++)this.cmdArray[e].execute();this.editor.signals.sceneGraphChanged.active=!0,this.editor.signals.sceneGraphChanged.dispatch()}undo(){this.editor.signals.sceneGraphChanged.active=!1;for(let e=this.cmdArray.length-1;e>=0;e--)this.cmdArray[e].undo();this.editor.signals.sceneGraphChanged.active=!0,this.editor.signals.sceneGraphChanged.dispatch()}toJSON(){let e=super.toJSON(this),t=[];for(let e=0;e<this.cmdArray.length;e++)t.push(this.cmdArray[e].toJSON());return e.cmds=t,e}fromJSON(e){super.fromJSON(e);let t=e.cmds;for(let e=0;e<t.length;e++){let n=new window[t[e].type];n.fromJSON(t[e]),this.cmdArray.push(n)}}},q=class extends d{constructor(e,t=null){super(e),this.type=`RemoveObjectCommand`,this.object=t,this.parent=t===null?null:t.parent,this.parent!==null&&(this.index=this.parent.children.indexOf(this.object)),t!==null&&(this.name=e.strings.getKey(`command/RemoveObject`)+`: `+t.name)}execute(){this.editor.removeObject(this.object),this.editor.deselect()}undo(){this.editor.addObject(this.object,this.parent,this.index),this.editor.select(this.object)}toJSON(){let e=super.toJSON(this);return e.object=this.object.toJSON(),e.index=this.index,e.parentUuid=this.parent.uuid,e}fromJSON(e){super.fromJSON(e),this.parent=this.editor.objectByUuid(e.parentUuid),this.parent===void 0&&(this.parent=this.editor.scene),this.index=e.index,this.object=this.editor.objectByUuid(e.object.object.uuid),this.object===void 0&&(this.object=new L().parse(e.object))}},J=class extends d{constructor(e,t=null,n=``){super(e),this.type=`RemoveScriptCommand`,this.name=e.strings.getKey(`command/RemoveScript`),this.object=t,this.script=n,this.object!==null&&this.script!==``&&(this.index=this.editor.scripts[this.object.uuid].indexOf(this.script))}execute(){this.editor.scripts[this.object.uuid]!==void 0&&(this.index!==-1&&this.editor.scripts[this.object.uuid].splice(this.index,1),this.editor.signals.scriptRemoved.dispatch(this.script))}undo(){this.editor.scripts[this.object.uuid]===void 0&&(this.editor.scripts[this.object.uuid]=[]),this.editor.scripts[this.object.uuid].splice(this.index,0,this.script),this.editor.signals.scriptAdded.dispatch(this.script)}toJSON(){let e=super.toJSON(this);return e.objectUuid=this.object.uuid,e.script=this.script,e.index=this.index,e}fromJSON(e){super.fromJSON(e),this.script=e.script,this.index=e.index,this.object=this.editor.objectByUuid(e.objectUuid)}},Ie=class extends d{constructor(e,t=null,n=``,r=null){super(e),this.type=`SetColorCommand`,this.name=e.strings.getKey(`command/SetColor`)+`: `+n,this.updatable=!0,this.object=t,this.attributeName=n,this.oldValue=t===null?null:this.object[this.attributeName].getHex(),this.newValue=r}execute(){this.object[this.attributeName].setHex(this.newValue),this.editor.signals.objectChanged.dispatch(this.object)}undo(){this.object[this.attributeName].setHex(this.oldValue),this.editor.signals.objectChanged.dispatch(this.object)}update(e){this.newValue=e.newValue}toJSON(){let e=super.toJSON(this);return e.objectUuid=this.object.uuid,e.attributeName=this.attributeName,e.oldValue=this.oldValue,e.newValue=this.newValue,e}fromJSON(e){super.fromJSON(e),this.object=this.editor.objectByUuid(e.objectUuid),this.attributeName=e.attributeName,this.oldValue=e.oldValue,this.newValue=e.newValue}},Y=class extends d{constructor(e,t=null,n=``,r=null){super(e),this.type=`SetGeometryValueCommand`,this.name=e.strings.getKey(`command/SetGeometryValue`)+`: `+n,this.object=t,this.attributeName=n,this.oldValue=t===null?null:t.geometry[n],this.newValue=r}execute(){this.object.geometry[this.attributeName]=this.newValue,this.editor.signals.objectChanged.dispatch(this.object),this.editor.signals.geometryChanged.dispatch(),this.editor.signals.sceneGraphChanged.dispatch()}undo(){this.object.geometry[this.attributeName]=this.oldValue,this.editor.signals.objectChanged.dispatch(this.object),this.editor.signals.geometryChanged.dispatch(),this.editor.signals.sceneGraphChanged.dispatch()}toJSON(){let e=super.toJSON(this);return e.objectUuid=this.object.uuid,e.attributeName=this.attributeName,e.oldValue=this.oldValue,e.newValue=this.newValue,e}fromJSON(e){super.fromJSON(e),this.object=this.editor.objectByUuid(e.objectUuid),this.attributeName=e.attributeName,this.oldValue=e.oldValue,this.newValue=e.newValue}},Le=class extends d{constructor(e,t=null,n=``,r=null,i=-1){super(e),this.type=`SetMaterialColorCommand`,this.name=e.strings.getKey(`command/SetMaterialColor`)+`: `+n,this.updatable=!0,this.object=t,this.materialSlot=i;let a=t===null?null:e.getObjectMaterial(t,i);this.oldValue=a===null?null:a[n].getHex(),this.newValue=r,this.attributeName=n}execute(){this.editor.getObjectMaterial(this.object,this.materialSlot)[this.attributeName].setHex(this.newValue),this.editor.signals.materialChanged.dispatch(this.object,this.materialSlot)}undo(){this.editor.getObjectMaterial(this.object,this.materialSlot)[this.attributeName].setHex(this.oldValue),this.editor.signals.materialChanged.dispatch(this.object,this.materialSlot)}update(e){this.newValue=e.newValue}toJSON(){let e=super.toJSON(this);return e.objectUuid=this.object.uuid,e.attributeName=this.attributeName,e.oldValue=this.oldValue,e.newValue=this.newValue,e.materialSlot=this.materialSlot,e}fromJSON(e){super.fromJSON(e),this.object=this.editor.objectByUuid(e.objectUuid),this.attributeName=e.attributeName,this.oldValue=e.oldValue,this.newValue=e.newValue,this.materialSlot=e.materialSlot}},Re=class extends d{constructor(e,t=null,n=null,r=-1){super(e),this.type=`SetMaterialCommand`,this.name=e.strings.getKey(`command/SetMaterial`),this.object=t,this.materialSlot=r,this.oldMaterial=t===null?null:e.getObjectMaterial(t,r),this.newMaterial=n}execute(){this.editor.setObjectMaterial(this.object,this.materialSlot,this.newMaterial),this.editor.signals.materialChanged.dispatch(this.object,this.materialSlot)}undo(){this.editor.setObjectMaterial(this.object,this.materialSlot,this.oldMaterial),this.editor.signals.materialChanged.dispatch(this.object,this.materialSlot)}toJSON(){let e=super.toJSON(this);return e.objectUuid=this.object.uuid,e.oldMaterial=this.oldMaterial.toJSON(),e.newMaterial=this.newMaterial.toJSON(),e.materialSlot=this.materialSlot,e}fromJSON(e){super.fromJSON(e),this.object=this.editor.objectByUuid(e.objectUuid),this.oldMaterial=t(e.oldMaterial),this.newMaterial=t(e.newMaterial),this.materialSlot=e.materialSlot;function t(e){let t=new L,n=t.parseImages(e.images),r=t.parseTextures(e.textures,n);return t.parseMaterials([e],r)[e.uuid]}}},ze=class extends d{constructor(e,t=null,n=``,r=null,i=-1){super(e),this.type=`SetMaterialMapCommand`,this.name=e.strings.getKey(`command/SetMaterialMap`)+`: `+n,this.object=t,this.materialSlot=i;let a=t===null?null:e.getObjectMaterial(t,i);this.oldMap=t===null?void 0:a[n],this.newMap=r,this.mapName=n}execute(){this.oldMap!==null&&this.oldMap!==void 0&&this.oldMap.dispose();let e=this.editor.getObjectMaterial(this.object,this.materialSlot);e[this.mapName]=this.newMap,e.needsUpdate=!0,this.editor.signals.materialChanged.dispatch(this.object,this.materialSlot)}undo(){let e=this.editor.getObjectMaterial(this.object,this.materialSlot);e[this.mapName]=this.oldMap,e.needsUpdate=!0,this.editor.signals.materialChanged.dispatch(this.object,this.materialSlot)}toJSON(){let e=super.toJSON(this);return e.objectUuid=this.object.uuid,e.mapName=this.mapName,e.newMap=t(this.newMap),e.oldMap=t(this.oldMap),e.materialSlot=this.materialSlot,e;function t(e){if(e==null)return null;let t={geometries:{},materials:{},textures:{},images:{}},r=e.toJSON(t),i=n(t.images);return i.length>0&&(r.images=i),r.sourceFile=e.sourceFile,r}function n(e){let t=[];for(let n in e){let r=e[n];delete r.metadata,t.push(r)}return t}}fromJSON(e){super.fromJSON(e),this.object=this.editor.objectByUuid(e.objectUuid),this.mapName=e.mapName,this.oldMap=t(e.oldMap),this.newMap=t(e.newMap),this.materialSlot=e.materialSlot;function t(e){let t=null;if(e!==null){let n=new L,r=n.parseImages(e.images);t=n.parseTextures([e],r)[e.uuid],t.sourceFile=e.sourceFile}return t}}},Be=class extends d{constructor(e,t=null,n=``,r=-1/0,i=1/0,a=-1){super(e),this.type=`SetMaterialRangeCommand`,this.name=e.strings.getKey(`command/SetMaterialRange`)+`: `+n,this.updatable=!0,this.object=t,this.materialSlot=a;let o=t===null?null:e.getObjectMaterial(t,a);this.oldRange=o!==null&&o[n]!==void 0?[...o[n]]:null,this.newRange=[r,i],this.attributeName=n}execute(){let e=this.editor.getObjectMaterial(this.object,this.materialSlot);e[this.attributeName]=[...this.newRange],e.needsUpdate=!0,this.editor.signals.objectChanged.dispatch(this.object),this.editor.signals.materialChanged.dispatch(this.object,this.materialSlot)}undo(){let e=this.editor.getObjectMaterial(this.object,this.materialSlot);e[this.attributeName]=[...this.oldRange],e.needsUpdate=!0,this.editor.signals.objectChanged.dispatch(this.object),this.editor.signals.materialChanged.dispatch(this.object,this.materialSlot)}update(e){this.newRange=[...e.newRange]}toJSON(){let e=super.toJSON(this);return e.objectUuid=this.object.uuid,e.attributeName=this.attributeName,e.oldRange=[...this.oldRange],e.newRange=[...this.newRange],e.materialSlot=this.materialSlot,e}fromJSON(e){super.fromJSON(e),this.attributeName=e.attributeName,this.oldRange=[...e.oldRange],this.newRange=[...e.newRange],this.object=this.editor.objectByUuid(e.objectUuid),this.materialSlot=e.materialSlot}},Ve=class extends d{constructor(e,t=null,n=``,r=null,i=-1){super(e),this.type=`SetMaterialValueCommand`,this.name=e.strings.getKey(`command/SetMaterialValue`)+`: `+n,this.updatable=!0,this.object=t,this.materialSlot=i;let a=t===null?null:e.getObjectMaterial(t,i);this.oldValue=a===null?null:a[n],this.newValue=r,this.attributeName=n}execute(){let e=this.editor.getObjectMaterial(this.object,this.materialSlot);e[this.attributeName]=this.newValue,e.needsUpdate=!0,this.editor.signals.objectChanged.dispatch(this.object),this.editor.signals.materialChanged.dispatch(this.object,this.materialSlot)}undo(){let e=this.editor.getObjectMaterial(this.object,this.materialSlot);e[this.attributeName]=this.oldValue,e.needsUpdate=!0,this.editor.signals.objectChanged.dispatch(this.object),this.editor.signals.materialChanged.dispatch(this.object,this.materialSlot)}update(e){this.newValue=e.newValue}toJSON(){let e=super.toJSON(this);return e.objectUuid=this.object.uuid,e.attributeName=this.attributeName,e.oldValue=this.oldValue,e.newValue=this.newValue,e.materialSlot=this.materialSlot,e}fromJSON(e){super.fromJSON(e),this.attributeName=e.attributeName,this.oldValue=e.oldValue,this.newValue=e.newValue,this.object=this.editor.objectByUuid(e.objectUuid),this.materialSlot=e.materialSlot}},He=class extends d{constructor(e,t=null,n=``,r=null,i=-1){super(e),this.type=`SetMaterialVectorCommand`,this.name=e.strings.getKey(`command/SetMaterialVector`)+`: `+n,this.updatable=!0,this.object=t,this.materialSlot=i;let a=t===null?null:e.getObjectMaterial(t,i);this.oldValue=a===null?null:a[n].toArray(),this.newValue=r,this.attributeName=n}execute(){this.editor.getObjectMaterial(this.object,this.materialSlot)[this.attributeName].fromArray(this.newValue),this.editor.signals.materialChanged.dispatch(this.object,this.materialSlot)}undo(){this.editor.getObjectMaterial(this.object,this.materialSlot)[this.attributeName].fromArray(this.oldValue),this.editor.signals.materialChanged.dispatch(this.object,this.materialSlot)}update(e){this.newValue=e.newValue}toJSON(){let e=super.toJSON(this);return e.objectUuid=this.object.uuid,e.attributeName=this.attributeName,e.oldValue=this.oldValue,e.newValue=this.newValue,e.materialSlot=this.materialSlot,e}fromJSON(e){super.fromJSON(e),this.object=this.editor.objectByUuid(e.objectUuid),this.attributeName=e.attributeName,this.oldValue=e.oldValue,this.newValue=e.newValue,this.materialSlot=e.materialSlot}},Ue=class extends d{constructor(e,t=null,n=null,r=null){super(e),this.type=`SetPositionCommand`,this.name=e.strings.getKey(`command/SetPosition`),this.updatable=!0,this.object=t,t!==null&&n!==null&&(this.oldPosition=t.position.clone(),this.newPosition=n.clone()),r!==null&&(this.oldPosition=r.clone())}execute(){this.object.position.copy(this.newPosition),this.object.updateMatrixWorld(!0),this.editor.signals.objectChanged.dispatch(this.object)}undo(){this.object.position.copy(this.oldPosition),this.object.updateMatrixWorld(!0),this.editor.signals.objectChanged.dispatch(this.object)}update(e){this.newPosition.copy(e.newPosition)}toJSON(){let e=super.toJSON(this);return e.objectUuid=this.object.uuid,e.oldPosition=this.oldPosition.toArray(),e.newPosition=this.newPosition.toArray(),e}fromJSON(e){super.fromJSON(e),this.object=this.editor.objectByUuid(e.objectUuid),this.oldPosition=new B().fromArray(e.oldPosition),this.newPosition=new B().fromArray(e.newPosition)}},We=class extends d{constructor(e,t=null,n=null,r=null){super(e),this.type=`SetRotationCommand`,this.name=e.strings.getKey(`command/SetRotation`),this.updatable=!0,this.object=t,t!==null&&n!==null&&(this.oldRotation=t.rotation.clone(),this.newRotation=n.clone()),r!==null&&(this.oldRotation=r.clone())}execute(){this.object.rotation.copy(this.newRotation),this.object.updateMatrixWorld(!0),this.editor.signals.objectChanged.dispatch(this.object)}undo(){this.object.rotation.copy(this.oldRotation),this.object.updateMatrixWorld(!0),this.editor.signals.objectChanged.dispatch(this.object)}update(e){this.newRotation.copy(e.newRotation)}toJSON(){let e=super.toJSON(this);return e.objectUuid=this.object.uuid,e.oldRotation=this.oldRotation.toArray(),e.newRotation=this.newRotation.toArray(),e}fromJSON(e){super.fromJSON(e),this.object=this.editor.objectByUuid(e.objectUuid),this.oldRotation=new M().fromArray(e.oldRotation),this.newRotation=new M().fromArray(e.newRotation)}},Ge=class extends d{constructor(e,t=null,n=null,r=null){super(e),this.type=`SetScaleCommand`,this.name=e.strings.getKey(`command/SetScale`),this.updatable=!0,this.object=t,t!==null&&n!==null&&(this.oldScale=t.scale.clone(),this.newScale=n.clone()),r!==null&&(this.oldScale=r.clone())}execute(){this.object.scale.copy(this.newScale),this.object.updateMatrixWorld(!0),this.editor.signals.objectChanged.dispatch(this.object)}undo(){this.object.scale.copy(this.oldScale),this.object.updateMatrixWorld(!0),this.editor.signals.objectChanged.dispatch(this.object)}update(e){this.newScale.copy(e.newScale)}toJSON(){let e=super.toJSON(this);return e.objectUuid=this.object.uuid,e.oldScale=this.oldScale.toArray(),e.newScale=this.newScale.toArray(),e}fromJSON(e){super.fromJSON(e),this.object=this.editor.objectByUuid(e.objectUuid),this.oldScale=new B().fromArray(e.oldScale),this.newScale=new B().fromArray(e.newScale)}},Ke=class extends d{constructor(e,t=null,n=``,r=``,i=null){super(e),this.type=`SetScriptValueCommand`,this.name=e.strings.getKey(`command/SetScriptValue`)+`: `+r,this.updatable=!0,this.object=t,this.script=n,this.attributeName=r,this.oldValue=n===``?null:n[this.attributeName],this.newValue=i}execute(){this.script[this.attributeName]=this.newValue,this.editor.signals.scriptChanged.dispatch(this.script)}undo(){this.script[this.attributeName]=this.oldValue,this.editor.signals.scriptChanged.dispatch(this.script)}update(e){this.newValue=e.newValue}toJSON(){let e=super.toJSON(this);return e.objectUuid=this.object.uuid,e.index=this.editor.scripts[this.object.uuid].indexOf(this.script),e.attributeName=this.attributeName,e.oldValue=this.oldValue,e.newValue=this.newValue,e}fromJSON(e){super.fromJSON(e),this.oldValue=e.oldValue,this.newValue=e.newValue,this.attributeName=e.attributeName,this.object=this.editor.objectByUuid(e.objectUuid),this.script=this.editor.scripts[e.objectUuid][e.index]}},qe=class extends d{constructor(e,t=null,n=``,r=null){super(e),this.type=`SetShadowValueCommand`,this.name=e.strings.getKey(`command/SetShadowValue`)+`: `+n,this.updatable=!0,this.object=t,this.attributeName=n,this.oldValue=t===null?null:t.shadow[n],this.newValue=r}execute(){this.object.shadow[this.attributeName]=this.newValue,this.editor.signals.objectChanged.dispatch(this.object)}undo(){this.object.shadow[this.attributeName]=this.oldValue,this.editor.signals.objectChanged.dispatch(this.object)}update(e){this.newValue=e.newValue}toJSON(){let e=super.toJSON(this);return e.objectUuid=this.object.uuid,e.attributeName=this.attributeName,e.oldValue=this.oldValue,e.newValue=this.newValue,e}fromJSON(e){super.fromJSON(e),this.object=this.editor.objectByUuid(e.objectUuid),this.attributeName=e.attributeName,this.oldValue=e.oldValue,this.newValue=e.newValue}},Je=we({AddObjectCommand:()=>G,AddScriptCommand:()=>Pe,MoveObjectCommand:()=>w,MultiCmdsCommand:()=>Fe,RemoveObjectCommand:()=>q,RemoveScriptCommand:()=>J,SetColorCommand:()=>Ie,SetGeometryCommand:()=>g,SetGeometryValueCommand:()=>Y,SetMaterialColorCommand:()=>Le,SetMaterialCommand:()=>Re,SetMaterialMapCommand:()=>ze,SetMaterialRangeCommand:()=>Be,SetMaterialValueCommand:()=>Ve,SetMaterialVectorCommand:()=>He,SetPositionCommand:()=>Ue,SetRotationCommand:()=>We,SetScaleCommand:()=>Ge,SetSceneCommand:()=>Ae,SetScriptValueCommand:()=>Ke,SetShadowValueCommand:()=>qe,SetUuidCommand:()=>ke,SetValueCommand:()=>K}),Ye=class{constructor(e){this.editor=e,this.undos=[],this.redos=[],this.lastCmdTime=Date.now(),this.idCounter=0,this.historyDisabled=!1,this.config=e.config;let t=this;this.editor.signals.startPlayer.add(function(){t.historyDisabled=!0}),this.editor.signals.stopPlayer.add(function(){t.historyDisabled=!1})}execute(e,t){let n=this.undos[this.undos.length-1],r=Date.now()-this.lastCmdTime,i=n&&n.updatable&&e.updatable&&n.object===e.object&&n.type===e.type&&n.script===e.script&&n.attributeName===e.attributeName;i&&e.type===`SetScriptValueCommand`||i&&r<500?(n.update(e),e=n):(this.undos.push(e),e.id=++this.idCounter),e.name=t===void 0?e.name:t,e.execute(),e.inMemory=!0,this.config.getKey(`settings/history`)&&(e.json=e.toJSON()),this.lastCmdTime=Date.now(),this.redos=[],this.editor.signals.historyChanged.dispatch(e)}undo(){if(this.historyDisabled){alert(this.editor.strings.getKey(`prompt/history/forbid`));return}let e;return this.undos.length>0&&(e=this.undos.pop(),e.inMemory===!1&&e.fromJSON(e.json)),e!==void 0&&(e.undo(),this.redos.push(e),this.editor.signals.historyChanged.dispatch(e)),e}redo(){if(this.historyDisabled){alert(this.editor.strings.getKey(`prompt/history/forbid`));return}let e;return this.redos.length>0&&(e=this.redos.pop(),e.inMemory===!1&&e.fromJSON(e.json)),e!==void 0&&(e.execute(),this.undos.push(e),this.editor.signals.historyChanged.dispatch(e)),e}toJSON(){let e={};if(e.undos=[],e.redos=[],!this.config.getKey(`settings/history`))return e;for(let t=0;t<this.undos.length;t++)this.undos[t].hasOwnProperty(`json`)&&e.undos.push(this.undos[t].json);for(let t=0;t<this.redos.length;t++)this.redos[t].hasOwnProperty(`json`)&&e.redos.push(this.redos[t].json);return e}fromJSON(e){if(e!==void 0){for(let t=0;t<e.undos.length;t++){let n=e.undos[t],r=new Je[n.type](this.editor);r.json=n,r.id=n.id,r.name=n.name,this.undos.push(r),this.idCounter=n.id>this.idCounter?n.id:this.idCounter}for(let t=0;t<e.redos.length;t++){let n=e.redos[t],r=new Je[n.type](this.editor);r.json=n,r.id=n.id,r.name=n.name,this.redos.push(r),this.idCounter=n.id>this.idCounter?n.id:this.idCounter}this.editor.signals.historyChanged.dispatch(this.undos[this.undos.length-1])}}clear(){this.undos=[],this.redos=[],this.idCounter=0,this.editor.signals.historyChanged.dispatch()}goToState(e){if(this.historyDisabled){alert(this.editor.strings.getKey(`prompt/history/forbid`));return}this.editor.signals.sceneGraphChanged.active=!1,this.editor.signals.historyChanged.active=!1;let t=this.undos.length>0?this.undos[this.undos.length-1]:void 0;if(t===void 0||e>t.id)for(t=this.redo();t!==void 0&&e>t.id;)t=this.redo();else for(;t=this.undos[this.undos.length-1],!(t===void 0||e===t.id);)this.undo();this.editor.signals.sceneGraphChanged.active=!0,this.editor.signals.historyChanged.active=!0,this.editor.signals.sceneGraphChanged.dispatch(),this.editor.signals.historyChanged.dispatch(t)}enableSerialization(e){this.goToState(-1),this.editor.signals.sceneGraphChanged.active=!1,this.editor.signals.historyChanged.active=!1;let t=this.redo();for(;t!==void 0;)t.hasOwnProperty(`json`)||(t.json=t.toJSON()),t=this.redo();this.editor.signals.sceneGraphChanged.active=!0,this.editor.signals.historyChanged.active=!0,this.goToState(e)}},Xe={en:()=>T(()=>import(`./Strings.en-DwS5ktMm.js`),[],import.meta.url),fa:()=>T(()=>import(`./Strings.fa-bCmMbSz4.js`),[],import.meta.url),fr:()=>T(()=>import(`./Strings.fr-sE2IiNn_.js`),[],import.meta.url),ja:()=>T(()=>import(`./Strings.ja-BPbdVCwt.js`),[],import.meta.url),ko:()=>T(()=>import(`./Strings.ko-CJB9x6VR.js`),[],import.meta.url),zh:()=>T(()=>import(`./Strings.zh-Dpf0YbF5.js`),[],import.meta.url)};function Ze(e,t){let n=e.getKey(`language`),r={};function i(e=`zh`){return Xe[e]().then(n=>{r[e]=n.default,t?.()})}return i(n),{getKey:function(e){return r[n][e]||`???`}}}function Qe(){let e=window.indexedDB;if(e===void 0)return console.warn(`Storage: IndexedDB not available.`),{init:function(){},get:function(){},set:function(){},clear:function(){}};let t;return{init:function(n){let r=e.open(`threejs-editor`,1);r.onupgradeneeded=function(e){let t=e.target.result;t.objectStoreNames.contains(`states`)===!1&&t.createObjectStore(`states`)},r.onsuccess=function(e){t=e.target.result,n()},r.onerror=function(e){console.error(`IndexedDB`,e)}},get:function(e){let n=t.transaction([`states`],`readonly`).objectStore(`states`).get(0);n.onsuccess=function(t){e(t.target.result)}},set:function(e){let n=performance.now(),r=t.transaction([`states`],`readwrite`).objectStore(`states`).put(e,0);r.onsuccess=function(){console.log(`[`+/\d\d\:\d\d\:\d\d/.exec(new Date)[0]+`]`,`Saved state to IndexedDB. `+(performance.now()-n).toFixed(2)+`ms`)}},clear:function(){if(t===void 0)return;let e=t.transaction([`states`],`readwrite`).objectStore(`states`).clear();e.onsuccess=function(){console.log(`[`+/\d\d\:\d\d\:\d\d/.exec(new Date)[0]+`]`,`Cleared IndexedDB.`)}}}}var $e=new D.Vector2,et=new D.Raycaster,tt=class{constructor(e){let t=e.signals;this.editor=e,this.signals=t,t.intersectionsDetected.add(t=>{if(t.length>0){let n=[];for(let e=0;e<t.length;e++){let r=t[e].object;r.userData.object!==void 0&&(r=r.userData.object),n.indexOf(r)===-1&&n.push(r)}let r=n.indexOf(e.selected);r!==-1&&r<n.length-1?this.select(n[r+1]):this.select(n[0])}else this.select(null)})}getIntersects(e){let t=[];return this.editor.scene.traverseVisible(function(e){t.push(e)}),this.editor.sceneHelpers.traverseVisible(function(e){e.name===`picker`&&t.push(e)}),e.intersectObjects(t,!1)}getPointerIntersects(e,t){return $e.set(e.x*2-1,-(e.y*2)+1),et.setFromCamera($e,t),this.getIntersects(et)}select(e){if(this.editor.selected===e)return;let t=null;e!==null&&(t=e.uuid),this.editor.selected=e,this.editor.config.setKey(`selected`,t),this.signals.objectSelected.dispatch(e)}deselect(){this.select(null)}};function nt(e,t,n,r,i){this._listener=t,this._isOnce=n,this.context=r,this._signal=e,this._priority=i||0}nt.prototype={active:!0,params:null,execute:function(e){var t,n;return this.active&&this._listener&&(n=this.params?this.params.concat(e):e,t=this._listener.apply(this.context,n),this._isOnce&&this.detach()),t},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal,delete this._listener,delete this.context},toString:function(){return`[SignalBinding isOnce:`+this._isOnce+`, isBound:`+this.isBound()+`, active:`+this.active+`]`}};function rt(e,t){if(typeof e!=`function`)throw Error(`listener is a required param of {fn}() and should be a Function.`.replace(`{fn}`,t))}function X(){this._bindings=[],this._prevParams=null;var e=this;this.dispatch=function(){X.prototype.dispatch.apply(e,arguments)}}X.prototype={VERSION:`1.0.0`,memorize:!1,_shouldPropagate:!0,active:!0,_registerListener:function(e,t,n,r){var i=this._indexOfListener(e,n),a;if(i!==-1){if(a=this._bindings[i],a.isOnce()!==t)throw Error(`You cannot add`+(t?``:`Once`)+`() then add`+(t?`Once`:``)+`() the same listener without removing the relationship first.`)}else a=new nt(this,e,t,n,r),this._addBinding(a);return this.memorize&&this._prevParams&&a.execute(this._prevParams),a},_addBinding:function(e){var t=this._bindings.length;do--t;while(this._bindings[t]&&e._priority<=this._bindings[t]._priority);this._bindings.splice(t+1,0,e)},_indexOfListener:function(e,t){for(var n=this._bindings.length,r;n--;)if(r=this._bindings[n],r._listener===e&&r.context===t)return n;return-1},has:function(e,t){return this._indexOfListener(e,t)!==-1},add:function(e,t,n){return rt(e,`add`),this._registerListener(e,!1,t,n)},addOnce:function(e,t,n){return rt(e,`addOnce`),this._registerListener(e,!0,t,n)},remove:function(e,t){rt(e,`remove`);var n=this._indexOfListener(e,t);return n!==-1&&(this._bindings[n]._destroy(),this._bindings.splice(n,1)),e},removeAll:function(){for(var e=this._bindings.length;e--;)this._bindings[e]._destroy();this._bindings.length=0},getNumListeners:function(){return this._bindings.length},halt:function(){this._shouldPropagate=!1},dispatch:function(e){if(this.active){var t=Array.prototype.slice.call(arguments),n=this._bindings.length,r;if(this.memorize&&(this._prevParams=t),n){r=this._bindings.slice(),this._shouldPropagate=!0;do n--;while(r[n]&&this._shouldPropagate&&r[n].execute(t)!==!1)}}},forget:function(){this._prevParams=null},dispose:function(){this.removeAll(),delete this._bindings,delete this._prevParams},toString:function(){return`[Signal active:`+this.active+` numListeners:`+this.getNumListeners()+`]`}};var it=new D.PerspectiveCamera(50,1,.001,1e10);it.name=`Camera`,it.position.set(0,5,10),it.lookAt(new D.Vector3);function at(){let e=Oe();this._initAsync=()=>Promise.all([e.promise]),this.signals={editScript:new X,startPlayer:new X,stopPlayer:new X,enterXR:new X,offerXR:new X,leaveXR:new X,editorCleared:new X,savingStarted:new X,savingFinished:new X,transformModeChanged:new X,snapChanged:new X,spaceChanged:new X,rendererCreated:new X,rendererUpdated:new X,rendererDetectKTX2Support:new X,sceneBackgroundChanged:new X,sceneEnvironmentChanged:new X,sceneFogChanged:new X,sceneFogSettingsChanged:new X,sceneGraphChanged:new X,sceneRendered:new X,cameraChanged:new X,cameraResetted:new X,geometryChanged:new X,objectSelected:new X,objectFocused:new X,objectAdded:new X,objectChanged:new X,objectRemoved:new X,cameraAdded:new X,cameraRemoved:new X,helperAdded:new X,helperRemoved:new X,materialAdded:new X,materialChanged:new X,materialRemoved:new X,scriptAdded:new X,scriptChanged:new X,scriptRemoved:new X,windowResize:new X,showHelpersChanged:new X,refreshSidebarObject3D:new X,historyChanged:new X,viewportCameraChanged:new X,viewportShadingChanged:new X,intersectionsDetected:new X,pathTracerUpdated:new X,animationPanelChanged:new X,animationPanelResized:new X,morphTargetsUpdated:new X,sceneBeforeRender:new X,scriptCreated:new X},this.config=new De,this.history=new Ye(this),this.selector=new tt(this),this.storage=new Qe,this.strings=new Ze(this.config,e.resolve),this.loader=new Ne(this),this.renderer=null,this.render=()=>{},this.camera=it.clone(),this.scene=new D.Scene,this.scene.name=`Scene`,this.sceneHelpers=new D.Scene,this.sceneHelpers.add(new D.HemisphereLight(16777215,8947848,2)),this.backgroundType=`Default`,this.environmentType=`Default`,this.object={},this.geometries={},this.materials={},this.textures={},this.scripts={},this.materialsRefCounter=new Map,this.mixer=new D.AnimationMixer(this.scene),this.selected=null,this.helpers={},this.cameras={},this.viewportCamera=this.camera,this.viewportShading=`default`,this.viewportColor=new D.Color,this.addCamera(this.camera)}at.prototype={setScene:function(e){for(this.scene.uuid=e.uuid,this.scene.name=e.name,this.scene.background=e.background,this.scene.environment=e.environment,this.scene.fog=e.fog,this.scene.backgroundBlurriness=e.backgroundBlurriness,this.scene.backgroundIntensity=e.backgroundIntensity,this.scene.userData=JSON.parse(JSON.stringify(e.userData)),this.signals.sceneGraphChanged.active=!1;e.children.length>0;)this.addObject(e.children[0]);this.signals.sceneGraphChanged.active=!0,this.signals.sceneGraphChanged.dispatch(),this.signals.sceneEnvironmentChanged.dispatch(this.environmentType,e.environment)},addObject:function(e,t,n){var r=this;e.traverse(function(e){e.geometry!==void 0&&r.addGeometry(e.geometry),e.material!==void 0&&r.addMaterial(e.material),r.addCamera(e),r.addHelper(e)}),t===void 0?this.scene.add(e):(t.children.splice(n,0,e),e.parent=t),this.signals.objectAdded.dispatch(e),this.signals.sceneGraphChanged.dispatch()},nameObject:function(e,t){e.name=t,this.signals.sceneGraphChanged.dispatch()},removeObject:function(e){if(e.parent!==null){var t=this;e.traverse(function(e){t.removeCamera(e),t.removeHelper(e),e.material!==void 0&&t.removeMaterial(e.material)}),e.parent.remove(e),this.signals.objectRemoved.dispatch(e),this.signals.sceneGraphChanged.dispatch()}},addGeometry:function(e){this.geometries[e.uuid]=e},setGeometryName:function(e,t){e.name=t,this.signals.sceneGraphChanged.dispatch()},addMaterial:function(e){if(Array.isArray(e))for(var t=0,n=e.length;t<n;t++)this.addMaterialToRefCounter(e[t]);else this.addMaterialToRefCounter(e);this.signals.materialAdded.dispatch()},addMaterialToRefCounter:function(e){var t=this.materialsRefCounter,n=t.get(e);n===void 0?(t.set(e,1),this.materials[e.uuid]=e):(n++,t.set(e,n))},removeMaterial:function(e){if(Array.isArray(e))for(var t=0,n=e.length;t<n;t++)this.removeMaterialFromRefCounter(e[t]);else this.removeMaterialFromRefCounter(e);this.signals.materialRemoved.dispatch()},removeMaterialFromRefCounter:function(e){var t=this.materialsRefCounter,n=t.get(e);n--,n===0?(t.delete(e),delete this.materials[e.uuid]):t.set(e,n)},getMaterialById:function(e){for(var t,n=Object.values(this.materials),r=0;r<n.length;r++)if(n[r].id===e){t=n[r];break}return t},setMaterialName:function(e,t){e.name=t,this.signals.sceneGraphChanged.dispatch()},addTexture:function(e){this.textures[e.uuid]=e},addCamera:function(e){e.isCamera&&(this.cameras[e.uuid]=e,this.signals.cameraAdded.dispatch(e))},removeCamera:function(e){this.cameras[e.uuid]!==void 0&&(delete this.cameras[e.uuid],this.signals.cameraRemoved.dispatch(e))},addHelper:function(){var e=new D.SphereGeometry(2,4,2),t=new D.MeshBasicMaterial({color:16711680,visible:!1});return function(n,r){if(r===void 0){if(n.isCamera)r=new D.CameraHelper(n);else if(n.isPointLight){r=new D.PointLightHelper(n,1),r.matrix=new D.Matrix4,r.matrixAutoUpdate=!0;let e=n,t=this;r.updateMatrixWorld=function(){e.getWorldPosition(this.position);let n=t.viewportCamera.position.distanceTo(this.position);this.scale.setScalar(n/30),this.updateMatrix(),this.matrixWorld.copy(this.matrix);let r=this.children;for(let e=0,t=r.length;e<t;e++)r[e].updateMatrixWorld()}}else if(n.isDirectionalLight)r=new D.DirectionalLightHelper(n,1);else if(n.isSpotLight)r=new D.SpotLightHelper(n);else if(n.isHemisphereLight)r=new D.HemisphereLightHelper(n,1);else if(n.isSkinnedMesh)r=new D.SkeletonHelper(n.skeleton.bones[0]);else if(n.isBone===!0&&n.parent&&n.parent.isBone!==!0)r=new D.SkeletonHelper(n);else return;let i=new D.Mesh(e,t);i.name=`picker`,i.userData.object=n,r.add(i)}this.sceneHelpers.add(r),this.helpers[n.id]=r,this.signals.helperAdded.dispatch(r)}}(),removeHelper:function(e){if(this.helpers[e.id]!==void 0){var t=this.helpers[e.id];t.parent.remove(t),t.dispose(),delete this.helpers[e.id],this.signals.helperRemoved.dispatch(t)}},addScript:function(e,t){this.scripts[e.uuid]===void 0&&(this.scripts[e.uuid]=[]),this.scripts[e.uuid].push(t),this.signals.scriptAdded.dispatch(t)},removeScript:function(e,t){if(this.scripts[e.uuid]!==void 0){var n=this.scripts[e.uuid].indexOf(t);n!==-1&&this.scripts[e.uuid].splice(n,1),this.signals.scriptRemoved.dispatch(t)}},getObjectMaterial:function(e,t){var n=e.material;return Array.isArray(n)&&t!==void 0&&(n=n[t]),n},setObjectMaterial:function(e,t,n){Array.isArray(e.material)&&t!==void 0?e.material[t]=n:e.material=n},setViewportCamera:function(e){this.viewportCamera=this.cameras[e]||this.camera,this.signals.viewportCameraChanged.dispatch()},setViewportShading:function(e){this.viewportShading=e,this.signals.viewportShadingChanged.dispatch()},select:function(e){this.selector.select(e)},selectById:function(e){if(e===this.camera.id){this.select(this.camera);return}this.select(this.scene.getObjectById(e))},selectByUuid:function(e){var t=this;this.scene.traverse(function(n){n.uuid===e&&t.select(n)})},deselect:function(){this.selector.deselect()},focus:function(e){e!==void 0&&this.signals.objectFocused.dispatch(e)},focusById:function(e){this.focus(this.scene.getObjectById(e))},clear:function(){this.history.clear(),this.storage.clear(),this.camera.copy(it),this.signals.cameraResetted.dispatch(),this.scene.name=`Scene`,this.scene.userData={},this.scene.background=null,this.scene.environment=null,this.scene.fog=null;var e=this.scene.children;for(this.signals.sceneGraphChanged.active=!1;e.length>0;)this.removeObject(e[0]);this.signals.sceneGraphChanged.active=!0,this.geometries={},this.materials={},this.textures={},this.scripts={},this.materialsRefCounter.clear(),this.animations={},this.mixer.stopAllAction(),this.deselect(),this.backgroundType=`Default`,this.environmentType=`Default`,this.signals.editorCleared.dispatch()},fromJSON:async function(e){var t=new D.ObjectLoader,n=await t.parseAsync(e.camera);let r=this.camera.uuid,i=n.uuid;this.camera.copy(n),this.camera.uuid=i,delete this.cameras[r],this.cameras[i]=this.camera,e.controls!==void 0&&this.controls.fromJSON(e.controls),this.signals.cameraResetted.dispatch(),this.history.fromJSON(e.history),this.scripts=e.scripts;let a=await t.parseAsync(e.scene);this.backgroundType=e.backgroundType||`Default`,this.environmentType=e.environmentType||`Default`,this.setScene(a)},toJSON:function(){var e=this.scene,t=this.scripts;for(var n in t)(t[n].length===0||e.getObjectByProperty(`uuid`,n)===void 0)&&delete t[n];return{metadata:{},project:{renderer:this.config.getKey(`project/renderer/type`),shadows:this.config.getKey(`project/renderer/shadows`),shadowType:this.config.getKey(`project/renderer/shadowType`),toneMapping:this.config.getKey(`project/renderer/toneMapping`),toneMappingExposure:this.config.getKey(`project/renderer/toneMappingExposure`)},camera:this.viewportCamera.toJSON(),controls:this.controls.toJSON(),scene:this.scene.toJSON(),scripts:this.scripts,history:this.history.toJSON(),backgroundType:this.backgroundType,environmentType:this.environmentType}},objectByUuid:function(e){return this.scene.getObjectByProperty(`uuid`,e,!0)},execute:function(e,t){this.history.execute(e,t)},undo:function(){this.history.undo()},redo:function(){this.history.redo()},utils:{save:st,saveArrayBuffer:ct,saveString:lt,formatNumber:ut}};var ot=document.createElement(`a`);function st(e,t){ot.href&&URL.revokeObjectURL(ot.href),ot.href=URL.createObjectURL(e),ot.download=t||`data.json`,ot.dispatchEvent(new MouseEvent(`click`))}function ct(e,t){st(new Blob([e],{type:`application/octet-stream`}),t)}function lt(e,t){st(new Blob([e],{type:`text/plain`}),t)}function ut(e){return new Intl.NumberFormat(`en-us`,{useGrouping:!0}).format(e)}function dt(e){let t=e.strings,n=new u;n.setClass(`menu`);let r=new u;r.setClass(`title`),r.setTextContent(t.getKey(`menubar/add`)),n.add(r);let i=new u;i.setClass(`options`),n.add(i);let a=new s;a.setClass(`option`),a.setTextContent(t.getKey(`menubar/add/group`)),a.onClick(function(){let t=new D.Group;t.name=`Group`,e.execute(new G(e,t))}),i.add(a);let o=new s().setTextContent(t.getKey(`menubar/add/mesh`)).addClass(`option`).addClass(`submenu-title`);o.onMouseOver(function(){let{top:e,right:t}=o.dom.getBoundingClientRect(),{paddingTop:n}=getComputedStyle(this.dom);c.setLeft(t+`px`),c.setTop(e-parseFloat(n)+`px`),c.setStyle(`max-height`,[`calc( 100vh - ${e}px )`]),c.setDisplay(`block`)}),o.onMouseOut(function(){c.setDisplay(`none`)}),i.add(o);let c=new u().setPosition(`fixed`).addClass(`options`).setDisplay(`none`);o.add(c),a=new s,a.setClass(`option`),a.setTextContent(t.getKey(`menubar/add/mesh/box`)),a.onClick(function(){let t=new D.BoxGeometry(1,1,1,1,1,1),n=new D.Mesh(t,new D.MeshStandardMaterial);n.name=`Box`,e.execute(new G(e,n))}),c.add(a),a=new s,a.setClass(`option`),a.setTextContent(t.getKey(`menubar/add/mesh/capsule`)),a.onClick(function(){let t=new D.CapsuleGeometry(1,1,4,8,1),n=new D.MeshStandardMaterial,r=new D.Mesh(t,n);r.name=`Capsule`,e.execute(new G(e,r))}),c.add(a),a=new s,a.setClass(`option`),a.setTextContent(t.getKey(`menubar/add/mesh/circle`)),a.onClick(function(){let t=new D.CircleGeometry(1,32,0,Math.PI*2),n=new D.Mesh(t,new D.MeshStandardMaterial);n.name=`Circle`,e.execute(new G(e,n))}),c.add(a),a=new s,a.setClass(`option`),a.setTextContent(t.getKey(`menubar/add/mesh/cylinder`)),a.onClick(function(){let t=new D.CylinderGeometry(1,1,1,32,1,!1,0,Math.PI*2),n=new D.Mesh(t,new D.MeshStandardMaterial);n.name=`Cylinder`,e.execute(new G(e,n))}),c.add(a),a=new s,a.setClass(`option`),a.setTextContent(t.getKey(`menubar/add/mesh/dodecahedron`)),a.onClick(function(){let t=new D.DodecahedronGeometry(1,0),n=new D.Mesh(t,new D.MeshStandardMaterial);n.name=`Dodecahedron`,e.execute(new G(e,n))}),c.add(a),a=new s,a.setClass(`option`),a.setTextContent(t.getKey(`menubar/add/mesh/icosahedron`)),a.onClick(function(){let t=new D.IcosahedronGeometry(1,0),n=new D.Mesh(t,new D.MeshStandardMaterial);n.name=`Icosahedron`,e.execute(new G(e,n))}),c.add(a),a=new s,a.setClass(`option`),a.setTextContent(t.getKey(`menubar/add/mesh/lathe`)),a.onClick(function(){let t=new D.LatheGeometry,n=new D.Mesh(t,new D.MeshStandardMaterial({side:D.DoubleSide}));n.name=`Lathe`,e.execute(new G(e,n))}),c.add(a),a=new s,a.setClass(`option`),a.setTextContent(t.getKey(`menubar/add/mesh/octahedron`)),a.onClick(function(){let t=new D.OctahedronGeometry(1,0),n=new D.Mesh(t,new D.MeshStandardMaterial);n.name=`Octahedron`,e.execute(new G(e,n))}),c.add(a),a=new s,a.setClass(`option`),a.setTextContent(t.getKey(`menubar/add/mesh/plane`)),a.onClick(function(){let t=new D.PlaneGeometry(1,1,1,1),n=new D.MeshStandardMaterial,r=new D.Mesh(t,n);r.name=`Plane`,e.execute(new G(e,r))}),c.add(a),a=new s,a.setClass(`option`),a.setTextContent(t.getKey(`menubar/add/mesh/ring`)),a.onClick(function(){let t=new D.RingGeometry(.5,1,32,1,0,Math.PI*2),n=new D.Mesh(t,new D.MeshStandardMaterial);n.name=`Ring`,e.execute(new G(e,n))}),c.add(a),a=new s,a.setClass(`option`),a.setTextContent(t.getKey(`menubar/add/mesh/sphere`)),a.onClick(function(){let t=new D.SphereGeometry(1,32,16,0,Math.PI*2,0,Math.PI),n=new D.Mesh(t,new D.MeshStandardMaterial);n.name=`Sphere`,e.execute(new G(e,n))}),c.add(a),a=new s,a.setClass(`option`),a.setTextContent(t.getKey(`menubar/add/mesh/sprite`)),a.onClick(function(){let t=new D.Sprite(new D.SpriteMaterial);t.name=`Sprite`,e.execute(new G(e,t))}),c.add(a),a=new s,a.setClass(`option`),a.setTextContent(t.getKey(`menubar/add/mesh/tetrahedron`)),a.onClick(function(){let t=new D.TetrahedronGeometry(1,0),n=new D.Mesh(t,new D.MeshStandardMaterial);n.name=`Tetrahedron`,e.execute(new G(e,n))}),c.add(a),a=new s,a.setClass(`option`),a.setTextContent(t.getKey(`menubar/add/mesh/torus`)),a.onClick(function(){let t=new D.TorusGeometry(1,.4,12,48,Math.PI*2),n=new D.Mesh(t,new D.MeshStandardMaterial);n.name=`Torus`,e.execute(new G(e,n))}),c.add(a),a=new s,a.setClass(`option`),a.setTextContent(t.getKey(`menubar/add/mesh/torusknot`)),a.onClick(function(){let t=new D.TorusKnotGeometry(1,.4,64,8,2,3),n=new D.Mesh(t,new D.MeshStandardMaterial);n.name=`TorusKnot`,e.execute(new G(e,n))}),c.add(a),a=new s,a.setClass(`option`),a.setTextContent(t.getKey(`menubar/add/mesh/tube`)),a.onClick(function(){let t=new D.CatmullRomCurve3([new D.Vector3(2,2,-2),new D.Vector3(2,-2,-.6666666666666667),new D.Vector3(-2,-2,.6666666666666667),new D.Vector3(-2,2,2)]),n=new D.TubeGeometry(t,64,1,8,!1),r=new D.Mesh(n,new D.MeshStandardMaterial);r.name=`Tube`,e.execute(new G(e,r))}),c.add(a);let l=new s().setTextContent(t.getKey(`menubar/add/light`)).addClass(`option`).addClass(`submenu-title`);l.onMouseOver(function(){let{top:e,right:t}=l.dom.getBoundingClientRect(),{paddingTop:n}=getComputedStyle(this.dom);d.setLeft(t+`px`),d.setTop(e-parseFloat(n)+`px`),d.setStyle(`max-height`,[`calc( 100vh - ${e}px )`]),d.setDisplay(`block`)}),l.onMouseOut(function(){d.setDisplay(`none`)}),i.add(l);let d=new u().setPosition(`fixed`).addClass(`options`).setDisplay(`none`);l.add(d),a=new s,a.setClass(`option`),a.setTextContent(t.getKey(`menubar/add/light/ambient`)),a.onClick(function(){let t=new D.AmbientLight(2236962);t.name=`AmbientLight`,e.execute(new G(e,t))}),d.add(a),a=new s,a.setClass(`option`),a.setTextContent(t.getKey(`menubar/add/light/directional`)),a.onClick(function(){let t=new D.DirectionalLight(16777215,1);t.name=`DirectionalLight`,t.target.name=`DirectionalLight Target`,t.position.set(5,10,7.5),e.execute(new G(e,t))}),d.add(a),a=new s,a.setClass(`option`),a.setTextContent(t.getKey(`menubar/add/light/hemisphere`)),a.onClick(function(){let t=new D.HemisphereLight(43775,16755200,1);t.name=`HemisphereLight`,t.position.set(0,10,0),e.execute(new G(e,t))}),d.add(a),a=new s,a.setClass(`option`),a.setTextContent(t.getKey(`menubar/add/light/point`)),a.onClick(function(){let t=new D.PointLight(16777215,1,0);t.name=`PointLight`,e.execute(new G(e,t))}),d.add(a),a=new s,a.setClass(`option`),a.setTextContent(t.getKey(`menubar/add/light/spot`)),a.onClick(function(){let t=Math.PI*.1,n=new D.SpotLight(16777215,1,0,t,0);n.name=`SpotLight`,n.target.name=`SpotLight Target`,n.position.set(5,10,7.5),e.execute(new G(e,n))}),d.add(a);let f=new s().setTextContent(t.getKey(`menubar/add/camera`)).addClass(`option`).addClass(`submenu-title`);f.onMouseOver(function(){let{top:e,right:t}=f.dom.getBoundingClientRect(),{paddingTop:n}=getComputedStyle(this.dom);p.setLeft(t+`px`),p.setTop(e-parseFloat(n)+`px`),p.setStyle(`max-height`,[`calc( 100vh - ${e}px )`]),p.setDisplay(`block`)}),f.onMouseOut(function(){p.setDisplay(`none`)}),i.add(f);let p=new u().setPosition(`fixed`).addClass(`options`).setDisplay(`none`);return f.add(p),a=new s,a.setClass(`option`),a.setTextContent(t.getKey(`menubar/add/camera/orthographic`)),a.onClick(function(){let t=e.camera.aspect,n=new D.OrthographicCamera(-t,t);n.name=`OrthographicCamera`,e.execute(new G(e,n))}),p.add(a),a=new s,a.setClass(`option`),a.setTextContent(t.getKey(`menubar/add/camera/perspective`)),a.onClick(function(){let t=new D.PerspectiveCamera;t.name=`PerspectiveCamera`,e.execute(new G(e,t))}),p.add(a),n}function ft(e){let t=e.strings,n=new u;n.setClass(`menu`);let r=new u;r.setClass(`title`),r.setTextContent(t.getKey(`menubar/edit`)),n.add(r);let i=new u;i.setClass(`options`),n.add(i);let a=new s;a.setClass(`option`),a.setTextContent(t.getKey(`menubar/edit/undo`)),a.add(new y(`CTRL+Z`).setClass(`key`)),a.onClick(function(){e.undo()}),i.add(a);let o=new s;o.setClass(`option`),o.setTextContent(t.getKey(`menubar/edit/redo`)),o.add(new y(`CTRL+SHIFT+Z`).setClass(`key`)),o.onClick(function(){e.redo()}),i.add(o);function c(){let t=e.history;a.setClass(`option`),o.setClass(`option`),t.undos.length==0&&a.setClass(`inactive`),t.redos.length==0&&o.setClass(`inactive`)}e.signals.historyChanged.add(c),c(),i.add(new l);let d=new s;return d.setClass(`option`),d.setTextContent(t.getKey(`menubar/edit/center`)),d.onClick(function(){let t=e.selected;if(t===null||t.parent===null)return;let n=new O().setFromObject(t).getCenter(new B),r=new B;r.x=t.position.x-n.x,r.y=t.position.y-n.y,r.z=t.position.z-n.z,e.execute(new Ue(e,t,r))}),i.add(d),d=new s,d.setClass(`option`),d.setTextContent(t.getKey(`menubar/edit/clone`)),d.onClick(function(){let t=e.selected;t===null||t.parent===null||(t=ce(t),e.execute(new G(e,t)))}),i.add(d),d=new s,d.setClass(`option`),d.setTextContent(t.getKey(`menubar/edit/delete`)),d.add(new y(`DEL`).setClass(`key`)),d.onClick(function(){let t=e.selected;t!==null&&t.parent!==null&&e.execute(new q(e,t))}),i.add(d),n}function pt(e){let t=e.strings,n=e.utils.saveArrayBuffer,r=e.utils.saveString,i=new u;i.setClass(`menu`);let a=new u;a.setClass(`title`),a.setTextContent(t.getKey(`menubar/file`)),i.add(a);let o=new u;o.setClass(`options`),i.add(o);let c=new s().setTextContent(t.getKey(`menubar/file/new`)).addClass(`option`).addClass(`submenu-title`);c.onMouseOver(function(){let{top:e,right:t}=this.dom.getBoundingClientRect(),{paddingTop:n}=getComputedStyle(this.dom);d.setLeft(t+`px`),d.setTop(e-parseFloat(n)+`px`),d.setDisplay(`block`)}),c.onMouseOut(function(){d.setDisplay(`none`)}),o.add(c);let d=new u().setPosition(`fixed`).addClass(`options`).setDisplay(`none`);c.add(d);let f=new s().setTextContent(t.getKey(`menubar/file/new/empty`)).setClass(`option`);f.onClick(function(){confirm(t.getKey(`prompt/file/open`))&&e.clear()}),d.add(f),d.add(new l);let p=[{title:`menubar/file/new/Arkanoid`,file:`arkanoid.app.json`},{title:`menubar/file/new/Camera`,file:`camera.app.json`},{title:`menubar/file/new/Particles`,file:`particles.app.json`},{title:`menubar/file/new/Pong`,file:`pong.app.json`},{title:`menubar/file/new/Shaders`,file:`shaders.app.json`}],m=new N;for(let n=0;n<p.length;n++)(function(n){let r=p[n],i=new s;i.setClass(`option`),i.setTextContent(t.getKey(r.title)),i.onClick(function(){confirm(t.getKey(`prompt/file/open`))&&m.load(`examples/`+r.file,function(t){e.clear(),e.fromJSON(JSON.parse(t))})}),d.add(i)})(n);let h=document.createElement(`form`);h.style.display=`none`,document.body.appendChild(h);let g=document.createElement(`input`);g.multiple=!1,g.type=`file`,g.accept=`.json`,g.addEventListener(`change`,async function(){let n=g.files[0];if(n!==void 0)try{let t=JSON.parse(await n.text());async function r(){await e.fromJSON(t),e.signals.editorCleared.remove(r)}e.signals.editorCleared.add(r),e.clear()}catch(e){alert(t.getKey(`prompt/file/failedToOpenProject`)),console.error(e)}finally{_.reset()}}),h.appendChild(g),f=new s().addClass(`option`).setTextContent(t.getKey(`menubar/file/open`)).onClick(function(){confirm(t.getKey(`prompt/file/open`))&&g.click()}),o.add(f),f=new s().addClass(`option`).setTextContent(t.getKey(`menubar/file/save`)).onClick(function(){let t=e.toJSON(),n=new Blob([JSON.stringify(t)],{type:`application/json`});e.utils.save(n,`project.json`)}),o.add(f),o.add(new l);let _=document.createElement(`form`);_.style.display=`none`,document.body.appendChild(_);let v=document.createElement(`input`);v.multiple=!0,v.type=`file`,v.addEventListener(`change`,function(){e.loader.loadFiles(v.files),_.reset()}),_.appendChild(v),f=new s,f.setClass(`option`),f.setTextContent(t.getKey(`menubar/file/import`)),f.onClick(function(){v.click()}),o.add(f);let y=new s().setTextContent(t.getKey(`menubar/file/export`)).addClass(`option`).addClass(`submenu-title`);y.onMouseOver(function(){let{top:e,right:t}=this.dom.getBoundingClientRect(),{paddingTop:n}=getComputedStyle(this.dom);b.setLeft(t+`px`),b.setTop(e-parseFloat(n)+`px`),b.setDisplay(`block`)}),y.onMouseOut(function(){b.setDisplay(`none`)}),o.add(y);let b=new u().setPosition(`fixed`).addClass(`options`).setDisplay(`none`);y.add(b),f=new s,f.setClass(`option`),f.setTextContent(`DRC`),f.onClick(async function(){let r=e.selected;if(r===null||r.isMesh===void 0){alert(t.getKey(`prompt/file/export/noMeshSelected`));return}let{DRACOExporter:i}=await T(async()=>{let{DRACOExporter:e}=await import(`three/addons/exporters/DRACOExporter.js`);return{DRACOExporter:e}},[],import.meta.url),a=new i,o={decodeSpeed:5,encodeSpeed:5,encoderMethod:i.MESH_EDGEBREAKER_ENCODING,quantization:[16,8,8,8,8],exportUvs:!0,exportNormals:!0,exportColor:r.geometry.hasAttribute(`color`)};n(a.parse(r,o),`model.drc`)}),b.add(f),f=new s,f.setClass(`option`),f.setTextContent(`GLB`),f.onClick(async function(){let t=e.scene,r=x(t),i=[];for(let e of r)i.push(e.clone().optimize());let{GLTFExporter:a}=await T(async()=>{let{GLTFExporter:e}=await import(`three/addons/exporters/GLTFExporter.js`);return{GLTFExporter:e}},[],import.meta.url);new a().parse(t,function(e){n(e,`scene.glb`)},void 0,{binary:!0,animations:i})}),b.add(f),f=new s,f.setClass(`option`),f.setTextContent(`GLTF`),f.onClick(async function(){let t=e.scene,n=x(t),i=[];for(let e of n)i.push(e.clone().optimize());let{GLTFExporter:a}=await T(async()=>{let{GLTFExporter:e}=await import(`three/addons/exporters/GLTFExporter.js`);return{GLTFExporter:e}},[],import.meta.url);new a().parse(t,function(e){r(JSON.stringify(e,null,2),`scene.gltf`)},void 0,{animations:i})}),b.add(f),f=new s,f.setClass(`option`),f.setTextContent(`OBJ`),f.onClick(async function(){let n=e.selected;if(n===null){alert(t.getKey(`prompt/file/export/noObjectSelected`));return}let{OBJExporter:i}=await T(async()=>{let{OBJExporter:e}=await import(`three/addons/exporters/OBJExporter.js`);return{OBJExporter:e}},[],import.meta.url);r(new i().parse(n),`model.obj`)}),b.add(f),f=new s,f.setClass(`option`),f.setTextContent(`PLY`),f.onClick(async function(){let{PLYExporter:t}=await T(async()=>{let{PLYExporter:e}=await import(`three/addons/exporters/PLYExporter.js`);return{PLYExporter:e}},[],import.meta.url);new t().parse(e.scene,function(e){n(e,`model.ply`)})}),b.add(f),f=new s,f.setClass(`option`),f.setTextContent(`PLY (BINARY)`),f.onClick(async function(){let{PLYExporter:t}=await T(async()=>{let{PLYExporter:e}=await import(`three/addons/exporters/PLYExporter.js`);return{PLYExporter:e}},[],import.meta.url);new t().parse(e.scene,function(e){n(e,`model-binary.ply`)},{binary:!0})}),b.add(f),f=new s,f.setClass(`option`),f.setTextContent(`STL`),f.onClick(async function(){let{STLExporter:t}=await T(async()=>{let{STLExporter:e}=await import(`three/addons/exporters/STLExporter.js`);return{STLExporter:e}},[],import.meta.url);r(new t().parse(e.scene),`model.stl`)}),b.add(f),f=new s,f.setClass(`option`),f.setTextContent(`STL (BINARY)`),f.onClick(async function(){let{STLExporter:t}=await T(async()=>{let{STLExporter:e}=await import(`three/addons/exporters/STLExporter.js`);return{STLExporter:e}},[],import.meta.url);n(new t().parse(e.scene,{binary:!0}),`model-binary.stl`)}),b.add(f),f=new s,f.setClass(`option`),f.setTextContent(`USDZ`),f.onClick(async function(){let{USDZExporter:t}=await T(async()=>{let{USDZExporter:e}=await import(`three/addons/exporters/USDZExporter.js`);return{USDZExporter:e}},[],import.meta.url);n(await new t().parseAsync(e.scene),`model.usdz`)}),b.add(f);function x(e){let t=[];return e.traverse(function(e){t.push(...e.animations)}),t}return i}function mt(e){let t=e.strings,n=new u;n.setClass(`menu`);let r=new u;r.setClass(`title`),r.setTextContent(t.getKey(`menubar/help`)),n.add(r);let i=new u;i.setClass(`options`),n.add(i);let a=new s;return a.setClass(`option`),a.setTextContent(t.getKey(`menubar/help/source_code`)),a.onClick(function(){window.open(`https://github.com/mrdoob/three.js/tree/master/editor`,`_blank`)}),i.add(a),a=new s,a.setClass(`option`),a.setTextContent(t.getKey(`menubar/help/about`)),a.onClick(function(){window.open(`https://threejs.org`,`_blank`)}),i.add(a),a=new s,a.setClass(`option`),a.setTextContent(t.getKey(`menubar/help/manual`)),a.onClick(function(){window.open(`https://github.com/mrdoob/three.js/wiki/Editor-Manual`,`_blank`)}),i.add(a),n}function ht(e){let t=e.signals,n=e.strings,r=new u;r.setClass(`menu`);let i=new u;i.setClass(`title`),i.setTextContent(n.getKey(`menubar/view`)),r.add(i);let a=new u;a.setClass(`options`),r.add(a);let o={gridHelper:!0,cameraHelpers:!0,lightHelpers:!0,skeletonHelpers:!0},c=new s().addClass(`option`).addClass(`toggle`).setTextContent(n.getKey(`menubar/view/gridHelper`)).onClick(function(){o.gridHelper=!o.gridHelper,this.toggleClass(`toggle-on`,o.gridHelper),t.showHelpersChanged.dispatch(o)}).toggleClass(`toggle-on`,o.gridHelper);return a.add(c),c=new s().addClass(`option`).addClass(`toggle`).setTextContent(n.getKey(`menubar/view/cameraHelpers`)).onClick(function(){o.cameraHelpers=!o.cameraHelpers,this.toggleClass(`toggle-on`,o.cameraHelpers),t.showHelpersChanged.dispatch(o)}).toggleClass(`toggle-on`,o.cameraHelpers),a.add(c),c=new s().addClass(`option`).addClass(`toggle`).setTextContent(n.getKey(`menubar/view/lightHelpers`)).onClick(function(){o.lightHelpers=!o.lightHelpers,this.toggleClass(`toggle-on`,o.lightHelpers),t.showHelpersChanged.dispatch(o)}).toggleClass(`toggle-on`,o.lightHelpers),a.add(c),c=new s().addClass(`option`).addClass(`toggle`).setTextContent(n.getKey(`menubar/view/skeletonHelpers`)).onClick(function(){o.skeletonHelpers=!o.skeletonHelpers,this.toggleClass(`toggle-on`,o.skeletonHelpers),t.showHelpersChanged.dispatch(o)}).toggleClass(`toggle-on`,o.skeletonHelpers),a.add(c),t.helperAdded.add(function(){t.showHelpersChanged.dispatch(o)}),a.add(new l),c=new s,c.setClass(`option`),c.setTextContent(n.getKey(`menubar/view/fullscreen`)),c.onClick(function(){document.fullscreenElement===null?document.documentElement.requestFullscreen():document.exitFullscreen&&document.exitFullscreen(),document.webkitFullscreenElement===null?document.documentElement.webkitRequestFullscreen():document.webkitExitFullscreen&&document.webkitExitFullscreen()}),a.add(c),`xr`in navigator&&(`offerSession`in navigator.xr?t.offerXR.dispatch(`immersive-ar`):navigator.xr.isSessionSupported(`immersive-ar`).then(function(e){if(e){let e=new s;e.setClass(`option`),e.setTextContent(`AR`),e.onClick(function(){t.enterXR.dispatch(`immersive-ar`)}),a.add(e)}else navigator.xr.isSessionSupported(`immersive-vr`).then(function(e){if(e){let e=new s;e.setClass(`option`),e.setTextContent(`VR`),e.onClick(function(){t.enterXR.dispatch(`immersive-vr`)}),a.add(e)}})})),r}function gt(e){let t=null;function n(n,r){t===null&&(t=new le(e),t.filterGlossyFactor=.5),t.setScene(n,r)}function r(){t!==null&&t.updateCamera()}function i(){t!==null&&t.updateEnvironment()}function a(){t!==null&&t.updateMaterials()}function o(){t!==null&&t.updateEnvironment()}function s(){t!==null&&t.renderSample()}function c(){t!==null&&t.updateCamera()}function l(){if(t!==null)return t.samples}return{init:n,setSize:r,setBackground:i,setEnvironment:o,updateMaterials:a,update:s,reset:c,getSamples:l}}var _t={Player:function(){let e,t=new D.ObjectLoader,n,r,i={},a=document.createElement(`div`);this.dom=a,this.canvas=null,this.width=500,this.height=500,this.load=async function(s){let c=s.project;if(e!==void 0&&(e.dispose(),a.removeChild(e.domElement),this.canvas=null),c.renderer===`WebGPURenderer`){let{WebGPURenderer:t}=await T(async()=>{let{WebGPURenderer:e}=await import(`three/webgpu`);return{WebGPURenderer:e}},[],import.meta.url);e=new t({antialias:!0,logarithmicDepthBuffer:!0}),await e.init()}else e=new D.WebGLRenderer({antialias:!0,logarithmicDepthBuffer:!0});e.setPixelRatio(window.devicePixelRatio),c.shadows!==void 0&&(e.shadowMap.enabled=c.shadows),c.shadowType!==void 0&&(e.shadowMap.type=c.shadowType),c.toneMapping!==void 0&&(e.toneMapping=c.toneMapping),c.toneMappingExposure!==void 0&&(e.toneMappingExposure=c.toneMappingExposure),a.appendChild(e.domElement),this.canvas=e.domElement,this.setScene(t.parse(s.scene)),this.setCamera(t.parse(s.camera)),i={init:[],start:[],stop:[],keydown:[],keyup:[],pointerdown:[],pointerup:[],pointermove:[],update:[]};let l=`player,renderer,scene,camera,THREE`,u={};for(var d in i)l+=`,`+d,u[d]=d;let f=JSON.stringify(u).replace(/\"/g,``);for(let t in s.scripts){let a=r.getObjectByProperty(`uuid`,t,!0);if(a===void 0){console.warn(`APP.Player: Script without object.`,t);continue}let o=s.scripts[t];for(let t=0;t<o.length;t++){let s=o[t],c=Function(l,s.source+`
return `+f+`;`).bind(a)(this,e,r,n,D);for(let e in c)if(c[e]!==void 0){if(i[e]===void 0){console.warn(`APP.Player: Event type not supported (`,e,`)`);continue}i[e].push(c[e].bind(a))}}}o(i.init,arguments)},this.setCamera=function(e){n=e,n.aspect=this.width/this.height,n.updateProjectionMatrix()},this.setScene=function(e){r=e},this.setPixelRatio=function(t){e.setPixelRatio(t)},this.setClearColor=function(t){e.setClearColor(t)},this.setSize=function(t,r){this.width=t,this.height=r,n&&(n.aspect=this.width/this.height,n.updateProjectionMatrix()),e&&e.setSize(t,r)};function o(e,t){for(let n=0,r=e.length;n<r;n++)e[n](t)}let s,c,l;function u(){s=performance.now();try{o(i.update,{time:s-c,delta:s-l})}catch(e){console.error(e.message||e,e.stack||``)}e.render(r,n),l=s}this.play=function(){c=l=performance.now(),document.addEventListener(`keydown`,d),document.addEventListener(`keyup`,f),document.addEventListener(`pointerdown`,p),document.addEventListener(`pointerup`,m),document.addEventListener(`pointermove`,h),o(i.start,arguments),e.setAnimationLoop(u)},this.stop=function(){document.removeEventListener(`keydown`,d),document.removeEventListener(`keyup`,f),document.removeEventListener(`pointerdown`,p),document.removeEventListener(`pointerup`,m),document.removeEventListener(`pointermove`,h),o(i.stop,arguments),e.setAnimationLoop(null)},this.render=function(t){o(i.update,{time:t*1e3,delta:0}),e.render(r,n)},this.dispose=function(){e&&e.dispose(),n=void 0,r=void 0};function d(e){o(i.keydown,e)}function f(e){o(i.keyup,e)}function p(e){o(i.pointerdown,e)}function m(e){o(i.pointerup,e)}function h(e){o(i.pointermove,e)}}};function vt(e){let t=e.strings,n=new u;n.setClass(`menu`);let r=new u;r.setClass(`title`),r.setTextContent(t.getKey(`menubar/render`)),n.add(r);let i=new u;i.setClass(`options`),n.add(i);let a=new s;a.setClass(`option`),a.setTextContent(t.getKey(`menubar/render/image`)),a.onClick(function(){o()}),i.add(a),`VideoEncoder`in window&&(a=new s,a.setClass(`option`),a.setTextContent(t.getKey(`menubar/render/video`)),a.onClick(function(){c()}),i.add(a));function o(){let n=new yt(e,t);document.body.appendChild(n.dom)}function c(){let n=new bt(e,t);document.body.appendChild(n.dom)}return n}var yt=class{constructor(e,t){let n=document.createElement(`div`);n.className=`Dialog`,this.dom=n;let r=document.createElement(`div`);r.className=`Dialog-background`,r.addEventListener(`click`,()=>this.close()),n.appendChild(r);let a=document.createElement(`div`);a.className=`Dialog-content`,n.appendChild(a);let l=document.createElement(`div`);l.className=`Dialog-title`,l.textContent=t.getKey(`menubar/render`)+` `+t.getKey(`menubar/render/image`),a.appendChild(l);let u=document.createElement(`div`);u.className=`Dialog-body`,a.appendChild(u);let d=new s;u.appendChild(d.dom),d.add(new y(t.getKey(`sidebar/project/shading`)).setClass(`Label`));let f=new o().setOptions({solid:`SOLID`,realistic:`REALISTIC`}).setWidth(`170px`).onChange(g).setValue(`solid`);d.add(f);let p=65536,m=new i(16).setRange(3,p),h=new s;h.add(new y(t.getKey(`sidebar/project/image/samples`)).setClass(`Label`)),h.add(m),u.appendChild(h.dom);function g(){h.setHidden(f.getValue()!==`realistic`)}g();let _=new s;u.appendChild(_.dom),_.add(new y(t.getKey(`sidebar/project/resolution`)).setClass(`Label`));let v=new i(1024).setTextAlign(`center`).setWidth(`28px`);_.add(v),_.add(new y(``).setTextAlign(`center`).setFontSize(`12px`).setWidth(`12px`));let b=new i(1024).setTextAlign(`center`).setWidth(`28px`);_.add(b);let x=document.createElement(`div`);x.className=`Dialog-buttons`,u.appendChild(x);let S=new c(t.getKey(`sidebar/project/render`));S.setWidth(`80px`),S.onClick(async()=>{if(f.getValue()===`realistic`){let n=!0;if(e.scene.traverseVisible(e=>{if(e.isMesh){let t=Array.isArray(e.material)?e.material:[e.material];for(let e=0;e<t.length;e++)if(!t[e].isMeshStandardMaterial){n=!1;return}}}),n===!1){alert(t.getKey(`prompt/rendering/realistic/unsupportedMaterial`));return}}let n=e.toJSON(),r=n.project,i=new D.ObjectLoader,a=await i.parseAsync(n.camera);a.aspect=v.getValue()/b.getValue(),a.updateProjectionMatrix(),a.updateMatrixWorld();let o=await i.parseAsync(n.scene),s=new D.WebGLRenderer({antialias:!0,logarithmicDepthBuffer:!0});s.setSize(v.getValue(),b.getValue()),s.setClearColor(e.viewportColor),r.shadows!==void 0&&(s.shadowMap.enabled=r.shadows),r.shadowType!==void 0&&(s.shadowMap.type=r.shadowType),r.toneMapping!==void 0&&(s.toneMapping=r.toneMapping),r.toneMappingExposure!==void 0&&(s.toneMappingExposure=r.toneMappingExposure);let c=v.getValue()/window.devicePixelRatio,l=b.getValue()/window.devicePixelRatio,u=(screen.width-c)/2,d=(screen.height-l)/2,h=window.open(``,`_blank`,`location=no,left=${u},top=${d},width=${c},height=${l}`),g=document.createElement(`meta`);g.name=`viewport`,g.content=`width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0`,h.document.head.appendChild(g),h.document.body.style.background=`#000`,h.document.body.style.margin=`0px`,h.document.body.style.overflow=`hidden`;let _=s.domElement;switch(_.style.width=c+`px`,_.style.height=l+`px`,h.document.body.appendChild(_),f.getValue()){case`solid`:s.render(o,a),s.dispose();break;case`realistic`:let e=document.createElement(`div`);e.style.position=`absolute`,e.style.top=`10px`,e.style.left=`10px`,e.style.color=`white`,e.style.fontFamily=`system-ui`,e.style.fontSize=`12px`,h.document.body.appendChild(e);let t=new gt(s);t.init(o,a),t.setSize(v.getValue(),b.getValue());let n=Math.max(3,Math.min(p,m.getValue()));function r(){if(h.closed===!0)return;let i=Math.floor(t.getSamples())+1;i<n&&requestAnimationFrame(r),t.update();let a=Math.floor(i/n*100);e.textContent=`${i} / ${n} ( ${a}% )`,a===100&&(e.textContent+=` `)}r();break}this.close()}),x.appendChild(S.dom);let C=new c(t.getKey(`menubar/render/cancel`));C.setWidth(`80px`),C.setMarginLeft(`8px`),C.onClick(()=>this.close()),x.appendChild(C.dom)}close(){this.dom.remove()}},bt=class{constructor(e,t){let n=document.createElement(`div`);n.className=`Dialog`,this.dom=n;let r=document.createElement(`div`);r.className=`Dialog-background`,r.addEventListener(`click`,()=>this.close()),n.appendChild(r);let a=document.createElement(`div`);a.className=`Dialog-content`,n.appendChild(a);let l=document.createElement(`div`);l.className=`Dialog-title`,l.textContent=t.getKey(`menubar/render`)+` `+t.getKey(`menubar/render/video`),a.appendChild(l);let u=document.createElement(`div`);u.className=`Dialog-body`,a.appendChild(u);function d(){this.setValue(2*Math.floor(this.getValue()/2))}let f=new s;u.appendChild(f.dom),f.add(new y(t.getKey(`sidebar/project/resolution`)).setClass(`Label`));let p=new i(1024).setTextAlign(`center`).setWidth(`28px`).setStep(2).onChange(d);f.add(p),f.add(new y(``).setTextAlign(`center`).setFontSize(`12px`).setWidth(`12px`));let m=new i(1024).setTextAlign(`center`).setWidth(`28px`).setStep(2).onChange(d);f.add(m);let h=new i(30).setTextAlign(`center`).setWidth(`20px`);f.add(h),f.add(new y(`fps`).setFontSize(`12px`));let g=new s;g.add(new y(t.getKey(`sidebar/project/duration`)).setClass(`Label`)),u.appendChild(g.dom);let _=new i(10);g.add(_);let v=new s;v.add(new y(t.getKey(`menubar/render/quality`)).setClass(`Label`)),u.appendChild(v.dom);let b=new o().setOptions({low:`Low`,medium:`Medium`,high:`High`,ultra:`Ultra`}).setWidth(`170px`).setValue(`high`);v.add(b);let x=document.createElement(`div`);x.className=`Dialog-buttons`,u.appendChild(x);let S=new c(t.getKey(`sidebar/project/render`));S.setWidth(`80px`),S.onClick(async()=>{let t=new _t.Player;await t.load(e.toJSON()),t.setPixelRatio(1),t.setSize(p.getValue(),m.getValue()),t.setClearColor(e.viewportColor);let n=p.getValue()/window.devicePixelRatio,r=m.getValue()/window.devicePixelRatio,i=t.canvas;i.style.width=n+`px`,i.style.height=r+`px`;let a=(screen.width-n)/2,o=(screen.height-r)/2,s=window.open(``,`_blank`,`location=no,left=${a},top=${o},width=${n},height=${r}`),c=document.createElement(`meta`);c.name=`viewport`,c.content=`width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0`,s.document.head.appendChild(c),s.document.body.style.background=`#000`,s.document.body.style.margin=`0px`,s.document.body.style.overflow=`hidden`,s.document.body.appendChild(i);let l=document.createElement(`div`);l.style.position=`absolute`,l.style.top=`10px`,l.style.left=`10px`,l.style.color=`white`,l.style.fontFamily=`system-ui`,l.style.fontSize=`12px`,l.style.textShadow=`0 0 2px black`,s.document.body.appendChild(l);let u=document.createElement(`video`);u.width=n,u.height=r,u.controls=!0,u.loop=!0,u.hidden=!0,s.document.body.appendChild(u),s.addEventListener(`unload`,function(){u.src.startsWith(`blob:`)&&URL.revokeObjectURL(u.src)});let d=h.getValue(),f=_.getValue()*d,g=[],v=null,y=new VideoEncoder({output:(e,t)=>{t?.decoderConfig?.description&&(v=new Uint8Array(t.decoderConfig.description));let n=new Uint8Array(e.byteLength);e.copyTo(n),g.push({data:n,timestamp:e.timestamp,type:e.type})},error:e=>console.error(`VideoEncoder error:`,e)});y.configure({codec:`avc1.640028`,width:p.getValue(),height:m.getValue(),bitrate:{low:2e6,medium:5e6,high:1e7,ultra:2e7}[b.getValue()],framerate:d,avc:{format:`avc`}});let x=0,S=!1;for(let e=0;e<f;e++){if(s.closed){S=!0;break}t.render(x);let n=await createImageBitmap(i),r=new VideoFrame(n,{timestamp:1e6/d*e});y.encode(r,{keyFrame:e%d===0}),r.close(),n.close(),x+=1/d;let a=Math.floor((e+1)/f*100);l.textContent=`${e+1} / ${f} ( ${a}% )`}if(!S){await y.flush(),y.close(),s.document.body.removeChild(i);let e=xt(g,v,p.getValue(),m.getValue(),d);l.textContent=`${f} / ${f} ( 100% ) ${St(e.byteLength)} \u2713`,u.src=URL.createObjectURL(new Blob([e],{type:`video/mp4`})),u.hidden=!1}t.dispose(),this.close()}),x.appendChild(S.dom);let C=new c(t.getKey(`menubar/render/cancel`));C.setWidth(`80px`),C.setMarginLeft(`8px`),C.onClick(()=>this.close()),x.appendChild(C.dom)}close(){this.dom.remove()}};function xt(e,t,n,r,i){let a=9e4,o=a/i;function s(e){return new Uint8Array([e>>24&255,e>>16&255,e>>8&255,e&255])}function c(e){return new Uint8Array([e>>8&255,e&255])}function l(e){return new TextEncoder().encode(e)}function u(...e){let t=e.reduce((e,t)=>e+t.length,0),n=new Uint8Array(t),r=0;for(let t of e)n.set(t,r),r+=t.length;return n}function d(e,...t){let n=u(...t);return u(s(n.length+8),l(e),n)}function f(e,t,n,...r){return d(e,new Uint8Array([t,n>>16&255,n>>8&255,n&255]),...r)}let p=d(`ftyp`,l(`isom`),s(512),l(`isom`),l(`iso2`),l(`avc1`),l(`mp41`)),m=[],h=[];for(let t=0;t<e.length;t++)m.push(e[t].data.length),e[t].type===`key`&&h.push(t+1);let g=8;for(let t of e)g+=t.data.length;let _=d(`avc1`,new Uint8Array(6),c(1),new Uint8Array(16),c(n),c(r),s(4718592),s(4718592),s(0),c(1),new Uint8Array(32),c(24),new Uint8Array([255,255]),d(`avcC`,t)),v=f(`stsd`,0,0,s(1),_),y=f(`stts`,0,0,s(1),s(e.length),s(o)),b=f(`stsc`,0,0,s(1),s(1),s(e.length),s(1)),x=[s(0),s(e.length)];for(let e of m)x.push(s(e));let S=f(`stsz`,0,0,...x),C=f(`stco`,0,0,s(1),s(0)),w=[s(h.length)];for(let e of h)w.push(s(e));let T=d(`stbl`,v,y,b,S,C,f(`stss`,0,0,...w)),E=d(`dinf`,f(`dref`,0,0,s(1),f(`url `,0,1))),D=d(`minf`,f(`vmhd`,0,1,new Uint8Array(8)),E,T),O=f(`hdlr`,0,0,s(0),l(`vide`),new Uint8Array(12),l(`VideoHandler`),new Uint8Array(1)),k=e.length*o,A=d(`mdia`,f(`mdhd`,0,0,s(0),s(0),s(a),s(k),c(21956),c(0)),O,D),j=d(`trak`,f(`tkhd`,0,3,s(0),s(0),s(1),s(0),s(k),new Uint8Array(8),c(0),c(0),c(0),c(0),s(65536),s(0),s(0),s(0),s(65536),s(0),s(0),s(0),s(1073741824),s(n<<16),s(r<<16)),A),M=d(`moov`,f(`mvhd`,0,0,s(0),s(0),s(a),s(k),s(65536),c(256),new Uint8Array(10),s(65536),s(0),s(0),s(0),s(65536),s(0),s(0),s(0),s(1073741824),new Uint8Array(24),s(2)),j),N=p.length+M.length,P=new Uint8Array(M);for(let e=0;e<P.length-16;e++)if(P[e]===115&&P[e+1]===116&&P[e+2]===99&&P[e+3]===111){let t=N+8;P[e+12]=t>>24&255,P[e+13]=t>>16&255,P[e+14]=t>>8&255,P[e+15]=t&255;break}let F=s(g),I=new Uint8Array(p.length+P.length+g),L=0;I.set(p,L),L+=p.length,I.set(P,L),L+=P.length,I.set(F,L),I.set(l(`mdat`),L+4),L+=8;for(let t of e)I.set(t.data,L),L+=t.data.length;return I}function St(e,t=1024){if(e===0)return`0B`;let n=[e,e/t,e/t/t].reverse(),r=[`B`,`KB`,`MB`].reverse(),i=n.findIndex(e=>e>=1);return new Intl.NumberFormat(`en-us`,{useGrouping:!0,maximumFractionDigits:1}).format(n[i])+r[i]}function Ct(e){let t=e.strings,n=new u;n.setClass(`menu right`);let r=new E(e.config.getKey(`autosave`),t.getKey(`menubar/status/autosave`));r.text.setColor(`#888`),r.onChange(function(){let t=this.getValue();e.config.setKey(`autosave`,t),t===!0&&e.signals.sceneGraphChanged.dispatch()}),n.add(r),e.signals.savingStarted.add(function(){r.text.setTextDecoration(`underline`)}),e.signals.savingFinished.add(function(){r.text.setTextDecoration(`none`)});let i=new y(`r`+D.REVISION);return i.setClass(`title`),i.setOpacity(.5),n.add(i),n}function wt(e){let t=new u;return t.setId(`menubar`),t.add(new pt(e)),t.add(new ft(e)),t.add(new dt(e)),t.add(new ht(e)),t.add(new vt(e)),t.add(new mt(e)),t.add(new Ct(e)),t}function Tt(e){let t=e.signals,n=new u;n.setId(`player`),n.setPosition(`absolute`),n.setDisplay(`none`);let r=new _t.Player;return n.dom.appendChild(r.dom),window.addEventListener(`resize`,function(){r.setSize(n.dom.clientWidth,n.dom.clientHeight)}),t.windowResize.add(function(){r.setSize(n.dom.clientWidth,n.dom.clientHeight)}),t.startPlayer.add(async function(){n.setDisplay(``),await r.load(e.toJSON()),r.setSize(n.dom.clientWidth,n.dom.clientHeight),r.play()}),t.stopPlayer.add(function(){n.setDisplay(`none`),r.stop(),r.dispose()}),n}function Et(e){let t=e.signals,n=e.config,i=document.createElement(`div`);i.id=`resizer`;function a(e){e.isPrimary!==!1&&(i.ownerDocument.addEventListener(`pointermove`,s),i.ownerDocument.addEventListener(`pointerup`,o))}function o(e){e.isPrimary!==!1&&(i.ownerDocument.removeEventListener(`pointermove`,s),i.ownerDocument.removeEventListener(`pointerup`,o))}function s(e){if(e.isPrimary===!1)return;let t=document.body.offsetWidth,r=e.clientX,i=r<0?0:r>t?t:r,a=Math.max(335,t-i);n.setKey(`resizer/x`,a),c(a)}function c(e=n.getKey(`resizer/x`)||335){i.style.right=e+`px`;let r=document.getElementById(`sidebar`);r&&(r.style.width=e+`px`);let a=document.getElementById(`player`);a&&(a.style.right=e+`px`);let o=document.getElementById(`script`);o&&(o.style.right=e+`px`);let s=document.getElementById(`viewport`);s&&(s.style.right=e+`px`);let c=document.getElementById(`animation`);c&&(c.style.right=e+`px`);let l=document.getElementById(`animation-resizer`);l&&(l.style.right=e+`px`);let u=document.body.offsetWidth-e,d=document.getElementById(`toolbar`);d&&(d.style.left=u/2+`px`),t.windowResize.dispatch()}return c(),t.scriptCreated?.add(c),i.addEventListener(`pointerdown`,a),new r(i)}function Dt(e){let t=e.signals,n=e.strings,r=new u;r.setBorderTop(`0`),r.setPaddingTop(`20px`);let i=new WeakMap;function a(e,t){let n=document.createElement(`div`);if(n.draggable=t,n.innerHTML=h(e),n.value=e.id,i.has(e)){let t=i.get(e),r=document.createElement(`span`);r.classList.add(`opener`),e.children.length>0&&r.classList.add(t?`open`:`closed`),r.addEventListener(`click`,function(){i.set(e,i.get(e)===!1),W()}),n.insertBefore(r,n.firstChild)}return n}function c(e){if(Array.isArray(e)){let t=[];for(let n=0;n<e.length;n++)t.push(e[n].name);return t.join(`,`)}return e.name}function l(e){return e.replace(/&/g,`&amp;`).replace(/"/g,`&quot;`).replace(/'/g,`&#39;`).replace(/</g,`&lt;`).replace(/>/g,`&gt;`)}function d(e){return e.isScene?`Scene`:e.isCamera?`Camera`:e.isLight?`Light`:e.isMesh?`Mesh`:e.isLine?`Line`:e.isPoints?`Points`:`Object3D`}function h(e){let t=`<span class="type ${d(e)}"></span> ${l(e.name)}`;if(e.isMesh){let n=e.geometry,r=e.material;t+=` <span class="type Geometry"></span> ${l(n.name)}`,t+=` <span class="type Material"></span> ${l(c(r))}`}return t+=g(e.uuid),t}function g(t){return e.scripts[t]===void 0||e.scripts[t].length===0?``:` <span class="type Script"></span>`}let _=!1,v=new C(e);v.setId(`outliner`),v.onChange(function(){_=!0,e.selectById(parseInt(v.getValue())),_=!1}),v.onDblClick(function(){e.focusById(parseInt(v.getValue()))}),r.add(v),r.add(new m);let x=new s,S=new o().setOptions({Default:`Default`,Color:`Color`,Texture:`Texture`,Equirectangular:`Equirect`}).setWidth(`150px`);S.setValue(`Default`),S.onChange(function(){P(),F()}),x.add(new y(n.getKey(`sidebar/scene/background`)).setClass(`Label`)),x.add(S);let w=new f().setValue(`#000000`).setMarginLeft(`8px`).onInput(P);x.add(w);let T=new b(e).setMarginLeft(`8px`).onChange(P);T.setDisplay(`none`),x.add(T);let E=new b(e).setMarginLeft(`8px`).onChange(P);E.setDisplay(`none`),x.add(E);let O=new s;O.setDisplay(`none`),O.setMarginLeft(`120px`);let k=new o().setOptions({[D.NoColorSpace]:`No Color Space`,[D.LinearSRGBColorSpace]:`srgb-linear`,[D.SRGBColorSpace]:`srgb`}).setWidth(`150px`);k.setValue(D.NoColorSpace),k.onChange(P),O.add(k),r.add(x),r.add(O);let A=new s;A.setDisplay(`none`),A.setMarginLeft(`120px`);let j=new p(0).setWidth(`40px`).setRange(0,1).onChange(P);A.add(j);let M=new p(1).setWidth(`40px`).setRange(0,1/0).onChange(P);A.add(M);let N=new p(0).setWidth(`40px`).setRange(-180,180).setStep(10).setNudge(.1).setUnit(``).onChange(P);A.add(N),r.add(A);function P(){t.sceneBackgroundChanged.dispatch(S.getValue(),w.getHexValue(),T.getValue(),E.getValue(),k.getValue(),j.getValue(),M.getValue(),N.getValue())}function F(){let e=S.getValue();S.setWidth(e===`Default`?`150px`:`110px`),w.setDisplay(e===`Color`?``:`none`),T.setDisplay(e===`Texture`?``:`none`),E.setDisplay(e===`Equirectangular`?``:`none`),A.setDisplay(e===`Equirectangular`?``:`none`),e===`Texture`||e===`Equirectangular`?O.setDisplay(``):O.setDisplay(`none`)}let I=new s,L=new o().setOptions({Default:`Default`,Equirectangular:`Equirect`,None:`None`}).setWidth(`150px`);L.setValue(`Default`),L.onChange(function(){te(),ne()}),I.add(new y(n.getKey(`sidebar/scene/environment`)).setClass(`Label`)),I.add(L);let ee=new b(e).setMarginLeft(`8px`).onChange(te);ee.setDisplay(`none`),I.add(ee),r.add(I);function te(){t.sceneEnvironmentChanged.dispatch(L.getValue(),ee.getValue())}function ne(){let e=L.getValue();L.setWidth(e===`Equirectangular`?`110px`:`150px`),ee.setDisplay(e===`Equirectangular`?``:`none`)}function re(){t.sceneFogChanged.dispatch(z.getValue(),ae.getHexValue(),V.getValue(),H.getValue(),U.getValue())}function R(){t.sceneFogSettingsChanged.dispatch(z.getValue(),ae.getHexValue(),V.getValue(),H.getValue(),U.getValue())}let ie=new s,z=new o().setOptions({None:`None`,Fog:`Linear`,FogExp2:`Exponential`}).setWidth(`150px`);z.onChange(function(){re(),oe()}),ie.add(new y(n.getKey(`sidebar/scene/fog`)).setClass(`Label`)),ie.add(z),r.add(ie);let B=new s;B.setDisplay(`none`),B.setMarginLeft(`120px`),r.add(B);let ae=new f().setValue(`#aaaaaa`);ae.onInput(R),B.add(ae);let V=new p(.1).setWidth(`40px`).setRange(0,1/0).onChange(R);B.add(V);let H=new p(50).setWidth(`40px`).setRange(0,1/0).onChange(R);B.add(H);let U=new p(.05).setWidth(`40px`).setRange(0,.1).setStep(.001).setPrecision(3).onChange(R);B.add(U);function W(){let t=e.camera,n=e.scene,r=[];switch(r.push(a(t,!1)),r.push(a(n,!1)),(function e(t,n){for(let o=0,s=t.length;o<s;o++){let s=t[o];i.has(s)===!1&&i.set(s,!1);let c=a(s,!0);c.style.paddingLeft=n*18+`px`,r.push(c),i.get(s)===!0&&e(s.children,n+1)}})(n.children,0),v.setOptions(r),e.selected!==null&&v.setValue(e.selected.id),S.setValue(e.backgroundType),e.backgroundType){case`Color`:w.setHexValue(n.background.getHex());break;case`Texture`:T.setValue(n.background),k.setValue(n.background.colorSpace);break;case`Equirectangular`:E.setValue(n.background),j.setValue(n.backgroundBlurriness),M.setValue(n.backgroundIntensity),k.setValue(n.background.colorSpace);break;default:T.setValue(null),E.setValue(null),k.setValue(D.NoColorSpace)}L.setValue(e.environmentType),e.environmentType===`Equirectangular`?ee.setValue(n.environment):ee.setValue(null),n.fog?(ae.setHexValue(n.fog.color.getHex()),n.fog.isFog?(z.setValue(`Fog`),V.setValue(n.fog.near),H.setValue(n.fog.far)):n.fog.isFogExp2&&(z.setValue(`FogExp2`),U.setValue(n.fog.density))):z.setValue(`None`),F(),ne(),oe()}function oe(){let e=z.getValue();B.setDisplay(e===`None`?`none`:``),V.setDisplay(e===`Fog`?``:`none`),H.setDisplay(e===`Fog`?``:`none`),U.setDisplay(e===`FogExp2`?``:`none`)}return W(),t.editorCleared.add(W),t.sceneGraphChanged.add(W),t.objectChanged.add(function(e){let t=v.options;for(let n=0;n<t.length;n++){let r=t[n];if(r.value===e.id){let t=r.querySelector(`:scope > .opener`);r.innerHTML=(t?t.outerHTML:``)+h(e);return}}}),t.scriptAdded.add(function(){e.selected!==null&&t.objectChanged.dispatch(e.selected)}),t.scriptRemoved.add(function(){e.selected!==null&&t.objectChanged.dispatch(e.selected)}),t.objectSelected.add(function(t){if(_!==!0)if(t!==null&&t.parent!==null){let n=!1,r=t.parent;for(;r!==e.scene;)i.get(r)!==!0&&(i.set(r,!0),n=!0),r=r.parent;n&&W(),v.setValue(t.id)}else v.setValue(null)}),t.sceneBackgroundChanged.add(function(){L.getValue()===`Background`&&(te(),ne())}),r}function Ot(e){let r=e.strings,a=e.signals,o=new u;o.setBorderTop(`0`),o.setPaddingTop(`20px`),o.setDisplay(`none`);let l=new s,d=new y;l.add(new y(r.getKey(`sidebar/object/type`)).setClass(`Label`)),l.add(d),o.add(l);let m=new s,h=new _().setWidth(`102px`).setFontSize(`12px`).setDisabled(!0),g=new c(r.getKey(`sidebar/object/new`)).setMarginLeft(`7px`).onClick(function(){h.setValue(D.MathUtils.generateUUID()),e.execute(new ke(e,e.selected,h.getValue()))});m.add(new y(r.getKey(`sidebar/object/uuid`)).setClass(`Label`)),m.add(h),m.add(g),o.add(m);let v=new s,b=new _().setWidth(`150px`).setFontSize(`12px`).onChange(function(){e.execute(new K(e,e.selected,`name`,b.getValue()))});v.add(new y(r.getKey(`sidebar/object/name`)).setClass(`Label`)),v.add(b),o.add(v);let x=new s,S=new p().setPrecision(3).setWidth(`50px`).onChange(Y),C=new p().setPrecision(3).setWidth(`50px`).onChange(Y),w=new p().setPrecision(3).setWidth(`50px`).onChange(Y);x.add(new y(r.getKey(`sidebar/object/position`)).setClass(`Label`)),x.add(S,C,w),o.add(x);let T=new s,O=new p().setStep(10).setNudge(.1).setUnit(``).setWidth(`50px`).onChange(Y),k=new p().setStep(10).setNudge(.1).setUnit(``).setWidth(`50px`).onChange(Y),A=new p().setStep(10).setNudge(.1).setUnit(``).setWidth(`50px`).onChange(Y);T.add(new y(r.getKey(`sidebar/object/rotation`)).setClass(`Label`)),T.add(O,k,A),o.add(T);let j=new s,M=new p(1).setPrecision(3).setWidth(`50px`).onChange(Y),N=new p(1).setPrecision(3).setWidth(`50px`).onChange(Y),P=new p(1).setPrecision(3).setWidth(`50px`).onChange(Y);j.add(new y(r.getKey(`sidebar/object/scale`)).setClass(`Label`)),j.add(M,N,P),o.add(j);let F=new s,I=new p().onChange(Y);F.add(new y(r.getKey(`sidebar/object/fov`)).setClass(`Label`)),F.add(I),o.add(F);let L=new s,ee=new p().onChange(Y);L.add(new y(r.getKey(`sidebar/object/left`)).setClass(`Label`)),L.add(ee),o.add(L);let te=new s,ne=new p().onChange(Y);te.add(new y(r.getKey(`sidebar/object/right`)).setClass(`Label`)),te.add(ne),o.add(te);let re=new s,R=new p().onChange(Y);re.add(new y(r.getKey(`sidebar/object/top`)).setClass(`Label`)),re.add(R),o.add(re);let ie=new s,z=new p().onChange(Y);ie.add(new y(r.getKey(`sidebar/object/bottom`)).setClass(`Label`)),ie.add(z),o.add(ie);let B=new s,ae=new p().onChange(Y);B.add(new y(r.getKey(`sidebar/object/near`)).setClass(`Label`)),B.add(ae),o.add(B);let V=new s,H=new p().onChange(Y);V.add(new y(r.getKey(`sidebar/object/far`)).setClass(`Label`)),V.add(H),o.add(V);let U=new s,W=new p().onChange(Y);U.add(new y(r.getKey(`sidebar/object/intensity`)).setClass(`Label`)),U.add(W),o.add(U);let oe=new s,se=new f().onInput(Y);oe.add(new y(r.getKey(`sidebar/object/color`)).setClass(`Label`)),oe.add(se),o.add(oe);let ce=new s,le=new f().onInput(Y);ce.add(new y(r.getKey(`sidebar/object/groundcolor`)).setClass(`Label`)),ce.add(le),o.add(ce);let ue=new s,de=new p().setRange(0,1/0).onChange(Y);ue.add(new y(r.getKey(`sidebar/object/distance`)).setClass(`Label`)),ue.add(de),o.add(ue);let fe=new s,pe=new p().setPrecision(3).setRange(0,Math.PI/2).onChange(Y);fe.add(new y(r.getKey(`sidebar/object/angle`)).setClass(`Label`)),fe.add(pe),o.add(fe);let me=new s,he=new p().setRange(0,1).onChange(Y);me.add(new y(r.getKey(`sidebar/object/penumbra`)).setClass(`Label`)),me.add(he),o.add(me);let ge=new s,_e=new p().setRange(0,1/0).onChange(Y);ge.add(new y(r.getKey(`sidebar/object/decay`)).setClass(`Label`)),ge.add(_e),o.add(ge);let ve=new s;ve.add(new y(r.getKey(`sidebar/object/shadow`)).setClass(`Label`));let ye=new E(!1,r.getKey(`sidebar/object/cast`)).onChange(Y);ve.add(ye);let be=new E(!1,r.getKey(`sidebar/object/receive`)).onChange(Y);ve.add(be),o.add(ve);let xe=new s;xe.add(new y(r.getKey(`sidebar/object/shadowIntensity`)).setClass(`Label`));let Se=new p(0).setRange(0,1).onChange(Y);xe.add(Se),o.add(xe);let Ce=new s;Ce.add(new y(r.getKey(`sidebar/object/shadowBias`)).setClass(`Label`));let we=new p(0).setPrecision(5).setStep(1e-4).setNudge(1e-5).onChange(Y);Ce.add(we),o.add(Ce);let Te=new s;Te.add(new y(r.getKey(`sidebar/object/shadowNormalBias`)).setClass(`Label`));let Ee=new p(0).onChange(Y);Te.add(Ee),o.add(Te);let De=new s;De.add(new y(r.getKey(`sidebar/object/shadowRadius`)).setClass(`Label`));let Oe=new p(1).onChange(Y);De.add(Oe),o.add(De);let G=new s,Ae=new t().onChange(Y);G.add(new y(r.getKey(`sidebar/object/visible`)).setClass(`Label`)),G.add(Ae),o.add(G);let je=new s,Me=new t().onChange(Y);je.add(new y(r.getKey(`sidebar/object/frustumcull`)).setClass(`Label`)),je.add(Me),o.add(je);let Ne=new s,Pe=new i().setWidth(`50px`).onChange(Y);Ne.add(new y(r.getKey(`sidebar/object/renderorder`)).setClass(`Label`)),Ne.add(Pe),o.add(Ne);let Fe=new s,q=new n().setWidth(`150px`).setHeight(`40px`).setFontSize(`12px`).onChange(Y);q.onKeyUp(function(){try{JSON.parse(q.getValue()),q.dom.classList.add(`success`),q.dom.classList.remove(`fail`)}catch{q.dom.classList.remove(`success`),q.dom.classList.add(`fail`)}}),Fe.add(new y(r.getKey(`sidebar/object/userdata`)).setClass(`Label`)),Fe.add(q),o.add(Fe);let J=new c(r.getKey(`sidebar/object/export`));J.setMarginLeft(`120px`),J.onClick(function(){let t=e.selected.toJSON();try{t=JSON.stringify(t,null,`	`),t=t.replace(/[\n\t]+([\d\.e\-\[\]]+)/g,`$1`)}catch{t=JSON.stringify(t)}e.utils.save(new Blob([t]),`${b.getValue()||`object`}.json`)}),o.add(J);function Y(){let t=e.selected;if(t!==null){let n=new D.Vector3(S.getValue(),C.getValue(),w.getValue());t.position.distanceTo(n)>=.01&&e.execute(new Ue(e,t,n));let r=new D.Euler(O.getValue()*D.MathUtils.DEG2RAD,k.getValue()*D.MathUtils.DEG2RAD,A.getValue()*D.MathUtils.DEG2RAD);new D.Vector3().setFromEuler(t.rotation).distanceTo(new D.Vector3().setFromEuler(r))>=.01&&e.execute(new We(e,t,r));let i=new D.Vector3(M.getValue(),N.getValue(),P.getValue());t.scale.distanceTo(i)>=.01&&e.execute(new Ge(e,t,i)),t.fov!==void 0&&Math.abs(t.fov-I.getValue())>=.01&&(e.execute(new K(e,t,`fov`,I.getValue())),t.updateProjectionMatrix()),t.left!==void 0&&Math.abs(t.left-ee.getValue())>=.01&&(e.execute(new K(e,t,`left`,ee.getValue())),t.updateProjectionMatrix()),t.right!==void 0&&Math.abs(t.right-ne.getValue())>=.01&&(e.execute(new K(e,t,`right`,ne.getValue())),t.updateProjectionMatrix()),t.top!==void 0&&Math.abs(t.top-R.getValue())>=.01&&(e.execute(new K(e,t,`top`,R.getValue())),t.updateProjectionMatrix()),t.bottom!==void 0&&Math.abs(t.bottom-z.getValue())>=.01&&(e.execute(new K(e,t,`bottom`,z.getValue())),t.updateProjectionMatrix()),t.near!==void 0&&Math.abs(t.near-ae.getValue())>=.01&&(e.execute(new K(e,t,`near`,ae.getValue())),t.isOrthographicCamera&&t.updateProjectionMatrix()),t.far!==void 0&&Math.abs(t.far-H.getValue())>=.01&&(e.execute(new K(e,t,`far`,H.getValue())),t.isOrthographicCamera&&t.updateProjectionMatrix()),t.intensity!==void 0&&Math.abs(t.intensity-W.getValue())>=.01&&e.execute(new K(e,t,`intensity`,W.getValue())),t.color!==void 0&&t.color.getHex()!==se.getHexValue()&&e.execute(new Ie(e,t,`color`,se.getHexValue())),t.groundColor!==void 0&&t.groundColor.getHex()!==le.getHexValue()&&e.execute(new Ie(e,t,`groundColor`,le.getHexValue())),t.distance!==void 0&&Math.abs(t.distance-de.getValue())>=.01&&e.execute(new K(e,t,`distance`,de.getValue())),t.angle!==void 0&&Math.abs(t.angle-pe.getValue())>=.01&&e.execute(new K(e,t,`angle`,pe.getValue())),t.penumbra!==void 0&&Math.abs(t.penumbra-he.getValue())>=.01&&e.execute(new K(e,t,`penumbra`,he.getValue())),t.decay!==void 0&&Math.abs(t.decay-_e.getValue())>=.01&&e.execute(new K(e,t,`decay`,_e.getValue())),t.visible!==Ae.getValue()&&e.execute(new K(e,t,`visible`,Ae.getValue())),t.frustumCulled!==Me.getValue()&&e.execute(new K(e,t,`frustumCulled`,Me.getValue())),t.renderOrder!==Pe.getValue()&&e.execute(new K(e,t,`renderOrder`,Pe.getValue())),t.castShadow!==void 0&&t.castShadow!==ye.getValue()&&e.execute(new K(e,t,`castShadow`,ye.getValue())),t.receiveShadow!==be.getValue()&&(t.material!==void 0&&(t.material.needsUpdate=!0),e.execute(new K(e,t,`receiveShadow`,be.getValue()))),t.shadow!==void 0&&(t.shadow.intensity!==Se.getValue()&&e.execute(new qe(e,t,`intensity`,Se.getValue())),t.shadow.bias!==we.getValue()&&e.execute(new qe(e,t,`bias`,we.getValue())),t.shadow.normalBias!==Ee.getValue()&&e.execute(new qe(e,t,`normalBias`,Ee.getValue())),t.shadow.radius!==Oe.getValue()&&e.execute(new qe(e,t,`radius`,Oe.getValue())));try{let n=JSON.parse(q.getValue());JSON.stringify(t.userData)!=JSON.stringify(n)&&e.execute(new K(e,t,`userData`,n))}catch(e){console.warn(e)}}}function Le(e){let t={fov:F,left:L,right:te,top:re,bottom:ie,near:B,far:V,intensity:U,color:oe,groundColor:ce,distance:ue,angle:fe,penumbra:me,decay:ge,castShadow:ve,receiveShadow:be,shadow:[xe,Ce,Te,De]};for(let n in t){let r=t[n];if(Array.isArray(r)===!0)for(let t=0;t<r.length;t++)r[t].setDisplay(e[n]===void 0?`none`:``);else r.setDisplay(e[n]===void 0?`none`:``)}e.isLight&&be.setDisplay(`none`),(e.isAmbientLight||e.isHemisphereLight)&&ve.setDisplay(`none`)}function Re(e){e.isLight?(T.setDisplay(`none`),j.setDisplay(`none`)):(T.setDisplay(``),j.setDisplay(``))}a.objectSelected.add(function(e){e===null?o.setDisplay(`none`):(o.setDisplay(`block`),Le(e),ze(e))}),a.objectChanged.add(function(t){t===e.selected&&ze(t)}),a.refreshSidebarObject3D.add(function(t){t===e.selected&&ze(t)});function ze(e){d.setValue(e.type),h.setValue(e.uuid),b.setValue(e.name),S.setValue(e.position.x),C.setValue(e.position.y),w.setValue(e.position.z),O.setValue(e.rotation.x*D.MathUtils.RAD2DEG),k.setValue(e.rotation.y*D.MathUtils.RAD2DEG),A.setValue(e.rotation.z*D.MathUtils.RAD2DEG),M.setValue(e.scale.x),N.setValue(e.scale.y),P.setValue(e.scale.z),e.fov!==void 0&&I.setValue(e.fov),e.left!==void 0&&ee.setValue(e.left),e.right!==void 0&&ne.setValue(e.right),e.top!==void 0&&R.setValue(e.top),e.bottom!==void 0&&z.setValue(e.bottom),e.near!==void 0&&ae.setValue(e.near),e.far!==void 0&&H.setValue(e.far),e.intensity!==void 0&&W.setValue(e.intensity),e.color!==void 0&&se.setHexValue(e.color.getHexString()),e.groundColor!==void 0&&le.setHexValue(e.groundColor.getHexString()),e.distance!==void 0&&de.setValue(e.distance),e.angle!==void 0&&pe.setValue(e.angle),e.penumbra!==void 0&&he.setValue(e.penumbra),e.decay!==void 0&&_e.setValue(e.decay),e.castShadow!==void 0&&ye.setValue(e.castShadow),e.receiveShadow!==void 0&&be.setValue(e.receiveShadow),e.shadow!==void 0&&(Se.setValue(e.shadow.intensity),we.setValue(e.shadow.bias),Ee.setValue(e.shadow.normalBias),Oe.setValue(e.shadow.radius)),Ae.setValue(e.visible),Me.setValue(e.frustumCulled),Pe.setValue(e.renderOrder);try{q.setValue(JSON.stringify(e.userData,null,`  `))}catch(e){console.log(e)}q.setBorderColor(`transparent`),q.setBackgroundColor(``),Re(e)}return o}var Z=e=>e.default,kt={BoxGeometry:()=>T(()=>import(`./Sidebar.Geometry.BoxGeometry-CdEU7DCC.js`).then(Z),__vite__mapDeps([0,1]),import.meta.url),CapsuleGeometry:()=>T(()=>import(`./Sidebar.Geometry.CapsuleGeometry-BUXFQKaq.js`).then(Z),__vite__mapDeps([2,1]),import.meta.url),CircleGeometry:()=>T(()=>import(`./Sidebar.Geometry.CircleGeometry-CdFJytNA.js`).then(Z),__vite__mapDeps([3,1]),import.meta.url),CylinderGeometry:()=>T(()=>import(`./Sidebar.Geometry.CylinderGeometry-Nsw2jHyf.js`).then(Z),__vite__mapDeps([4,1]),import.meta.url),DodecahedronGeometry:()=>T(()=>import(`./Sidebar.Geometry.DodecahedronGeometry-Pi9vFCx4.js`).then(Z),__vite__mapDeps([5,1]),import.meta.url),ExtrudeGeometry:()=>T(()=>import(`./Sidebar.Geometry.ExtrudeGeometry-C98Npptt.js`).then(Z),__vite__mapDeps([6,1]),import.meta.url),IcosahedronGeometry:()=>T(()=>import(`./Sidebar.Geometry.IcosahedronGeometry-Bh1Hm_r_.js`).then(Z),__vite__mapDeps([7,1]),import.meta.url),LatheGeometry:()=>T(()=>import(`./Sidebar.Geometry.LatheGeometry-Da2R7sMH.js`).then(Z),__vite__mapDeps([8,9,1]),import.meta.url),OctahedronGeometry:()=>T(()=>import(`./Sidebar.Geometry.OctahedronGeometry-92TVzDxQ.js`).then(Z),__vite__mapDeps([10,1]),import.meta.url),PlaneGeometry:()=>T(()=>import(`./Sidebar.Geometry.PlaneGeometry-BAOQbegQ.js`).then(Z),__vite__mapDeps([11,1]),import.meta.url),RingGeometry:()=>T(()=>import(`./Sidebar.Geometry.RingGeometry-tePqmNVu.js`).then(Z),__vite__mapDeps([12,1]),import.meta.url),ShapeGeometry:()=>T(()=>import(`./Sidebar.Geometry.ShapeGeometry-2EAvVHCM.js`).then(Z),__vite__mapDeps([13,1]),import.meta.url),SphereGeometry:()=>T(()=>import(`./Sidebar.Geometry.SphereGeometry-CgboX7pt.js`).then(Z),__vite__mapDeps([14,1]),import.meta.url),TetrahedronGeometry:()=>T(()=>import(`./Sidebar.Geometry.TetrahedronGeometry-CUIsjPPY.js`).then(Z),__vite__mapDeps([15,1]),import.meta.url),TorusGeometry:()=>T(()=>import(`./Sidebar.Geometry.TorusGeometry-BXRs1SOf.js`).then(Z),__vite__mapDeps([16,1]),import.meta.url),TorusKnotGeometry:()=>T(()=>import(`./Sidebar.Geometry.TorusKnotGeometry-CPfBa8le.js`).then(Z),__vite__mapDeps([17,1]),import.meta.url),TubeGeometry:()=>T(()=>import(`./Sidebar.Geometry.TubeGeometry-D0X86lJe.js`).then(Z),__vite__mapDeps([18,9,1]),import.meta.url)};function At(n){let r=n.strings,i=n.signals,a=new s;function o(i){if(i==null)return;let o=i.geometry;if(o){a.clear(),a.setDisplay(`block`);let i=new s,c=new y(r.getKey(`sidebar/geometry/buffer_geometry/attributes`)).setClass(`Label`);i.add(c);let l=new e().setDisplay(`inline-block`).setVerticalAlign(`middle`).setWidth(`160px`);i.add(l);let u=o.index;u!==null&&(l.add(new y(r.getKey(`sidebar/geometry/buffer_geometry/index`)).setWidth(`70px`)),l.add(new y(n.utils.formatNumber(u.count)).setFontSize(`12px`)),l.add(new m));let d=o.attributes;for(let e in d){let t=d[e];l.add(new y(e).setWidth(`70px`));let r=n.utils.formatNumber(t.count)+` (`+t.itemSize+`)`;t.isInterleavedBufferAttribute&&(r+=` (`+t.data.stride+`)`),l.add(new y(r).setFontSize(`12px`)),l.add(new m)}a.add(i);let f=o.morphAttributes;if(Object.keys(f).length>0){let i=new s,c=new y(r.getKey(`sidebar/geometry/buffer_geometry/morphAttributes`)).setClass(`Label`);i.add(c);let l=new e().setDisplay(`inline-block`).setVerticalAlign(`middle`).setWidth(`160px`);i.add(l);for(let e in f){let t=f[e];l.add(new y(e).setWidth(`70px`)),l.add(new y(n.utils.formatNumber(t.length)).setFontSize(`12px`)),l.add(new m)}a.add(i);let u=new s,d=new y(r.getKey(`sidebar/geometry/buffer_geometry/morphRelative`)).setClass(`Label`);u.add(d);let p=new t().setValue(o.morphTargetsRelative).setDisabled(!0);u.add(p),a.add(u)}}else a.setDisplay(`none`)}return i.objectSelected.add(o),i.geometryChanged.add(o),a}function jt(e,t){let n=e.strings,r=e.signals,i=new h().setMarginLeft(`120px`),a=t.geometry,o=new c(n.getKey(`sidebar/geometry/compute_vertex_normals`));o.onClick(function(){a.computeVertexNormals(),r.geometryChanged.dispatch(t)});let l=new s;if(l.add(o),i.add(l),a.hasAttribute(`position`)&&a.hasAttribute(`normal`)&&a.hasAttribute(`uv`)){let e=new c(n.getKey(`sidebar/geometry/compute_vertex_tangents`));e.onClick(async function(){await fe.ready,de(a,fe),r.geometryChanged.dispatch(t)});let o=new s;o.add(e),i.add(o)}let u=new c(n.getKey(`sidebar/geometry/center`));u.onClick(function(){a.center(),r.geometryChanged.dispatch(t)});let d=new s;return d.add(u),i.add(d),i}function Mt(t){let r=t.strings,i=t.signals,a=new u;a.setBorderTop(`0`),a.setDisplay(`none`),a.setPaddingTop(`20px`);let o=null,l=new s,d=new y;l.add(new y(r.getKey(`sidebar/geometry/type`)).setClass(`Label`)),l.add(d),a.add(l);let f=new s,g=new _().setWidth(`102px`).setFontSize(`12px`).setDisabled(!0),v=new c(r.getKey(`sidebar/geometry/new`)).setMarginLeft(`7px`).onClick(function(){g.setValue(D.MathUtils.generateUUID()),t.execute(new Y(t,t.selected,`uuid`,g.getValue()))});f.add(new y(r.getKey(`sidebar/geometry/uuid`)).setClass(`Label`)),f.add(g),f.add(v),a.add(f);let b=new s,x=new _().setWidth(`150px`).setFontSize(`12px`).onChange(function(){t.execute(new Y(t,t.selected,`name`,x.getValue()))});b.add(new y(r.getKey(`sidebar/geometry/name`)).setClass(`Label`)),b.add(x),a.add(b);let S=new e;a.add(S),a.add(new At(t));let C=new y().setFontSize(`12px`),w=new s;w.add(new y(r.getKey(`sidebar/geometry/bounds`)).setClass(`Label`)),w.add(C),a.add(w);let T=new s,E=new n().setValue(`{}`).setWidth(`150px`).setHeight(`40px`).setFontSize(`12px`).onChange(function(){try{let e=JSON.parse(E.getValue());JSON.stringify(t.selected.geometry.userData)!=JSON.stringify(e)&&(t.execute(new Y(t,t.selected,`userData`,e)),N())}catch(e){console.warn(e)}});E.onKeyUp(function(){try{JSON.parse(E.getValue()),E.dom.classList.add(`success`),E.dom.classList.remove(`fail`)}catch{E.dom.classList.remove(`success`),E.dom.classList.add(`fail`)}}),T.add(new y(r.getKey(`sidebar/geometry/userdata`)).setClass(`Label`)),T.add(E),a.add(T);let O=new s().setMarginLeft(`120px`);a.add(O);let k=new c(r.getKey(`sidebar/geometry/show_vertex_normals`));k.onClick(function(){let e=t.selected;t.helpers[e.id]===void 0?t.addHelper(e,new ue(e)):t.removeHelper(e),i.sceneGraphChanged.dispatch()}),O.add(k);let A=new c(r.getKey(`sidebar/geometry/export`));A.setMarginLeft(`120px`),A.onClick(function(){let e=t.selected.geometry.toJSON();try{e=JSON.stringify(e,null,`	`),e=e.replace(/[\n\t]+([\d\.e\-\[\]]+)/g,`$1`)}catch{e=JSON.stringify(e)}t.utils.save(new Blob([e]),`${x.getValue()||`geometry`}.json`)}),a.add(A);let j=new h;j.setMarginTop(`20px`),j.setDisplay(`none`),a.add(j),j.add(new y(r.getKey(`sidebar/geometry/morph`)).setTextTransform(`uppercase`)),j.add(new m),j.add(new m);let M=new h;j.add(M);async function N(){let e=t.selected;if(e&&e.geometry){let n=e.geometry;if(a.setDisplay(`block`),d.setValue(n.type),g.setValue(n.uuid),x.setValue(n.name),o!==n.type){if(S.clear(),n.type===`BufferGeometry`||n.type===`InstancedBufferGeometry`)S.add(new jt(t,e));else{let r=await kt[n.type]();S.add(new r(t,e))}o=n.type}n.boundingBox===null&&n.computeBoundingBox();let r=n.boundingBox,i=Math.floor((r.max.x-r.min.x)*1e3)/1e3,s=Math.floor((r.max.y-r.min.y)*1e3)/1e3,c=Math.floor((r.max.z-r.min.z)*1e3)/1e3;C.setInnerHTML(`${i}<br/>${s}<br/>${c}`),O.setDisplay(n.hasAttribute(`normal`)?``:`none`),E.setValue(JSON.stringify(n.userData,null,`  `));let l=t.helpers[e.id];if(l!==void 0&&l.isVertexNormalsHelper===!0&&(t.removeHelper(e),t.addHelper(e,new ue(e))),P.length=0,M.clear(),e.morphTargetInfluences){let t=e.morphTargetDictionary,n=e.morphTargetInfluences,r=Object.keys(t);for(let e=0;e<r.length;e++){let t=r[e];M.add(new F(e,t,n))}j.setDisplay(``)}else j.setDisplay(`none`)}}let P=[];function F(e,n,r){let a=new s,o=new y(n).setWidth(`200px`);a.add(o);let c=new p().setWidth(`60px`).setRange(0,1).onChange(function(){r[e]=c.getValue(),i.objectChanged.dispatch(t.selected)});return c.setValue(r[e]),a.add(c),P.push(c),a}function I(){let e=t.selected;if(e!==null&&e.morphTargetInfluences)for(let t=0;t<P.length;t++)P[t].setValue(e.morphTargetInfluences[t])}return i.objectSelected.add(function(){o=null,N()}),i.geometryChanged.add(N),i.morphTargetsUpdated.add(I),a}function Nt(e,n,r){let i=e.signals,a=new s;a.add(new y(r).setClass(`Label`));let o=new t().setLeft(`100px`).onChange(d);a.add(o);let c=null,l=null,u=null;function d(){u[n]!==o.getValue()&&e.execute(new Ve(e,c,n,o.getValue(),l))}function f(t,r=0){c=t,l=r,c!==null&&c.material!==void 0&&(u=e.getObjectMaterial(c,l),n in u?(o.setValue(u[n]),a.setDisplay(``)):a.setDisplay(`none`))}return i.objectSelected.add(f),i.materialChanged.add(f),a}function Pt(e,t,n){let r=e.signals,i=new s;i.add(new y(n).setClass(`Label`));let a=new f().onInput(d);i.add(a);let o;t===`emissive`&&(o=new p(1).setWidth(`30px`).setRange(0,1/0).onChange(d),i.add(o));let c=null,l=null,u=null;function d(){u[t].getHex()!==a.getHexValue()&&e.execute(new Le(e,c,t,a.getHexValue(),l)),o!==void 0&&u[`${t}Intensity`]!==o.getValue()&&e.execute(new Ve(e,c,`${t}Intensity`,o.getValue(),l))}function m(n,r=0){c=n,l=r,c!==null&&c.material!==void 0&&(u=e.getObjectMaterial(c,l),t in u?(a.setHexValue(u[t].getHexString()),o!==void 0&&o.setValue(u[`${t}Intensity`]),i.setDisplay(``)):i.setDisplay(`none`))}return r.objectSelected.add(m),r.materialChanged.add(m),i}function Ft(e,t,n,r){let i=e.signals,a=new s;a.add(new y(n).setClass(`Label`));let c=new o().setOptions(r).onChange(f);a.add(c);let l=null,u=null,d=null;function f(){let n=parseInt(c.getValue());d[t]!==n&&e.execute(new Ve(e,l,t,n,u))}function p(n,r=0){l=n,u=r,l!==null&&l.material!==void 0&&(d=e.getObjectMaterial(l,u),t in d?(c.setValue(d[t]),a.setDisplay(``)):a.setDisplay(`none`))}return i.objectSelected.add(p),i.materialChanged.add(p),a}function Q(e,n,r){let i=e.signals,a=new s;a.add(new y(r).setClass(`Label`));let o=new t(!1).setMarginRight(`8px`).onChange(w);a.add(o);let c=new b(e).onChange(T);a.add(c);let l=n.replace(`Map`,``),u=[`map`,`emissiveMap`,`sheenColorMap`,`specularColorMap`,`envMap`],d;n===`aoMap`&&(d=new p(1).setWidth(`30px`).setRange(0,1).onChange(E),a.add(d));let f;(n===`bumpMap`||n===`displacementMap`)&&(f=new p().setWidth(`30px`).onChange(O),a.add(f));let m,g;(n===`normalMap`||n===`clearcoatNormalMap`)&&(m=new p().setWidth(`30px`).onChange(k),a.add(m),g=new p().setWidth(`30px`).onChange(k),a.add(g));let _,v;if(n===`iridescenceThicknessMap`){let e=new h().setMarginLeft(`3px`);a.add(e);let t=new s().setMarginBottom(`0px`).setStyle(`min-height`,`0px`);e.add(t),t.add(new y(`min:`).setWidth(`35px`)),_=new p().setWidth(`40px`).onChange(A),t.add(_);let n=new s().setMarginBottom(`6px`).setStyle(`min-height`,`0px`);e.add(n),n.add(new y(`max:`).setWidth(`35px`)),v=new p().setWidth(`40px`).onChange(A),n.add(v),_.setPrecision(0).setRange(0,1/0).setNudge(1).setStep(10).setUnit(`nm`),v.setPrecision(0).setRange(0,1/0).setNudge(1).setStep(10).setUnit(`nm`)}let x=null,S=null,C=null;function w(){let t=o.getValue()?c.getValue():null;if(C[n]!==t){if(t!==null){let e=x.geometry;e.hasAttribute(`uv`)===!1&&console.warn(`Geometry doesn't have uvs:`,e),n===`envMap`&&(t.mapping=D.EquirectangularReflectionMapping)}e.execute(new ze(e,x,n,t,S))}}function T(e){e!==null&&u.includes(n)&&e.isDataTexture!==!0&&e.colorSpace!==D.SRGBColorSpace&&(e.colorSpace=D.SRGBColorSpace,C.needsUpdate=!0),o.setDisabled(!1),w()}function E(){C[`${n}Intensity`]!==d.getValue()&&e.execute(new Ve(e,x,`${n}Intensity`,d.getValue(),S))}function O(){C[`${l}Scale`]!==f.getValue()&&e.execute(new Ve(e,x,`${l}Scale`,f.getValue(),S))}function k(){let t=[m.getValue(),g.getValue()];(C[`${l}Scale`].x!==t[0]||C[`${l}Scale`].y!==t[1])&&e.execute(new He(e,x,`${l}Scale`,t,S))}function A(){let t=[_.getValue(),v.getValue()];(C[`${l}Range`][0]!==t[0]||C[`${l}Range`][1]!==t[1])&&e.execute(new Be(e,x,`${l}Range`,t[0],t[1],S))}function j(t,r=0){x=t,S=r,x!==null&&x.material!==void 0&&(C=e.getObjectMaterial(x,S),n in C?(C[n]!==null&&c.setValue(C[n]),o.setValue(C[n]!==null),o.setDisabled(c.getValue()===null),d!==void 0&&d.setValue(C[`${n}Intensity`]),f!==void 0&&f.setValue(C[`${l}Scale`]),m!==void 0&&(m.setValue(C[`${l}Scale`].x),g.setValue(C[`${l}Scale`].y)),_!==void 0&&(_.setValue(C[`${l}Range`][0]),v.setValue(C[`${l}Range`][1])),a.setDisplay(``)):a.setDisplay(`none`))}return i.objectSelected.add(function(e){c.setValue(null),j(e)}),i.materialChanged.add(j),a}function $(e,t,n,r=[-1/0,1/0],i=2){let a=e.signals,o=new s;o.add(new y(n).setClass(`Label`));let c=new p().setWidth(`60px`).setRange(r[0],r[1]).setPrecision(i).onChange(f);o.add(c);let l=null,u=null,d=null;function f(){d[t]!==c.getValue()&&e.execute(new Ve(e,l,t,c.getValue(),u))}function m(n,r=0){l=n,u=r,l!==null&&l.material!==void 0&&(d=e.getObjectMaterial(l,u),t in d?(c.setValue(d[t]),o.setDisplay(``)):o.setDisplay(`none`))}return a.objectSelected.add(m),a.materialChanged.add(m),o}function It(e,t,n,r,i=[-1/0,1/0],a=2,o=1,c=.01,l=``){let u=e.signals,d=new s;d.add(new y(n).setClass(`Label`));let f=new p().setWidth(`60px`).setRange(i[0],i[1]).setPrecision(a).setStep(o).setNudge(c).setUnit(l).onChange(_);d.add(f);let m=null,h=null,g=null;function _(){if(g[t][r?0:1]!==f.getValue()){let n=r?f.getValue():g[t][0],i=r?g[t][1]:f.getValue();e.execute(new Be(e,m,t,n,i,h))}}function v(n,i=0){m=n,h=i,m!==null&&m.material!==void 0&&(g=e.getObjectMaterial(m,h),t in g?(f.setValue(g[t][r?0:1]),d.setDisplay(``)):d.setDisplay(`none`))}return u.objectSelected.add(v),u.materialChanged.add(v),d}function Lt(e,t){let n=e.signals,r=e.strings,i=null,a=null,o=null,l=new s;l.add(new y(r.getKey(`sidebar/material/program`)).setClass(`Label`));let u=new c(r.getKey(`sidebar/material/info`));u.setMarginRight(`4px`),u.onClick(function(){n.editScript.dispatch(i,`programInfo`)}),l.add(u);let d=new c(r.getKey(`sidebar/material/vertex`));d.setMarginRight(`4px`),d.onClick(function(){n.editScript.dispatch(i,`vertexShader`)}),l.add(d);let f=new c(r.getKey(`sidebar/material/fragment`));f.setMarginRight(`4px`),f.onClick(function(){n.editScript.dispatch(i,`fragmentShader`)}),l.add(f);function p(n,r=0){i=n,a=r,i!==null&&i.material!==void 0&&(o=e.getObjectMaterial(i,a),t in o?l.setDisplay(``):l.setDisplay(`none`))}return n.objectSelected.add(p),n.materialChanged.add(p),l}function Rt(e){let t=e.signals,r=e.strings,i,a=0,l=new u;l.setBorderTop(`0`),l.setDisplay(`none`),l.setPaddingTop(`20px`);let d=new s;d.add(new y(r.getKey(`sidebar/material/slot`)).setClass(`Label`));let f=new o().setWidth(`170px`).setFontSize(`12px`).onChange(Y);f.setOptions({0:``}).setValue(0),d.add(f),l.add(d);let p=new s,m=new o().setWidth(`150px`).setFontSize(`12px`).onChange(Y);p.add(new y(r.getKey(`sidebar/material/type`)).setClass(`Label`)),p.add(m),l.add(p);let h=new s,g=new _().setWidth(`102px`).setFontSize(`12px`).setDisabled(!0),v=new c(r.getKey(`sidebar/material/new`)).setMarginLeft(`7px`);v.onClick(function(){g.setValue(D.MathUtils.generateUUID()),Y()}),h.add(new y(r.getKey(`sidebar/material/uuid`)).setClass(`Label`)),h.add(g),h.add(v),l.add(h);let b=new s,x=new _().setWidth(`150px`).setFontSize(`12px`).onChange(function(){e.execute(new Ve(e,e.selected,`name`,x.getValue(),a))});b.add(new y(r.getKey(`sidebar/material/name`)).setClass(`Label`)),b.add(x),l.add(b);let S=new Lt(e,`vertexShader`);l.add(S);let C=new Pt(e,`color`,r.getKey(`sidebar/material/color`));l.add(C);let w=new Pt(e,`specular`,r.getKey(`sidebar/material/specular`));l.add(w);let T=new $(e,`shininess`,r.getKey(`sidebar/material/shininess`));l.add(T);let E=new Pt(e,`emissive`,r.getKey(`sidebar/material/emissive`));l.add(E);let O=new $(e,`reflectivity`,r.getKey(`sidebar/material/reflectivity`));l.add(O);let k=new $(e,`ior`,r.getKey(`sidebar/material/ior`),[1,2.333],3);l.add(k);let A=new $(e,`roughness`,r.getKey(`sidebar/material/roughness`),[0,1]);l.add(A);let j=new $(e,`metalness`,r.getKey(`sidebar/material/metalness`),[0,1]);l.add(j);let M=new $(e,`clearcoat`,r.getKey(`sidebar/material/clearcoat`),[0,1]);l.add(M);let N=new $(e,`clearcoatRoughness`,r.getKey(`sidebar/material/clearcoatroughness`),[0,1]);l.add(N);let P=new $(e,`dispersion`,r.getKey(`sidebar/material/dispersion`),[0,10]);l.add(P);let F=new $(e,`iridescence`,r.getKey(`sidebar/material/iridescence`),[0,1]);l.add(F);let I=new $(e,`iridescenceIOR`,r.getKey(`sidebar/material/iridescenceIOR`),[1,5]);l.add(I);let L=new It(e,`iridescenceThicknessRange`,r.getKey(`sidebar/material/iridescenceThicknessMax`),!1,[0,1/0],0,10,1,`nm`);l.add(L);let ee=new $(e,`sheen`,r.getKey(`sidebar/material/sheen`),[0,1]);l.add(ee);let te=new $(e,`sheenRoughness`,r.getKey(`sidebar/material/sheenroughness`),[0,1]);l.add(te);let ne=new Pt(e,`sheenColor`,r.getKey(`sidebar/material/sheencolor`));l.add(ne);let re=new $(e,`transmission`,r.getKey(`sidebar/material/transmission`),[0,1]);l.add(re);let R=new $(e,`attenuationDistance`,r.getKey(`sidebar/material/attenuationDistance`));l.add(R);let ie=new Pt(e,`attenuationColor`,r.getKey(`sidebar/material/attenuationColor`));l.add(ie);let z=new $(e,`thickness`,r.getKey(`sidebar/material/thickness`));l.add(z);let B=new Nt(e,`vertexColors`,r.getKey(`sidebar/material/vertexcolors`));l.add(B);let ae={[D.BasicDepthPacking]:`Basic`,[D.RGBADepthPacking]:`RGBA`},V=new Ft(e,`depthPacking`,r.getKey(`sidebar/material/depthPacking`),ae);l.add(V);let H=new Q(e,`map`,r.getKey(`sidebar/material/map`));l.add(H);let U=new Q(e,`specularMap`,r.getKey(`sidebar/material/specularmap`));l.add(U);let W=new Q(e,`emissiveMap`,r.getKey(`sidebar/material/emissivemap`));l.add(W);let oe=new Q(e,`matcap`,r.getKey(`sidebar/material/matcap`));l.add(oe);let se=new Q(e,`alphaMap`,r.getKey(`sidebar/material/alphamap`));l.add(se);let ce=new Q(e,`bumpMap`,r.getKey(`sidebar/material/bumpmap`));l.add(ce);let le=new Q(e,`normalMap`,r.getKey(`sidebar/material/normalmap`));l.add(le);let ue=new Q(e,`clearcoatMap`,r.getKey(`sidebar/material/clearcoatmap`));l.add(ue);let de=new Q(e,`clearcoatNormalMap`,r.getKey(`sidebar/material/clearcoatnormalmap`));l.add(de);let fe=new Q(e,`clearcoatRoughnessMap`,r.getKey(`sidebar/material/clearcoatroughnessmap`));l.add(fe);let pe=new Q(e,`displacementMap`,r.getKey(`sidebar/material/displacementmap`));l.add(pe);let me=new Q(e,`roughnessMap`,r.getKey(`sidebar/material/roughnessmap`));l.add(me);let he=new Q(e,`metalnessMap`,r.getKey(`sidebar/material/metalnessmap`));l.add(he);let ge=new Q(e,`iridescenceMap`,r.getKey(`sidebar/material/iridescencemap`));l.add(ge);let _e=new Q(e,`sheenColorMap`,r.getKey(`sidebar/material/sheencolormap`));l.add(_e);let ve=new Q(e,`sheenRoughnessMap`,r.getKey(`sidebar/material/sheenroughnessmap`));l.add(ve);let ye=new Q(e,`iridescenceThicknessMap`,r.getKey(`sidebar/material/iridescencethicknessmap`));l.add(ye);let be=new Q(e,`envMap`,r.getKey(`sidebar/material/envmap`));l.add(be);let xe=new Q(e,`lightMap`,r.getKey(`sidebar/material/lightmap`));l.add(xe);let Se=new Q(e,`aoMap`,r.getKey(`sidebar/material/aomap`));l.add(Se);let Ce=new Q(e,`gradientMap`,r.getKey(`sidebar/material/gradientmap`));l.add(Ce);let we=new Q(e,`transmissionMap`,r.getKey(`sidebar/material/transmissionmap`));l.add(we);let Te=new Q(e,`thicknessMap`,r.getKey(`sidebar/material/thicknessmap`));l.add(Te);let Ee=new Ft(e,`side`,r.getKey(`sidebar/material/side`),{0:`Front`,1:`Back`,2:`Double`});l.add(Ee);let De=new $(e,`size`,r.getKey(`sidebar/material/size`),[0,1/0]);l.add(De);let Oe=new Nt(e,`sizeAttenuation`,r.getKey(`sidebar/material/sizeAttenuation`));l.add(Oe);let G=new Nt(e,`flatShading`,r.getKey(`sidebar/material/flatShading`));l.add(G);let ke=new Ft(e,`blending`,r.getKey(`sidebar/material/blending`),{0:`No`,1:`Normal`,2:`Additive`,3:`Subtractive`,4:`Multiply`,5:`Custom`});l.add(ke);let K=new $(e,`opacity`,r.getKey(`sidebar/material/opacity`),[0,1]);l.add(K);let Ae=new Nt(e,`transparent`,r.getKey(`sidebar/material/transparent`));l.add(Ae);let je=new Nt(e,`forceSinglePass`,r.getKey(`sidebar/material/forcesinglepass`));l.add(je);let Me=new $(e,`alphaTest`,r.getKey(`sidebar/material/alphatest`),[0,1]);l.add(Me);let Ne=new Nt(e,`depthTest`,r.getKey(`sidebar/material/depthtest`));l.add(Ne);let Pe=new Nt(e,`depthWrite`,r.getKey(`sidebar/material/depthwrite`));l.add(Pe);let Fe=new Nt(e,`wireframe`,r.getKey(`sidebar/material/wireframe`));l.add(Fe);let q=new s,J=new n().setWidth(`150px`).setHeight(`40px`).setFontSize(`12px`).onChange(Y);J.onKeyUp(function(){try{JSON.parse(J.getValue()),J.dom.classList.add(`success`),J.dom.classList.remove(`fail`)}catch{J.dom.classList.remove(`success`),J.dom.classList.add(`fail`)}}),q.add(new y(r.getKey(`sidebar/material/userdata`)).setClass(`Label`)),q.add(J),l.add(q);let Ie=new c(r.getKey(`sidebar/material/export`));Ie.setMarginLeft(`120px`),Ie.onClick(function(){let t=e.selected,n=(Array.isArray(t.material)?t.material[a]:t.material).toJSON();try{n=JSON.stringify(n,null,`	`),n=n.replace(/[\n\t]+([\d\.e\-\[\]]+)/g,`$1`)}catch{n=JSON.stringify(n)}e.utils.save(new Blob([n]),`${x.getValue()||`material`}.json`)}),l.add(Ie);function Y(){let t=a;a=parseInt(f.getValue()),a!==t&&e.signals.materialChanged.dispatch(i,a);let n=e.getObjectMaterial(i,a);if(n){if(n.uuid!==void 0&&n.uuid!==g.getValue()&&e.execute(new Ve(e,i,`uuid`,g.getValue(),a)),n.type!==m.getValue()){n=new zt[m.getValue()],n.type===`RawShaderMaterial`&&(n.vertexShader=Bt+n.vertexShader);let t=i.material;if(n.type===`MeshPhysicalMaterial`&&t.type===`MeshStandardMaterial`)for(let e of[`color`,`emissive`,`roughness`,`metalness`,`map`,`emissiveMap`,`alphaMap`,`bumpMap`,`normalMap`,`normalScale`,`displacementMap`,`roughnessMap`,`metalnessMap`,`envMap`,`lightMap`,`aoMap`,`side`]){let r=t[e];r!==null&&(r.clone===void 0?n[e]=r:n[e]=r.clone())}Array.isArray(t)?e.removeMaterial(t[a]):e.removeMaterial(t),e.execute(new Re(e,i,n,a),r.getKey(`command/SetMaterial`)+`: `+m.getValue()),e.addMaterial(n)}try{let t=JSON.parse(J.getValue());JSON.stringify(n.userData)!=JSON.stringify(t)&&e.execute(new Ve(e,i,`userData`,t,a))}catch(e){console.warn(e)}ze()}}function Le(){let e=i.material;Array.isArray(e)?d.setDisplay(``):d.setDisplay(`none`)}function ze(){if(!i)return;let t=i.material;if(Array.isArray(t)){let e={};a=Math.max(0,Math.min(t.length,a));for(let n=0;n<t.length;n++)e[n]=String(n+1)+`: `+t[n].name;f.setOptions(e).setValue(a)}t=e.getObjectMaterial(i,a),t.uuid!==void 0&&g.setValue(t.uuid),t.name!==void 0&&x.setValue(t.name),i.isMesh?m.setOptions(Vt):i.isSprite?m.setOptions(Ut):i.isPoints?m.setOptions(Wt):i.isLine&&m.setOptions(Ht),m.setValue(t.type),Le();try{J.setValue(JSON.stringify(t.userData,null,`  `))}catch(e){console.log(e)}J.setBorderColor(`transparent`),J.setBackgroundColor(``)}return t.objectSelected.add(function(e){let t=!1;e&&e.material&&(t=!0,Array.isArray(e.material)&&e.material.length===0&&(t=!1)),t?(i=e,ze(),l.setDisplay(``)):(i=null,l.setDisplay(`none`))}),t.materialChanged.add(ze),l}var zt={LineBasicMaterial:D.LineBasicMaterial,LineDashedMaterial:D.LineDashedMaterial,MeshBasicMaterial:D.MeshBasicMaterial,MeshDepthMaterial:D.MeshDepthMaterial,MeshNormalMaterial:D.MeshNormalMaterial,MeshLambertMaterial:D.MeshLambertMaterial,MeshMatcapMaterial:D.MeshMatcapMaterial,MeshPhongMaterial:D.MeshPhongMaterial,MeshToonMaterial:D.MeshToonMaterial,MeshStandardMaterial:D.MeshStandardMaterial,MeshPhysicalMaterial:D.MeshPhysicalMaterial,RawShaderMaterial:D.RawShaderMaterial,ShaderMaterial:D.ShaderMaterial,ShadowMaterial:D.ShadowMaterial,SpriteMaterial:D.SpriteMaterial,PointsMaterial:D.PointsMaterial},Bt=[`uniform mat4 projectionMatrix;`,`uniform mat4 modelViewMatrix;
`,`attribute vec3 position;

`].join(`
`),Vt={MeshBasicMaterial:`MeshBasicMaterial`,MeshDepthMaterial:`MeshDepthMaterial`,MeshNormalMaterial:`MeshNormalMaterial`,MeshLambertMaterial:`MeshLambertMaterial`,MeshMatcapMaterial:`MeshMatcapMaterial`,MeshPhongMaterial:`MeshPhongMaterial`,MeshToonMaterial:`MeshToonMaterial`,MeshStandardMaterial:`MeshStandardMaterial`,MeshPhysicalMaterial:`MeshPhysicalMaterial`,RawShaderMaterial:`RawShaderMaterial`,ShaderMaterial:`ShaderMaterial`,ShadowMaterial:`ShadowMaterial`},Ht={LineBasicMaterial:`LineBasicMaterial`,LineDashedMaterial:`LineDashedMaterial`,RawShaderMaterial:`RawShaderMaterial`,ShaderMaterial:`ShaderMaterial`},Ut={SpriteMaterial:`SpriteMaterial`,RawShaderMaterial:`RawShaderMaterial`,ShaderMaterial:`ShaderMaterial`},Wt={PointsMaterial:`PointsMaterial`,RawShaderMaterial:`RawShaderMaterial`,ShaderMaterial:`ShaderMaterial`};function Gt(e){let t=e.strings,n=e.signals,r=new u;r.setBorderTop(`0`),r.setPaddingTop(`20px`),r.setDisplay(`none`);let i=new s;r.add(i);let a=new c(t.getKey(`sidebar/script/new`));a.onClick(function(){e.execute(new Pe(e,e.selected,{name:``,source:`function update( event ) {}`}))}),r.add(a);function o(){i.clear(),i.setDisplay(`none`);let r=e.selected;if(r===null)return;let a=e.scripts[r.uuid];if(a!==void 0&&a.length>0){i.setDisplay(`block`);for(let o=0;o<a.length;o++)(function(r,a){let o=new _(a.name).setWidth(`130px`).setFontSize(`12px`);o.onChange(function(){e.execute(new Ke(e,e.selected,a,`name`,this.getValue()))}),i.add(o);let s=new c(t.getKey(`sidebar/script/edit`));s.setMarginLeft(`4px`),s.onClick(function(){n.editScript.dispatch(r,a)}),i.add(s);let l=new c(t.getKey(`sidebar/script/remove`));l.setMarginLeft(`4px`),l.onClick(function(){confirm(t.getKey(`prompt/script/remove`))&&e.execute(new J(e,e.selected,a))}),i.add(l),i.add(new m)})(r,a[o])}}return n.objectSelected.add(function(t){t!==null&&e.camera!==t?(r.setDisplay(`block`),o()):r.setDisplay(`none`)}),n.scriptAdded.add(o),n.scriptRemoved.add(o),n.scriptChanged.add(o),r}function Kt(e){let t=e.strings,n=new v;n.setId(`properties`),n.addTab(`objectTab`,t.getKey(`sidebar/properties/object`),new Ot(e)),n.addTab(`geometryTab`,t.getKey(`sidebar/properties/geometry`),new Mt(e)),n.addTab(`materialTab`,t.getKey(`sidebar/properties/material`),new Rt(e)),n.addTab(`scriptTab`,t.getKey(`sidebar/properties/script`),new Gt(e)),n.select(`objectTab`);function r(e,t){return e.find(function(e){return e.dom.id===t})}let i=r(n.tabs,`geometryTab`),a=r(n.tabs,`materialTab`),o=r(n.tabs,`scriptTab`);function s(t){n.setHidden(t===null),t!==null&&(i.setHidden(!t.geometry),a.setHidden(!t.material),o.setHidden(t===e.camera),n.selected===`geometryTab`?n.select(i.isHidden()?`objectTab`:`geometryTab`):n.selected===`materialTab`?n.select(a.isHidden()?`objectTab`:`materialTab`):n.selected===`scriptTab`&&n.select(o.isHidden()?`objectTab`:`scriptTab`))}return e.signals.objectSelected.add(s),s(e.selected),n}function qt(e){let n=e.config,r=e.signals,i=e.strings,a=e.utils.save,o=new u;o.setId(`app`);let l=new s;l.add(new y(i.getKey(`sidebar/project/app`).toUpperCase())),o.add(l);let d=new s,f=new _(n.getKey(`project/title`)).setLeft(`100px`).setWidth(`150px`).onChange(function(){n.setKey(`project/title`,this.getValue())});d.add(new y(i.getKey(`sidebar/project/app/title`)).setClass(`Label`)),d.add(f),o.add(d);let p=new s,m=new t(n.getKey(`project/editable`)).setLeft(`100px`).onChange(function(){n.setKey(`project/editable`,this.getValue())});p.add(new y(i.getKey(`sidebar/project/app/editable`)).setClass(`Label`)),p.add(m),o.add(p);let h=!1,g=new c(i.getKey(`sidebar/project/app/play`));g.setWidth(`170px`),g.setMarginLeft(`120px`),g.setMarginBottom(`10px`),g.onClick(function(){h===!1?(h=!0,g.setTextContent(i.getKey(`sidebar/project/app/stop`)),r.startPlayer.dispatch()):(h=!1,g.setTextContent(i.getKey(`sidebar/project/app/play`)),r.stopPlayer.dispatch())}),o.add(g);let v=new c(i.getKey(`sidebar/project/app/publish`));return v.setWidth(`170px`),v.setMarginLeft(`120px`),v.setMarginBottom(`10px`),v.onClick(function(){let t={},r=n.getKey(`project/renderer/type`),i=e.toJSON();i.metadata.type=`App`,delete i.history,i=JSON.stringify(i,null,`	`),i=i.replace(/[\n\t]+([\d\.e\-\[\]]+)/g,`$1`),t[`app.json`]=W(i);let o=n.getKey(`project/title`),s=new D.LoadingManager(function(){let e=se(t,{level:9});a(new Blob([e.buffer],{type:`application/zip`}),(o===``?`untitled`:o)+`.zip`)}),c=new D.FileLoader(s);c.load(`js/libs/app/index.html`,function(e){e=e.replace(`<!-- title -->`,o);let i=JSON.stringify({WebGLRenderer:{imports:{three:`./js/three.module.js`}},WebGPURenderer:{imports:{three:`./js/three.webgpu.js`,"three/webgpu":`./js/three.webgpu.js`}}}[r],null,`	`);e=e.replace(`<!-- importmap -->`,Jt(`
`+Jt(i,1)+`
`,2));let a=``;n.getKey(`project/editable`)&&(a=[`			let button = document.createElement( 'a' );`,`			button.href = 'https://threejs.org/editor/#file=' + location.href.split( '/' ).slice( 0, - 1 ).join( '/' ) + '/app.json';`,`			button.style.cssText = 'position: absolute; bottom: 20px; right: 20px; padding: 10px 16px; color: #fff; border: 1px solid #fff; border-radius: 20px; text-decoration: none;';`,`			button.target = '_blank';`,`			button.textContent = 'EDIT';`,`			document.body.appendChild( button );`].join(`
`)),e=e.replace(`			/* edit button */`,a),t[`index.html`]=W(e)}),c.load(`js/libs/app.js`,function(e){t[`js/app.js`]=W(e)}),c.load(`../build/three.core.js`,function(e){t[`js/three.core.js`]=W(e)}),r===`WebGPURenderer`?c.load(`../build/three.webgpu.js`,function(e){t[`js/three.webgpu.js`]=W(e)}):c.load(`../build/three.module.js`,function(e){t[`js/three.module.js`]=W(e)})}),o.add(v),r.editorCleared.add(function(){f.setValue(``),n.setKey(`project/title`,``)}),o}function Jt(e,t,n=`	`){return e.split(`
`).map(e=>n.repeat(t)+e).join(`
`)}function Yt(e){let t=e.config,n=e.signals,r=e.strings,i=null,a=new u;a.setBorderTop(`0px`);let c=new s;a.add(c),c.add(new y(r.getKey(`sidebar/project/renderer`)).setClass(`Label`));let l=new o().setOptions({WebGLRenderer:`WebGL`,WebGPURenderer:`WebGPU`}).setWidth(`150px`).onChange(C);l.setValue(t.getKey(`project/renderer/type`)),c.add(l);let d=new s;a.add(d),d.add(new y(r.getKey(`sidebar/project/antialias`)).setClass(`Label`));let f=new E(t.getKey(`project/renderer/antialias`)).onChange(C);d.add(f);let m=new s;a.add(m),m.add(new y(r.getKey(`sidebar/project/shadows`)).setClass(`Label`));let h=new E(t.getKey(`project/renderer/shadows`)).onChange(_);m.add(h);let g=new o().setOptions({0:`Basic`,1:`PCF`,3:`VSM`}).setWidth(`125px`).onChange(_);g.setValue(t.getKey(`project/renderer/shadowType`)),m.add(g);function _(){i.shadowMap.enabled=h.getValue(),i.shadowMap.type=parseFloat(g.getValue()),n.rendererUpdated.dispatch()}let v=new s;a.add(v),v.add(new y(r.getKey(`sidebar/project/toneMapping`)).setClass(`Label`));let b=new o().setOptions({0:`No`,1:`Linear`,2:`Reinhard`,3:`Cineon`,4:`ACESFilmic`,6:`AgX`,7:`Neutral`}).setWidth(`120px`).onChange(S);b.setValue(t.getKey(`project/renderer/toneMapping`)),v.add(b);let x=new p(t.getKey(`project/renderer/toneMappingExposure`));x.setDisplay(b.getValue()===`0`?`none`:``),x.setWidth(`30px`).setMarginLeft(`10px`),x.setRange(0,10),x.onChange(S),v.add(x);function S(){x.setDisplay(b.getValue()===`0`?`none`:``),i.toneMapping=parseFloat(b.getValue()),i.toneMappingExposure=x.getValue(),n.rendererUpdated.dispatch()}async function C(){let e=l.getValue(),t=f.getValue();e===`WebGPURenderer`?(i=new me({antialias:t,logarithmicDepthBuffer:!0}),await i.init()):i=new D.WebGLRenderer({antialias:t,logarithmicDepthBuffer:!0}),i.shadowMap.enabled=h.getValue(),i.shadowMap.type=parseFloat(g.getValue()),i.toneMapping=parseFloat(b.getValue()),i.toneMappingExposure=x.getValue(),n.rendererCreated.dispatch(i),n.rendererUpdated.dispatch()}return C(),n.editorCleared.add(function(){i.shadowMap.enabled=!0,i.shadowMap.type=D.PCFShadowMap,i.toneMapping=D.NeutralToneMapping,i.toneMappingExposure=1,h.setValue(i.shadowMap.enabled),g.setValue(i.shadowMap.type),b.setValue(i.toneMapping),x.setValue(i.toneMappingExposure),x.setDisplay(i.toneMapping===0?`none`:``),n.rendererUpdated.dispatch()}),n.rendererUpdated.add(function(){t.setKey(`project/renderer/type`,l.getValue(),`project/renderer/antialias`,f.getValue(),`project/renderer/shadows`,h.getValue(),`project/renderer/shadowType`,parseFloat(g.getValue()),`project/renderer/toneMapping`,parseFloat(b.getValue()),`project/renderer/toneMappingExposure`,x.getValue())}),a}function Xt(e){let t=e.signals,n=e.strings,r=new v,i=new u;i.dom.style.borderTop=`none`;let o=new a;o.dom.style.height=`140px`,o.dom.style.resize=`vertical`,o.dom.style.marginBottom=`10px`,i.add(o);let s=new c(n.getKey(`sidebar/project/Assign`));i.add(s);let l=new y;l.dom.style.float=`right`,i.add(l),s.onClick(function(){let t=e.selected;if(t!==null&&t.geometry!==void 0){let n=o.getValue(),r=Object.values(e.geometries).find(e=>e.id===parseInt(n));r!==void 0&&e.execute(new g(e,t,r))}}),r.addTab(`geometries`,n.getKey(`sidebar/project/geometries`),i);let d=new u;d.dom.style.borderTop=`none`;let f=new a;f.dom.style.height=`140px`,f.dom.style.resize=`vertical`,f.dom.style.marginBottom=`10px`,d.add(f);let p=new c(n.getKey(`sidebar/project/Assign`));d.add(p);let m=new y;m.dom.style.float=`right`,d.add(m),p.onClick(function(){let t=e.selected;if(t!==null&&t.material!==void 0){let n=f.getValue(),r=Object.values(e.materials).find(e=>e.id===parseInt(n));r!==void 0&&e.execute(new Re(e,t,r))}}),r.addTab(`materials`,n.getKey(`sidebar/project/materials`),d);let h=new u;h.dom.style.borderTop=`none`;let _=new a;_.dom.style.height=`140px`,_.dom.style.resize=`vertical`,_.dom.style.marginBottom=`10px`,h.add(_);let b=new y;b.dom.style.float=`right`,h.add(b),r.addTab(`textures`,n.getKey(`sidebar/project/textures`),h),r.select(`geometries`);function x(){let t=Object.values(e.geometries);o.setItems(t),l.setValue(t.length+` `+n.getKey(`sidebar/project/geometries`).toLowerCase())}function S(){let t=Object.values(e.materials);f.setItems(t),m.setValue(t.length+` `+n.getKey(`sidebar/project/materials`).toLowerCase())}function C(){let t=[],r=new Set,i=Object.values(e.materials);for(let e of i)for(let n in e){let i=e[n];i!=null&&i.isTexture===!0&&r.has(i.uuid)===!1&&(t.push(i),r.add(i.uuid))}_.setItems(t),b.setValue(t.length+` `+n.getKey(`sidebar/project/textures`).toLowerCase())}function w(){x(),S(),C()}let T;function E(){clearTimeout(T),T=setTimeout(w,100)}return t.editorCleared.add(E),t.sceneGraphChanged.add(E),t.geometryChanged.add(E),t.materialAdded.add(E),t.materialChanged.add(E),t.materialRemoved.add(E),t.objectSelected.add(function(t){if(t!==null){let n=Object.values(e.geometries),r=Object.values(e.materials);if(t.geometry!==void 0){let e=n.indexOf(t.geometry);o.selectIndex(e)}if(t.material!==void 0){let e=Array.isArray(t.material)?t.material[0]:t.material,n=r.indexOf(e);f.selectIndex(n)}}else o.selectIndex(-1),f.selectIndex(-1)}),r}function Zt(t){let n=new e;return n.add(new Yt(t)),n.add(new qt(t)),n.add(new Xt(t)),n}function Qt(e){let t=e.strings,n=navigator.platform.toUpperCase().indexOf(`MAC`)>=0;function r(e){return e.match(/^[A-Za-z0-9]$/i)}let i=e.config,a=e.signals,o=new u,c=new s;c.add(new y(t.getKey(`sidebar/settings/shortcuts`).toUpperCase())),o.add(c);let l=[`translate`,`rotate`,`scale`,`undo`,`focus`];function d(e){let n=`settings/shortcuts/`+e,a=new s,c=new _().setWidth(`15px`).setFontSize(`12px`);c.setTextAlign(`center`),c.setTextTransform(`lowercase`),c.onChange(function(){let e=c.getValue().toLowerCase();r(e)&&i.setKey(n,e)}),c.dom.addEventListener(`click`,function(){c.dom.select()}),c.dom.addEventListener(`blur`,function(){r(c.getValue())||c.setValue(i.getKey(n))}),c.dom.addEventListener(`keyup`,function(e){r(e.key)&&c.dom.blur()}),i.getKey(n)!==void 0&&c.setValue(i.getKey(n)),c.dom.maxLength=1,a.add(new y(t.getKey(`sidebar/settings/shortcuts/`+e)).setTextTransform(`capitalize`).setClass(`Label`)),a.add(c),o.add(a)}for(let e=0;e<l.length;e++)d(l[e]);return document.addEventListener(`keydown`,function(t){switch(t.key.toLowerCase()){case`backspace`:t.preventDefault();case`delete`:let r=e.selected;if(r===null)return;r.parent!==null&&e.execute(new q(e,r));break;case i.getKey(`settings/shortcuts/translate`):a.transformModeChanged.dispatch(`translate`);break;case i.getKey(`settings/shortcuts/rotate`):a.transformModeChanged.dispatch(`rotate`);break;case i.getKey(`settings/shortcuts/scale`):a.transformModeChanged.dispatch(`scale`);break;case i.getKey(`settings/shortcuts/undo`):(n?t.metaKey:t.ctrlKey)&&(t.preventDefault(),t.shiftKey?e.redo():e.undo());break;case i.getKey(`settings/shortcuts/focus`):e.selected!==null&&e.focus(e.selected);break}}),o}function $t(e){let t=e.strings,n=e.signals,r=e.config,i=e.history,a=new u;a.add(new y(t.getKey(`sidebar/history`).toUpperCase()));let o=new E(r.getKey(`settings/history`),t.getKey(`sidebar/history/persistent`));o.setPosition(`absolute`).setRight(`8px`),o.onChange(function(){let a=this.getValue();if(r.setKey(`settings/history`,a),a){alert(t.getKey(`prompt/history/preserve`));let n=i.undos[i.undos.length-1],r=n===void 0?0:n.id;e.history.enableSerialization(r)}else n.historyChanged.dispatch()}),a.add(o),a.add(new m,new m);let s=!1,l=new C(e);l.onChange(function(){s=!0,e.history.goToState(parseInt(l.getValue())),s=!1}),a.add(l),a.add(new m);let d=new c(t.getKey(`sidebar/history/clear`));d.onClick(function(){confirm(t.getKey(`prompt/history/clear`))&&e.history.clear()}),a.add(d);let f=function(){let e=[];function t(e){let t=document.createElement(`div`);return t.value=e.id,t}(function(n){for(let r=0,i=n.length;r<i;r++){let i=n[r],a=t(i);a.innerHTML=`&nbsp;`+i.name,e.push(a)}})(i.undos),(function(n){for(let r=n.length-1;r>=0;r--){let i=n[r],a=t(i);a.innerHTML=`&nbsp;`+i.name,a.style.opacity=.3,e.push(a)}})(i.redos),l.setOptions(e)};return f(),n.editorCleared.add(f),n.historyChanged.add(f),n.historyChanged.add(function(e){s!==!0&&l.setValue(e===void 0?null:e.id)}),a}function en(t){let n=t.config,r=t.strings,i=new e,a=new u;a.setBorderTop(`0`),a.setPaddingTop(`20px`),i.add(a);let c=Object.fromEntries([`en`,`fr`,`zh`,`ja`,`ko`,`fa`].map(e=>[e,new Intl.DisplayNames(e,{type:`language`}).of(e)])),l=new s,d=new o().setWidth(`150px`);return d.setOptions(c),n.getKey(`language`)!==void 0&&d.setValue(n.getKey(`language`)),d.onChange(function(){let e=this.getValue();t.config.setKey(`language`,e)}),l.add(new y(r.getKey(`sidebar/settings/language`)).setClass(`Label`)),l.add(d),a.add(l),i.add(new Qt(t)),i.add(new $t(t)),i}function tn(t){let n=t.strings,r=new v;r.setId(`sidebar`);let i=new Kt(t),a=new e().add(new Dt(t),i),o=new Zt(t),s=new en(t);return r.addTab(`scene`,n.getKey(`sidebar/scene`),a),r.addTab(`project`,n.getKey(`sidebar/project`),o),r.addTab(`settings`,n.getKey(`sidebar/settings`),s),r.select(`scene`),new ResizeObserver(function(){i.tabsDiv.setWidth(getComputedStyle(r.dom).width)}).observe(r.tabsDiv.dom),r}function nn(e){let t=e.signals,n=e.strings,r=new u;r.setId(`toolbar`);let i=document.createElement(`img`);i.title=n.getKey(`toolbar/translate`),i.src=`images/translate.svg`;let a=new c;a.dom.className=`Button selected`,a.dom.appendChild(i),a.onClick(function(){t.transformModeChanged.dispatch(`translate`)}),r.add(a);let o=document.createElement(`img`);o.title=n.getKey(`toolbar/rotate`),o.src=`images/rotate.svg`;let s=new c;s.dom.appendChild(o),s.onClick(function(){t.transformModeChanged.dispatch(`rotate`)}),r.add(s);let l=document.createElement(`img`);l.title=n.getKey(`toolbar/scale`),l.src=`images/scale.svg`;let d=new c;return d.dom.appendChild(l),d.onClick(function(){t.transformModeChanged.dispatch(`scale`)}),r.add(d),t.startPlayer.add(function(){r.setDisplay(`none`)}),t.stopPlayer.add(function(){r.setDisplay(``)}),t.transformModeChanged.add(function(e){switch(a.dom.classList.remove(`selected`),s.dom.classList.remove(`selected`),d.dom.classList.remove(`selected`),e){case`translate`:a.dom.classList.add(`selected`);break;case`rotate`:s.dom.classList.add(`selected`);break;case`scale`:d.dom.classList.add(`selected`);break}}),r}var rn=class extends D.EventDispatcher{constructor(e){super(),this.enabled=!0,this.center=new D.Vector3,this.panSpeed=.002,this.zoomSpeed=.1,this.rotationSpeed=.005;var t=this,n=new D.Vector3,r=new D.Vector3,i=new D.Box3,a={NONE:-1,ROTATE:0,ZOOM:1,PAN:2},o=a.NONE,s=this.center,c=new D.Matrix3,l=new D.Vector2,u=new D.Vector2,d=new D.Spherical,f=new D.Sphere,p=[],m={},h=null,g={type:`change`};this.focus=function(n){var a;i.setFromObject(n),i.isEmpty()===!1?(i.getCenter(s),a=i.getBoundingSphere(f).radius):(s.setFromMatrixPosition(n.matrixWorld),a=.1),r.set(0,0,1),r.applyQuaternion(e.quaternion),r.multiplyScalar(a*4),e.position.copy(s).add(r),t.dispatchEvent(g)},this.pan=function(n){var r=e.position.distanceTo(s);n.multiplyScalar(r*t.panSpeed),n.applyMatrix3(c.getNormalMatrix(e.matrix)),e.position.add(n),s.add(n),t.dispatchEvent(g)},this.zoom=function(n){var r=e.position.distanceTo(s);n.multiplyScalar(r*t.zoomSpeed),!(n.length()>r)&&(n.applyMatrix3(c.getNormalMatrix(e.matrix)),e.position.add(n),t.dispatchEvent(g))},this.rotate=function(r){n.copy(e.position).sub(s),d.setFromVector3(n),d.theta+=r.x*t.rotationSpeed,d.phi+=r.y*t.rotationSpeed,d.makeSafe(),n.setFromSpherical(d),e.position.copy(s).add(n),e.lookAt(s),t.dispatchEvent(g)};function _(e){t.enabled!==!1&&(p.length===0&&(h.setPointerCapture(e.pointerId),h.ownerDocument.addEventListener(`pointermove`,v),h.ownerDocument.addEventListener(`pointerup`,y)),!N(e)&&(j(e),e.pointerType===`touch`?k(e):b(e)))}function v(e){t.enabled!==!1&&(e.pointerType===`touch`?A(e):x(e))}function y(e){switch(M(e),p.length){case 0:h.releasePointerCapture(e.pointerId),h.ownerDocument.removeEventListener(`pointermove`,v),h.ownerDocument.removeEventListener(`pointerup`,y);break;case 1:var t=p[0],n=m[t];k({pointerId:t,pageX:n.x,pageY:n.y});break}}function b(e){e.button===0?o=a.ROTATE:e.button===1?o=a.ZOOM:e.button===2&&(o=a.PAN),u.set(e.clientX,e.clientY)}function x(e){l.set(e.clientX,e.clientY);var n=l.x-u.x,i=l.y-u.y;o===a.ROTATE?t.rotate(r.set(-n,-i,0)):o===a.ZOOM?t.zoom(r.set(0,0,i)):o===a.PAN&&t.pan(r.set(-n,i,0)),u.set(e.clientX,e.clientY)}function S(){o=a.NONE}function C(e){t.enabled!==!1&&(e.preventDefault(),t.zoom(r.set(0,0,e.deltaY>0?1:-1)))}function w(e){e.preventDefault()}this.connect=function(e){h!==null&&this.disconnect(),h=e,h.addEventListener(`contextmenu`,w),h.addEventListener(`dblclick`,S),h.addEventListener(`wheel`,C,{passive:!1}),h.addEventListener(`pointerdown`,_)},this.disconnect=function(){h.removeEventListener(`contextmenu`,w),h.removeEventListener(`dblclick`,S),h.removeEventListener(`wheel`,C),h.removeEventListener(`pointerdown`,_),h=null};var T=[new D.Vector3,new D.Vector3,new D.Vector3],E=[new D.Vector3,new D.Vector3,new D.Vector3],O=null;function k(e){switch(P(e),p.length){case 1:T[0].set(e.pageX,e.pageY,0).divideScalar(window.devicePixelRatio),T[1].set(e.pageX,e.pageY,0).divideScalar(window.devicePixelRatio);break;case 2:var t=F(e);T[0].set(e.pageX,e.pageY,0).divideScalar(window.devicePixelRatio),T[1].set(t.x,t.y,0).divideScalar(window.devicePixelRatio),O=T[0].distanceTo(T[1]);break}E[0].copy(T[0]),E[1].copy(T[1])}function A(e){P(e);function n(e,t){var n=t[0];for(var r of t)n.distanceTo(e)>r.distanceTo(e)&&(n=r);return n}switch(p.length){case 1:T[0].set(e.pageX,e.pageY,0).divideScalar(window.devicePixelRatio),T[1].set(e.pageX,e.pageY,0).divideScalar(window.devicePixelRatio),t.rotate(T[0].sub(n(T[0],E)).multiplyScalar(-1));break;case 2:var i=F(e);T[0].set(e.pageX,e.pageY,0).divideScalar(window.devicePixelRatio),T[1].set(i.x,i.y,0).divideScalar(window.devicePixelRatio);var a=T[0].distanceTo(T[1])/10;t.zoom(r.set(0,0,O-a)),O=a;var o=T[0].clone().sub(n(T[0],E)),s=T[1].clone().sub(n(T[1],E));o.x=-o.x,s.x=-s.x,t.pan(o.add(s));break}E[0].copy(T[0]),E[1].copy(T[1])}function j(e){p.push(e.pointerId)}function M(e){delete m[e.pointerId];for(var t=0;t<p.length;t++)if(p[t]==e.pointerId){p.splice(t,1);return}}function N(e){for(var t=0;t<p.length;t++)if(p[t]==e.pointerId)return!0;return!1}function P(e){var t=m[e.pointerId];t===void 0&&(t=new D.Vector2,m[e.pointerId]=t),t.set(e.pageX,e.pageY)}function F(e){return m[e.pointerId===p[0]?p[1]:p[0]]}}fromJSON(e){e.center!==void 0&&this.center.fromArray(e.center)}toJSON(){return{center:this.center.toArray()}}};function an(e){let t=e.signals,n=new u;n.setPosition(`absolute`),n.setRight(`10px`),n.setTop(`10px`);let r=new o;r.setMarginRight(`10px`),r.onChange(function(){e.setViewportCamera(this.getValue())}),n.add(r),t.cameraAdded.add(s),t.cameraRemoved.add(s),t.objectChanged.add(function(e){e.isCamera&&a()});let i=new o;i.setOptions({realistic:`realistic`,solid:`solid`,normals:`normals`,wireframe:`wireframe`}),i.setValue(`solid`),i.onChange(function(){e.setViewportShading(this.getValue())}),n.add(i),t.editorCleared.add(function(){e.setViewportCamera(e.camera.uuid),i.setValue(`solid`),e.setViewportShading(i.getValue())}),t.cameraResetted.add(s),s();function a(){let t={},n=e.cameras;for(let e in n){let r=n[e];t[r.uuid]=r.name}r.setOptions(t);let i=e.viewportCamera.uuid in t?e.viewportCamera:e.camera;return r.setValue(i.uuid),i}function s(){let t=a();e.setViewportCamera(t.uuid)}return n}function on(e){let t=e.signals,n=e.strings,r=new u;r.setId(`info`),r.setPosition(`absolute`),r.setLeft(`10px`),r.setBottom(`50px`),r.setFontSize(`12px`),r.setColor(`#fff`),r.setTextTransform(`lowercase`);let i=new y(`0`).setTextAlign(`right`).setWidth(`60px`).setMarginRight(`6px`),a=new y(`0`).setTextAlign(`right`).setWidth(`60px`).setMarginRight(`6px`),o=new y(`0`).setTextAlign(`right`).setWidth(`60px`).setMarginRight(`6px`),s=new y(`0`).setTextAlign(`right`).setWidth(`60px`).setMarginRight(`6px`),c=new y(`0`).setTextAlign(`right`).setWidth(`60px`).setMarginRight(`6px`).setHidden(!0),l=new y(n.getKey(`viewport/info/objects`)),d=new y(n.getKey(`viewport/info/vertices`)),f=new y(n.getKey(`viewport/info/triangles`)),p=new y(n.getKey(`viewport/info/samples`)).setHidden(!0);r.add(i,l,new m),r.add(a,d,new m),r.add(o,f,new m),r.add(s,new y(n.getKey(`viewport/info/rendertime`)),new m),r.add(c,p,new m),t.objectAdded.add(g),t.objectRemoved.add(g),t.objectChanged.add(g),t.geometryChanged.add(g),t.sceneRendered.add(_);let h=new Intl.PluralRules(e.config.getKey(`language`));function g(){let t=e.scene,r=0,s=0,c=0;for(let e=0,n=t.children.length;e<n;e++)t.children[e].traverseVisible(function(e){if(r++,e.isMesh||e.isPoints){let t=e.geometry,n=t.attributes.position;n!=null&&(s+=n.count),e.isMesh&&(t.index===null?n!=null&&(c+=n.count/3):c+=t.index.count/3)}});i.setValue(e.utils.formatNumber(r)),a.setValue(e.utils.formatNumber(s)),o.setValue(e.utils.formatNumber(c));let u=new Intl.PluralRules(e.config.getKey(`language`)),p=u.select(r)===`one`?`viewport/info/object`:`viewport/info/objects`;l.setValue(n.getKey(p));let m=u.select(s)===`one`?`viewport/info/vertex`:`viewport/info/vertices`;d.setValue(n.getKey(m));let h=u.select(c)===`one`?`viewport/info/triangle`:`viewport/info/triangles`;f.setValue(n.getKey(h))}function _(e){s.setValue(Number(e).toFixed(2))}return e.signals.pathTracerUpdated.add(function(e){e=Math.floor(e),c.setValue(e);let t=h.select(e)===`one`?`viewport/info/sample`:`viewport/info/samples`;p.setValue(n.getKey(t))}),e.signals.viewportShadingChanged.add(function(){let t=e.viewportShading===`realistic`;c.setHidden(!t),p.setHidden(!t),r.setBottom(t?`62px`:`50px`)}),r}var sn=class extends I{constructor(e,t){super(),this.isViewHelper=!0,this.animating=!1,this.center=new B,this.location={top:null,right:0,bottom:0,left:null},this.dim=128;let n=new A(`#ff4466`),r=new A(`#88ff44`),i=new A(`#4488ff`),a=new A(`#000000`),o={},s=[],c=new ne,l=new z,u=new I,d=new ee(-1.4,1.4,1.4,-1.4,0,4);d.position.set(0,0,2);let f=new j(.04,.04,.8,5).rotateZ(-Math.PI/2).translate(.4,0,0),p=new P(f,oe(n)),m=new P(f,oe(r)),h=new P(f,oe(i));m.rotation.z=Math.PI/2,h.rotation.y=-Math.PI/2,this.add(p),this.add(h),this.add(m);let g=le(n),_=le(r),v=le(i),y=le(a),b=new R(g),x=new R(_),S=new R(v),C=new R(y),w=new R(y),T=new R(y);b.position.x=1,x.position.y=1,S.position.z=1,C.position.x=-1,w.position.y=-1,T.position.z=-1,C.material.opacity=.2,w.material.opacity=.2,T.material.opacity=.2,b.userData.type=`posX`,x.userData.type=`posY`,S.userData.type=`posZ`,C.userData.type=`negX`,w.userData.type=`negY`,T.userData.type=`negZ`,this.add(b),this.add(x),this.add(S),this.add(C),this.add(w),this.add(T),s.push(b),s.push(x),s.push(S),s.push(C),s.push(w),s.push(T);let E=new B,D=2*Math.PI;this.render=function(n){this.quaternion.copy(e.quaternion).invert(),this.updateMatrixWorld(),E.set(0,0,1),E.applyQuaternion(e.quaternion);let r=this.location,i=this.dim,a,o;a=r.left===null?t.offsetWidth-i-r.right:r.left,o=r.top===null?n.isWebGPURenderer?t.offsetHeight-i-r.bottom:r.bottom:n.isWebGPURenderer?r.top:t.offsetHeight-i-r.top,n.clearDepth(),n.getViewport(H),n.setViewport(a,o,i,i),n.render(this,d),n.setViewport(H.x,H.y,H.z,H.w)};let O=new B,N=new te,L=new te,V=new te,H=new ae,U=0;this.handleClick=function(e){if(this.animating===!0)return!1;let n=t.getBoundingClientRect(),r=this.location,i=this.dim,a,o;a=r.left===null?n.left+t.offsetWidth-i-r.right:n.left+r.left,o=r.top===null?n.top+t.offsetHeight-i-r.bottom:n.top+r.top,l.x=(e.clientX-a)/i*2-1,l.y=-((e.clientY-o)/i)*2+1,c.setFromCamera(l,d);let u=c.intersectObjects(s);if(u.length>0){let e=u[0].object;return W(e,this.center),this.animating=!0,!0}else return!1},this.setLabels=function(e,t,n){o.labelX=e,o.labelY=t,o.labelZ=n,ue()},this.setLabelStyle=function(e,t,n){o.font=e,o.color=t,o.radius=n,ue()},this.update=function(t){let n=t*D;L.rotateTowards(V,n),e.position.set(0,0,1).applyQuaternion(L).multiplyScalar(U).add(this.center),e.quaternion.rotateTowards(N,n),L.angleTo(V)===0&&(this.animating=!1)},this.dispose=function(){f.dispose(),p.material.dispose(),m.material.dispose(),h.material.dispose(),b.material.map.dispose(),x.material.map.dispose(),S.material.map.dispose(),C.material.map.dispose(),w.material.map.dispose(),T.material.map.dispose(),b.material.dispose(),x.material.dispose(),S.material.dispose(),C.material.dispose(),w.material.dispose(),T.material.dispose()};function W(t,n){switch(t.userData.type){case`posX`:O.set(1,0,0),N.setFromEuler(new M(0,Math.PI*.5,0));break;case`posY`:O.set(0,1,0),N.setFromEuler(new M(-Math.PI*.5,0,0));break;case`posZ`:O.set(0,0,1),N.setFromEuler(new M);break;case`negX`:O.set(-1,0,0),N.setFromEuler(new M(0,-Math.PI*.5,0));break;case`negY`:O.set(0,-1,0),N.setFromEuler(new M(Math.PI*.5,0,0));break;case`negZ`:O.set(0,0,-1),N.setFromEuler(new M(0,Math.PI,0));break;default:console.error(`ViewHelper: Invalid axis.`)}U=e.position.distanceTo(n),O.multiplyScalar(U).add(n),u.position.copy(n),u.lookAt(e.position),L.copy(u.quaternion),u.lookAt(O),V.copy(u.quaternion)}function oe(e){return new F({color:e,toneMapped:!1})}function se(){let e=!1;try{e=typeof OffscreenCanvas<`u`&&new OffscreenCanvas(1,1).getContext(`2d`)!==null}catch{}return e}function ce(e,t){let n;return se()?n=new OffscreenCanvas(e,t):(n=document.createElement(`canvas`),n.width=e,n.height=t),n}function le(e,t){let{font:n=`24px Arial`,color:r=`#000000`,radius:i=14}=o,a=ce(64,64),s=a.getContext(`2d`);s.beginPath(),s.arc(32,32,i,0,2*Math.PI),s.closePath(),s.fillStyle=e.getStyle(),s.fill(),t&&(s.font=n,s.textAlign=`center`,s.fillStyle=r,s.fillText(t,32,41));let c=new k(a);return c.colorSpace=re,new ie({map:c,toneMapped:!1})}function ue(){b.material.map.dispose(),x.material.map.dispose(),S.material.map.dispose(),b.material.dispose(),x.material.dispose(),S.material.dispose(),b.material=le(n,o.labelX),x.material=le(r,o.labelY),S.material=le(i,o.labelZ)}}},cn=class extends sn{constructor(e,t){super(e,t.dom),this.setLabels(`X`,`Y`,`Z`),this.location.top=47,this.dim=98;let n=new u;n.setId(`viewHelper`),n.setPosition(`absolute`),n.setRight(`0px`),n.setTop(`47px`),n.setHeight(`98px`),n.setWidth(`98px`),n.dom.addEventListener(`pointerup`,e=>{e.stopPropagation(),this.handleClick(e)}),n.dom.addEventListener(`pointerdown`,function(e){e.stopPropagation()}),t.add(n)}},ln=class{constructor(e,t){let n=e.selector,r=e.signals,i=null,a=null,o=null,s=new D.PerspectiveCamera,c=async c=>{s.copy(e.camera);let u=document.getElementById(`sidebar`);if(u.style.width=`350px`,u.style.height=`700px`,i===null){let e=new D.BufferGeometry;e.setAttribute(`position`,new D.Float32BufferAttribute([0,0,0,0,0,-5],3));let s=new D.Line(e),c=new D.Raycaster;function l(e){let t=e.target;f.userData.active=!1,p.userData.active=!1,t===f&&(f.userData.active=!0,f.add(s)),t===p&&(p.userData.active=!0,p.add(s)),c.setFromXRController(t);let i=n.getIntersects(c);i.length>0&&i[0].object===a.children[0]||r.intersectionsDetected.dispatch(i)}function d(e){let n=e.target;if(n.userData.active!==!1)switch(t.getRaycaster().setFromXRController(n),e.type){case`selectstart`:t.pointerDown(null);break;case`selectend`:t.pointerUp(null);break;case`move`:t.pointerHover(null),t.pointerMove(null);break}}i=new D.Group;let f=o.xr.getController(0);f.addEventListener(`select`,l),f.addEventListener(`selectstart`,d),f.addEventListener(`selectend`,d),f.addEventListener(`move`,d),f.userData.active=!1,i.add(f);let p=o.xr.getController(1);p.addEventListener(`select`,l),p.addEventListener(`selectstart`,d),p.addEventListener(`selectend`,d),p.addEventListener(`move`,d),p.userData.active=!0,i.add(p);let m=new ve,h=o.xr.getControllerGrip(0);h.add(m.createControllerModel(h)),i.add(h);let g=o.xr.getControllerGrip(1);g.add(m.createControllerModel(g)),i.add(g),a=new _e;let _=new ge(u);_.name=`picker`,_.position.set(.5,1,-.5),_.rotation.y=-.5,a.add(_),a.listenToXRControllerEvents(f),a.listenToXRControllerEvents(p)}e.sceneHelpers.add(a),e.sceneHelpers.add(i),o.xr.enabled=!0,o.xr.addEventListener(`sessionend`,l),await o.xr.setSession(c)},l=async()=>{e.sceneHelpers.remove(a),e.sceneHelpers.remove(i);let t=document.getElementById(`sidebar`);t.style.width=``,t.style.height=``,o.xr.removeEventListener(`sessionend`,l),o.xr.enabled=!1,e.camera.copy(s),r.windowResize.dispatch(),r.leaveXR.dispatch()},u={optionalFeatures:[`local-floor`]};r.enterXR.add(e=>{`xr`in navigator&&navigator.xr.requestSession(e,u).then(c)}),r.offerXR.add(function(e){`xr`in navigator&&(navigator.xr.offerSession(e,u).then(c),r.leaveXR.add(function(){navigator.xr.offerSession(e,u).then(c)}))}),r.rendererCreated.add(e=>{o=e})}};function un(e){let t=e.selector,n=e.signals,r=new u;r.setId(`viewport`),r.setPosition(`absolute`),r.add(new an(e)),r.add(new on(e));let i=null,a=null,o=null,s=e.camera,c=e.scene,l=e.sceneHelpers,d=[10066329,7829367],f=[5592405,8947848],p=new D.Group,m=new D.GridHelper(30,30);m.material.color.setHex(d[0]),m.material.vertexColors=!1,p.add(m);let h=new D.GridHelper(30,6);h.material.color.setHex(d[1]),h.material.vertexColors=!1,p.add(h);let g=new cn(s,r),_=new D.Box3,v=new D.Box3Helper(_);v.material.depthTest=!1,v.material.transparent=!0,v.visible=!1,l.add(v);let y=null,b=null,x=null,S=new he(s);S.addEventListener(`axis-changed`,function(){e.viewportShading!==`realistic`&&V()}),S.addEventListener(`objectChange`,function(){n.objectChanged.dispatch(S.object)}),S.addEventListener(`mouseDown`,function(){let e=S.object;y=e.position.clone(),b=e.rotation.clone(),x=e.scale.clone(),F.enabled=!1}),S.addEventListener(`mouseUp`,function(){let t=S.object;if(t!==void 0)switch(S.getMode()){case`translate`:y.equals(t.position)||e.execute(new Ue(e,t,t.position,y));break;case`rotate`:b.equals(t.rotation)||e.execute(new We(e,t,t.rotation,b));break;case`scale`:x.equals(t.scale)||e.execute(new Ge(e,t,t.scale,x));break}F.enabled=!0}),l.add(S.getHelper()),new ln(e,S);function C(){for(let t in e.cameras){let n=e.cameras[t],i=r.dom.offsetWidth/r.dom.offsetHeight;n.isPerspectiveCamera?n.aspect=i:(n.left=-i,n.right=i),n.updateProjectionMatrix();let a=e.helpers[n.id];a&&a.update()}}let w=new D.Vector2,T=new D.Vector2,E=new D.Vector2;function O(e,t,n){let r=e.getBoundingClientRect();return[(t-r.left)/r.width,(n-r.top)/r.height]}function k(){if(w.distanceTo(T)===0){let e=t.getPointerIntersects(T,s);n.intersectionsDetected.dispatch(e),V()}}function A(e){if(e.target!==i.domElement)return;let t=O(r.dom,e.clientX,e.clientY);w.fromArray(t),document.addEventListener(`mouseup`,j)}function j(e){let t=O(r.dom,e.clientX,e.clientY);T.fromArray(t),k(),document.removeEventListener(`mouseup`,j)}function M(e){let t=e.changedTouches[0],n=O(r.dom,t.clientX,t.clientY);w.fromArray(n),document.addEventListener(`touchend`,N)}function N(e){let t=e.changedTouches[0],n=O(r.dom,t.clientX,t.clientY);T.fromArray(n),k(),document.removeEventListener(`touchend`,N)}function P(e){let i=O(r.dom,e.clientX,e.clientY);E.fromArray(i);let a=t.getPointerIntersects(E,s);if(a.length>0){let e=a[0];n.objectFocused.dispatch(e.object)}}r.dom.addEventListener(`mousedown`,A),r.dom.addEventListener(`touchstart`,M,{passive:!1}),r.dom.addEventListener(`dblclick`,P);let F=new rn(s);F.addEventListener(`change`,function(){n.cameraChanged.dispatch(s),n.refreshSidebarObject3D.dispatch(s)}),g.center=F.center,e.controls=F,n.editorCleared.add(function(){F.center.set(0,0,0),o&&o.reset(),ne(),n.sceneEnvironmentChanged.dispatch(e.environmentType)}),n.transformModeChanged.add(function(e){S.setMode(e),V()}),n.snapChanged.add(function(e){S.setTranslationSnap(e)}),n.spaceChanged.add(function(e){S.setSpace(e),V()}),n.rendererUpdated.add(function(){c.traverse(function(e){e.material!==void 0&&(e.material.needsUpdate=!0)}),V()}),n.rendererCreated.add(function(t){if(i!==null){i.setAnimationLoop(null);try{a.dispose()}catch(e){console.warn(`PMREMGenerator dispose error:`,e)}i.dispose(),r.dom.removeChild(i.domElement)}if(F.connect(t.domElement),S.connect(t.domElement),i=t,e.renderer=i,i.setAnimationLoop(te),i.setClearColor(11184810),window.matchMedia){let e=window.matchMedia(`(prefers-color-scheme: dark)`);e.addEventListener(`change`,function(e){i.setClearColor(e.matches?3355443:11184810),dn(m,h,e.matches?f:d),V()}),i.setClearColor(e.matches?3355443:11184810),dn(m,h,e.matches?f:d)}i.getClearColor(e.viewportColor),i.setPixelRatio(window.devicePixelRatio),i.setSize(r.dom.offsetWidth,r.dom.offsetHeight),i.isWebGLRenderer?(a=new D.PMREMGenerator(i),a.compileEquirectangularShader(),o=new gt(i)):(a=new pe(i),o=null),r.dom.appendChild(i.domElement),n.sceneEnvironmentChanged.dispatch(e.environmentType),V()}),n.rendererDetectKTX2Support.add(function(e){e.detectSupport(i)}),n.sceneGraphChanged.add(function(){ne(),V()}),n.cameraChanged.add(function(){o&&o.reset(),V()}),n.objectSelected.add(function(e){v.visible=!1,S.detach(),e!==null&&e!==c&&e!==s&&(_.setFromObject(e,!0),_.isEmpty()===!1&&(v.visible=!0),S.attach(e)),V()}),n.objectFocused.add(function(e){F.focus(e)}),n.geometryChanged.add(function(e){e!==void 0&&_.setFromObject(e,!0),ne(),V()}),n.objectChanged.add(function(t){e.selected===t&&_.setFromObject(t,!0),t.isPerspectiveCamera&&t.updateProjectionMatrix();let n=e.helpers[t.id];n!==void 0&&n.isSkeletonHelper!==!0&&n.update(),ne(),V()}),n.objectRemoved.add(function(e){F.enabled=!0,e===S.object&&S.detach()}),n.materialChanged.add(function(){ie(),V()}),n.sceneBackgroundChanged.add(function(t,r,i,a,o,s,l,u){switch(e.backgroundType=t,c.background=null,t){case`Color`:c.background=new D.Color(r);break;case`Texture`:i&&(i.colorSpace=o,i.needsUpdate=!0,c.background=i);break;case`Equirectangular`:a&&(a.mapping=D.EquirectangularReflectionMapping,a.colorSpace=o,a.needsUpdate=!0,c.background=a,c.backgroundBlurriness=s,c.backgroundIntensity=l,c.backgroundRotation.y=u*D.MathUtils.DEG2RAD);break}I&&n.sceneEnvironmentChanged.dispatch(e.environmentType),re(),V()});let I=!1;n.sceneEnvironmentChanged.add(function(t,n){switch(e.environmentType=t,c.environment=null,I=!1,t){case`Equirectangular`:n&&(c.environment=n,c.environment.mapping=D.EquirectangularReflectionMapping);break;case`Default`:I=!0,c.background===null?c.environment=a.fromScene(new be,.04).texture:c.background.isColor?c.environment=a.fromScene(new ye(c.background),.04).texture:c.background.isTexture&&(c.environment=c.background,c.environment.mapping=D.EquirectangularReflectionMapping,c.environmentRotation.y=c.backgroundRotation.y);break}R(),V()}),n.sceneFogChanged.add(function(e,t,n,r,i){switch(e){case`None`:c.fog=null;break;case`Fog`:c.fog=new D.Fog(t,n,r);break;case`FogExp2`:c.fog=new D.FogExp2(t,i);break}V()}),n.sceneFogSettingsChanged.add(function(e,t,n,r,i){switch(e){case`Fog`:c.fog.color.setHex(t),c.fog.near=n,c.fog.far=r;break;case`FogExp2`:c.fog.color.setHex(t),c.fog.density=i;break}V()}),n.viewportCameraChanged.add(function(){let t=e.viewportCamera;(t.isPerspectiveCamera||t.isOrthographicCamera)&&C(),F.enabled=t===e.camera,ne(),V()}),n.viewportShadingChanged.add(function(){switch(e.viewportShading){case`realistic`:o&&o.init(c,e.viewportCamera);break;case`solid`:c.overrideMaterial=null;break;case`normals`:c.overrideMaterial=new D.MeshNormalMaterial;break;case`wireframe`:c.overrideMaterial=new D.MeshBasicMaterial({color:0,wireframe:!0});break}V()}),n.windowResize.add(function(){C(),i!==null&&(i.setSize(r.dom.offsetWidth,r.dom.offsetHeight),o&&o.setSize(r.dom.offsetWidth,r.dom.offsetHeight),V())}),n.showHelpersChanged.add(function(e){p.visible=e.gridHelper,l.traverse(function(t){switch(t.type){case`CameraHelper`:t.visible=e.cameraHelpers;break;case`PointLightHelper`:case`DirectionalLightHelper`:case`SpotLightHelper`:case`HemisphereLightHelper`:t.visible=e.lightHelpers;break;case`SkeletonHelper`:t.visible=e.skeletonHelpers;break;default:}}),V()}),n.cameraResetted.add(C),n.startPlayer.add(function(){r.setDisplay(`none`)}),n.stopPlayer.add(function(){r.setDisplay(``)});let L=0,ee=new D.Timer;function te(){ee.update();let t=e.mixer,r=ee.getDelta(),a=!1,o=t.stats.actions;(o.inUse>0||L>0)&&(L=o.inUse,t.update(r),a=!0,e.selected!==null&&(e.selected.updateWorldMatrix(!1,!0),v.box.setFromObject(e.selected,!0)),n.morphTargetsUpdated.dispatch()),g.animating===!0&&(g.update(r),a=!0),i.xr.isPresenting===!0&&(a=!0),a===!0&&V(),z()}function ne(){o&&e.viewportShading===`realistic`&&o.init(c,e.viewportCamera)}function re(){o&&e.viewportShading===`realistic`&&o.setBackground(c.background,c.backgroundBlurriness)}function R(){o&&e.viewportShading===`realistic`&&o.setEnvironment(c.environment)}function ie(){o&&e.viewportShading===`realistic`&&o.updateMaterials()}function z(){o&&e.viewportShading===`realistic`&&(o.update(),e.signals.pathTracerUpdated.dispatch(o.getSamples()))}let B=0,ae=0;function V(){i!==null&&(B=performance.now(),i.setViewport(0,0,r.dom.offsetWidth,r.dom.offsetHeight),n.sceneBeforeRender.dispatch(),i.render(c,e.viewportCamera),s===e.viewportCamera&&(i.autoClear=!1,p.visible===!0&&i.render(p,s),l.visible===!0&&i.render(l,s),i.xr.isPresenting!==!0&&g.render(i),i.autoClear=!0),ae=performance.now(),e.signals.sceneRendered.dispatch(ae-B))}return e.render=V,r}function dn(e,t,n){e.material.color.setHex(n[0]),t.material.color.setHex(n[1])}var fn=`/** three/webgpu. */\r
declare const THREE: typeof import('three/webgpu')\r
\r
/** three/tsl. */\r
declare const TSL: typeof import('three/tsl')`;async function pn(){return await Se({workspace:new xe({name:`ThreeEditor`,initialFiles:{"types/window.d.ts":fn}}),themes:[`monokai`],lsp:{typescript:{compilerOptions:{types:[`types/window.d.ts`]},importMap:{imports:{"three/addons/":`https://esm.sh/three@0.183.1/examples/jsm/`,"three/examples/":`https://esm.sh/three@0.183.1/examples/`,three:`https://esm.sh/three@0.183.1/build/three.module.js`,"three/tsl":`https://esm.sh/three@0.183.1/build/three.tsl.js`,"three/webgl":`https://esm.sh/three@0.183.1/build/three.module.js`,"three/webgpu":`https://esm.sh/three@0.183.1/build/three.webgpu.js`},scopes:{}}}}})}async function mn(e){let t=e.signals,n=e.strings,i=new u;i.setId(`script`),i.setPosition(`absolute`),i.setBackgroundColor(`#272822`),i.setDisplay(`none`);let a=new u;a.setPadding(`10px`),i.add(a);let o=new y().setColor(`#fff`);a.add(o);let s=new r((function(){let e=document.createElementNS(`http://www.w3.org/2000/svg`,`svg`);e.setAttribute(`width`,32),e.setAttribute(`height`,32);let t=document.createElementNS(`http://www.w3.org/2000/svg`,`path`);return t.setAttribute(`d`,`M 12,12 L 22,22 M 22,12 12,22`),t.setAttribute(`stroke`,`#fff`),e.appendChild(t),e})());s.setPosition(`absolute`),s.setTop(`3px`),s.setRight(`1px`),s.setCursor(`pointer`),s.onClick(function(){i.setDisplay(`none`)}),a.add(s);let c,l,d;t.editorCleared.add(function(){i.setDisplay(`none`)});function f(e,t){if(typeof t==`object`)o.setValue(e.name+` / `+t.name);else switch(t){case`vertexShader`:o.setValue(e.material.name+` / `+n.getKey(`script/title/vertexShader`));break;case`fragmentShader`:o.setValue(e.material.name+` / `+n.getKey(`script/title/fragmentShader`));break;case`programInfo`:o.setValue(e.material.name+` / `+n.getKey(`script/title/programInfo`));break;default:throw Error(`setTitle: Unknown script`)}}let p=await pn(),m=p.editor.create(i.dom);return i.dom.addEventListener(`keydown`,function(e){e.stopPropagation()}),m.onDidChangeModelContent(function(){clearTimeout(c),c=setTimeout(function(){let t=m.getModel().getValue();if(typeof l==`object`){t!==l.source&&e.execute(new Ke(e,d,l,`source`,t));return}if(l!==`programInfo`)return;let n=JSON.parse(t);if(JSON.stringify(d.material.defines)!==JSON.stringify(n.defines)){let t=new Ve(e,d,`defines`,n.defines);t.updatable=!1,e.execute(t)}if(JSON.stringify(d.material.uniforms)!==JSON.stringify(n.uniforms)){let t=new Ve(e,d,`uniforms`,n.uniforms);t.updatable=!1,e.execute(t)}if(JSON.stringify(d.material.attributes)!==JSON.stringify(n.attributes)){let t=new Ve(e,d,`attributes`,n.attributes);t.updatable=!1,e.execute(t)}},300)}),t.editScript.add(function(e,t){let n,r;if(typeof t==`object`)n=`javascript`,r=t.source;else switch(t){case`vertexShader`:n=`glsl`,r=e.material.vertexShader||``;break;case`fragmentShader`:n=`glsl`,r=e.material.fragmentShader||``;break;case`programInfo`:n=`json`;let t={defines:e.material.defines,uniforms:e.material.uniforms,attributes:e.material.attributes};r=JSON.stringify(t,null,`	`);break;default:throw Error(`editScript: Unknown script`)}f(e,t),l=t,d=e,i.setDisplay(``),n===`javascript`&&m.setModel(p.editor.createModel(r,`javascript`)),n===`json`&&m.setModel(p.editor.createModel(r,`json`)),n===`glsl`&&m.setModel(p.editor.createModel(r,`glsl`))}),t.scriptRemoved.add(function(e){l===e&&i.setDisplay(`none`)}),t.objectChanged.add(function(e){e===d&&([`programInfo`,`vertexShader`,`fragmentShader`].includes(l)||f(d,l))}),t.scriptChanged.add(function(e){e===l&&f(d,l)}),t.materialChanged.add(function(e){e===d&&f(d,l)}),i}export{Te as _,Et as a,Ct as c,mt as d,pt as f,Ee as g,at as h,tn as i,vt as l,dt as m,un as n,Tt as o,ft as p,nn as r,wt as s,mn as t,ht as u};