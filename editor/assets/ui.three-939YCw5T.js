import{_ as e,a as t,h as n,i as r,n as i,p as a,s as o,y as s}from"./SetGeometryCommand-CsejrNn_.js";import*as c from"three";import{FullScreenQuad as l}from"three/addons/postprocessing/Pass.js";var u=`https://unpkg.com/three@0.183.1/examples/jsm/libs/`;function d(e){return e.startsWith(`/`)&&(e=e.substring(1)),u+e}var f=`https://unpkg.com/three@0.183.1/examples/models/`;function p(e){return console.error(`examples/models not setup`),e.startsWith(`/`)&&(e=e.substring(1)),f+e}var m=`modulepreload`,h=function(e,t){return new URL(e,t).href},g={};const _=function(e,t,n){let r=Promise.resolve();if(t&&t.length>0){let e=document.getElementsByTagName(`link`),i=document.querySelector(`meta[property=csp-nonce]`),a=i?.nonce||i?.getAttribute(`nonce`);function o(e){return Promise.all(e.map(e=>Promise.resolve(e).then(e=>({status:`fulfilled`,value:e}),e=>({status:`rejected`,reason:e}))))}r=o(t.map(t=>{if(t=h(t,n),t in g)return;g[t]=!0;let r=t.endsWith(`.css`),i=r?`[rel="stylesheet"]`:``;if(n)for(let n=e.length-1;n>=0;n--){let i=e[n];if(i.href===t&&(!r||i.rel===`stylesheet`))return}else if(document.querySelector(`link[href="${t}"]${i}`))return;let o=document.createElement(`link`);if(o.rel=r?`stylesheet`:m,r||(o.as=`script`),o.crossOrigin=``,o.href=t,a&&o.setAttribute(`nonce`,a),document.head.appendChild(o),r)return new Promise((e,n)=>{o.addEventListener(`load`,e),o.addEventListener(`error`,()=>n(Error(`Unable to preload CSS for ${t}`)))})}))}function i(e){let t=new Event(`vite:preloadError`,{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return r.then(t=>{for(let e of t||[])e.status===`rejected`&&i(e.reason);return e().catch(i)})};var v=class extends i{constructor(e,t=null,n=null,r=null){super(e),this.type=`MoveObjectCommand`,this.name=e.strings.getKey(`command/MoveObject`),this.object=t,this.oldParent=t===null?null:t.parent,this.oldIndex=this.oldParent===null?null:this.oldParent.children.indexOf(this.object),this.newParent=n,r===null?this.newIndex=n===null?null:n.children.length:this.newIndex=n===null?null:n.children.indexOf(r),this.oldParent===this.newParent&&this.newIndex>this.oldIndex&&this.newIndex--,this.newBefore=r}execute(){this.oldParent.remove(this.object),this.newParent.children.splice(this.newIndex,0,this.object),this.object.parent=this.newParent,this.object.dispatchEvent({type:`added`}),this.editor.signals.objectChanged.dispatch(this.object),this.editor.signals.objectChanged.dispatch(this.newParent),this.editor.signals.objectChanged.dispatch(this.oldParent),this.editor.signals.sceneGraphChanged.dispatch()}undo(){this.newParent.remove(this.object),this.oldParent.children.splice(this.oldIndex,0,this.object),this.object.parent=this.oldParent,this.object.dispatchEvent({type:`added`}),this.editor.signals.objectChanged.dispatch(this.object),this.editor.signals.objectChanged.dispatch(this.newParent),this.editor.signals.objectChanged.dispatch(this.oldParent),this.editor.signals.sceneGraphChanged.dispatch()}toJSON(){let e=super.toJSON(this);return e.objectUuid=this.object.uuid,e.newParentUuid=this.newParent.uuid,e.oldParentUuid=this.oldParent.uuid,e.newIndex=this.newIndex,e.oldIndex=this.oldIndex,e}fromJSON(e){super.fromJSON(e),this.object=this.editor.objectByUuid(e.objectUuid),this.oldParent=this.editor.objectByUuid(e.oldParentUuid),this.oldParent===void 0&&(this.oldParent=this.editor.scene),this.newParent=this.editor.objectByUuid(e.newParentUuid),this.newParent===void 0&&(this.newParent=this.editor.scene),this.newIndex=e.newIndex,this.oldIndex=e.oldIndex}},y=new Map,b=class extends e{constructor(e){super();let t=this,n=document.createElement(`form`),r=document.createElement(`input`);r.type=`file`,r.addEventListener(`change`,function(e){a(e.target.files[0])}),n.appendChild(r);let i=document.createElement(`canvas`);i.width=32,i.height=16,i.style.cursor=`pointer`,i.style.marginRight=`5px`,i.style.border=`1px solid #888`,i.addEventListener(`click`,function(){r.click()}),i.addEventListener(`drop`,function(e){e.preventDefault(),e.stopPropagation(),a(e.dataTransfer.files[0])}),this.dom.appendChild(i);async function a(r){let i=r.name.split(`.`).pop().toLowerCase(),a=new FileReader,o=`${r.lastModified}_${r.size}_${r.name}`;if(y.has(o)){let e=y.get(o);t.setValue(e),t.onChangeCallback&&t.onChangeCallback(e)}else i===`hdr`||i===`pic`?(a.addEventListener(`load`,async function(e){let{HDRLoader:n}=await _(async()=>{let{HDRLoader:e}=await import(`three/addons/loaders/HDRLoader.js`);return{HDRLoader:e}},[],import.meta.url);new n().load(e.target.result,function(e){e.sourceFile=r.name,y.set(o,e),t.setValue(e),t.onChangeCallback&&t.onChangeCallback(e)})}),a.readAsDataURL(r)):i===`tga`?(a.addEventListener(`load`,async function(e){let{TGALoader:n}=await _(async()=>{let{TGALoader:e}=await import(`three/addons/loaders/TGALoader.js`);return{TGALoader:e}},[],import.meta.url);new n().load(e.target.result,function(e){e.colorSpace=c.SRGBColorSpace,e.sourceFile=r.name,y.set(o,e),t.setValue(e),t.onChangeCallback&&t.onChangeCallback(e)})},!1),a.readAsDataURL(r)):i===`ktx2`?(a.addEventListener(`load`,async function(n){let{KTX2Loader:i}=await _(async()=>{let{KTX2Loader:e}=await import(`three/addons/loaders/KTX2Loader.js`);return{KTX2Loader:e}},[],import.meta.url),a=n.target.result,s=URL.createObjectURL(new Blob([a])),l=new i;l.setTranscoderPath(d(`basis/`)),e.signals.rendererDetectKTX2Support.dispatch(l),l.load(s,function(e){e.colorSpace=c.SRGBColorSpace,e.sourceFile=r.name,e.needsUpdate=!0,y.set(o,e),t.setValue(e),t.onChangeCallback&&t.onChangeCallback(e),l.dispose()})}),a.readAsArrayBuffer(r)):i===`exr`?(a.addEventListener(`load`,async function(e){let{EXRLoader:n}=await _(async()=>{let{EXRLoader:e}=await import(`three/addons/loaders/EXRLoader.js`);return{EXRLoader:e}},[],import.meta.url),i=e.target.result,a=URL.createObjectURL(new Blob([i]));new n().load(a,function(e){e.sourceFile=r.name,e.needsUpdate=!0,y.set(o,e),t.setValue(e),t.onChangeCallback&&t.onChangeCallback(e)})}),a.readAsArrayBuffer(r)):r.type.match(`image.*`)&&(a.addEventListener(`load`,function(e){let n=document.createElement(`img`);n.addEventListener(`load`,function(){let e=new c.Texture(this);e.sourceFile=r.name,e.needsUpdate=!0,y.set(o,e),t.setValue(e),t.onChangeCallback&&t.onChangeCallback(e)},!1),n.src=e.target.result},!1),a.readAsDataURL(r));n.reset()}this.texture=null,this.onChangeCallback=null}getValue(){return this.texture}setValue(e){let t=this.dom.children[0],n=t.getContext(`2d`);if(n&&n.clearRect(0,0,t.width,t.height),e!==null){let r=e.image;if(r!=null&&r.width>0){t.title=e.sourceFile;let i=t.width/r.width;if(e.isDataTexture||e.isCompressedTexture){let t=O(e);n.drawImage(t,0,0,r.width*i,r.height*i)}else n.drawImage(r,0,0,r.width*i,r.height*i)}else t.title=e.sourceFile+` (error)`}else t.title=`empty`;this.texture=e}setColorSpace(e){let t=this.getValue();return t!==null&&(t.colorSpace=e),this}onChange(e){return this.onChangeCallback=e,this}},x=class extends o{constructor(e){super(),this.dom.className=`Outliner`,this.dom.tabIndex=0;let t=this;this.scene=e.scene,this.dom.addEventListener(`keydown`,function(e){switch(e.code){case`ArrowUp`:case`ArrowDown`:e.preventDefault(),e.stopPropagation();break}}),this.dom.addEventListener(`keyup`,function(e){switch(e.code){case`ArrowUp`:t.selectIndex(t.selectedIndex-1);break;case`ArrowDown`:t.selectIndex(t.selectedIndex+1);break}}),this.editor=e,this.options=[],this.selectedIndex=-1,this.selectedValue=null}selectIndex(e){if(e>=0&&e<this.options.length){this.setValue(this.options[e].value);let t=new Event(`change`,{bubbles:!0,cancelable:!0});this.dom.dispatchEvent(t)}}setOptions(e){let t=this;for(;t.dom.children.length>0;)t.dom.removeChild(t.dom.firstChild);function n(){t.setValue(this.value);let e=new Event(`change`,{bubbles:!0,cancelable:!0});t.dom.dispatchEvent(e)}let r;function i(){r=this}function a(e){e.dataTransfer.setData(`text`,`foo`)}function o(e){if(this===r)return;let t=e.offsetY/this.clientHeight;t<.25?this.className=`option dragTop`:t>.75?this.className=`option dragBottom`:this.className=`option drag`}function s(){this!==r&&(this.className=`option`)}function c(e){if(this===r||r===void 0)return;this.className=`option`;let n=t.scene,i=n.getObjectById(r.value),a=e.offsetY/this.clientHeight;if(a<.25){let e=n.getObjectById(this.value);l(i,e.parent,e)}else if(a>.75){let e,t;this.nextSibling===null?(e=null,t=n.getObjectById(this.value).parent):(e=n.getObjectById(this.nextSibling.value),t=e.parent),l(i,t,e)}else l(i,n.getObjectById(this.value))}function l(e,n,r){r===null&&(r=void 0);let i=!1;if(e.traverse(function(e){e===n&&(i=!0)}),i)return;let a=t.editor;a.execute(new v(a,e,n,r));let o=new Event(`change`,{bubbles:!0,cancelable:!0});t.dom.dispatchEvent(o)}t.options=[];for(let r=0;r<e.length;r++){let l=e[r];l.className=`option`,t.dom.appendChild(l),t.options.push(l),l.addEventListener(`click`,n),l.draggable===!0&&(l.addEventListener(`drag`,i),l.addEventListener(`dragstart`,a),l.addEventListener(`dragover`,o),l.addEventListener(`dragleave`,s),l.addEventListener(`drop`,c))}return t}getValue(){return this.selectedValue}setValue(e){for(let t=0;t<this.options.length;t++){let n=this.options[t];if(n.value===e){n.classList.add(`active`);let e=n.offsetTop-this.dom.offsetTop,r=e+n.offsetHeight-this.dom.offsetHeight;this.dom.scrollTop>e?this.dom.scrollTop=e:this.dom.scrollTop<r&&(this.dom.scrollTop=r),this.selectedIndex=t}else n.classList.remove(`active`)}return this.selectedValue=e,this}},S=class extends e{constructor(){super(),this.dom.style.display=`inline-block`,this.pointsList=new o,this.add(this.pointsList),this.pointsUI=[],this.lastPointIdx=0,this.onChangeCallback=null,this.update=()=>{this.onChangeCallback!==null&&this.onChangeCallback()}}onChange(e){return this.onChangeCallback=e,this}clear(){for(let e=this.pointsUI.length-1;e>=0;--e)this.deletePointRow(e,!1);this.lastPointIdx=0}deletePointRow(e,t=!0){this.pointsUI[e]&&(this.pointsList.remove(this.pointsUI[e].row),this.pointsUI.splice(e,1),t===!0&&this.update(),this.lastPointIdx--)}},C=class extends S{constructor(){super();let e=new n;this.add(e);let t=new r(`+`);t.onClick(()=>{if(this.pointsUI.length===0)this.pointsList.add(this.createPointRow(0,0));else{let e=this.pointsUI[this.pointsUI.length-1];this.pointsList.add(this.createPointRow(e.x.getValue(),e.y.getValue()))}this.update()}),e.add(t)}getValue(){let e=[],t=0;for(let n=0;n<this.pointsUI.length;n++){let r=this.pointsUI[n];r&&(e.push(new c.Vector2(r.x.getValue(),r.y.getValue())),++t,r.lbl.setValue(t))}return e}setValue(e,t=!0){this.clear();for(let t=0;t<e.length;t++){let n=e[t];this.pointsList.add(this.createPointRow(n.x,n.y))}return t===!0&&this.update(),this}createPointRow(e,t){let n=new o,i=new s(this.lastPointIdx+1).setWidth(`20px`),c=new a(e).setWidth(`30px`).onChange(this.update),l=new a(t).setWidth(`30px`).onChange(this.update),u=this,d=new r(`-`).onClick(function(){if(u.isEditing)return;let e=u.pointsList.getIndexOfChild(n);u.deletePointRow(e)});return this.pointsUI.push({row:n,lbl:i,x:c,y:l}),++this.lastPointIdx,n.add(i,c,l,d),n}},w=class extends S{constructor(){super();let e=new n;this.add(e);let t=new r(`+`);t.onClick(()=>{if(this.pointsUI.length===0)this.pointsList.add(this.createPointRow(0,0,0));else{let e=this.pointsUI[this.pointsUI.length-1];this.pointsList.add(this.createPointRow(e.x.getValue(),e.y.getValue(),e.z.getValue()))}this.update()}),e.add(t)}getValue(){let e=[],t=0;for(let n=0;n<this.pointsUI.length;n++){let r=this.pointsUI[n];r&&(e.push(new c.Vector3(r.x.getValue(),r.y.getValue(),r.z.getValue())),++t,r.lbl.setValue(t))}return e}setValue(e,t=!0){this.clear();for(let t=0;t<e.length;t++){let n=e[t];this.pointsList.add(this.createPointRow(n.x,n.y,n.z))}return t===!0&&this.update(),this}createPointRow(e,t,n){let i=new o,c=new s(this.lastPointIdx+1).setWidth(`20px`),l=new a(e).setWidth(`30px`).onChange(this.update),u=new a(t).setWidth(`30px`).onChange(this.update),d=new a(n).setWidth(`30px`).onChange(this.update),f=this,p=new r(`-`).onClick(function(){if(f.isEditing)return;let e=f.pointsList.getIndexOfChild(i);f.deletePointRow(e)});return this.pointsUI.push({row:i,lbl:c,x:l,y:u,z:d}),++this.lastPointIdx,i.add(c,l,u,d,p),i}},T=class extends e{constructor(e,n){super(),this.setMarginRight(`4px`),this.checkbox=new t(e),this.text=new s(n).setMarginLeft(`3px`),this.add(this.checkbox),this.add(this.text)}getValue(){return this.checkbox.getValue()}setValue(e){return this.checkbox.setValue(e)}},E,D;function O(e){E===void 0&&(E=new c.WebGLRenderer),D===void 0&&(D=new l(new c.MeshBasicMaterial));let t=e.image;return E.setSize(t.width,t.height,!1),D.material.map=e,D.render(E),E.domElement}export{b as a,d as c,w as i,p as l,x as n,v as o,C as r,_ as s,T as t};